<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Lineage Traceability Dashboard - MLflow Extension</title>
    <style>
        /* ==========================================
           DESIGN TOKENS - MLflow Theme
           ========================================== */
        :root {
            /* Primary Brand Colors */
            /* MLflow brand blues (from running bundle palette) */
            --color-primary: #2272B4;
            --color-primary-hover: #4299E0;
            --color-primary-dark: #0E538B;
            --color-primary-gradient: linear-gradient(135deg, #4299E0 0%, #2272B4 55%, #04355D 100%);
            
            /* Status Colors */
            --color-success: #10B981;
            --color-success-bg: rgba(16, 185, 129, 0.15);
            --color-warning: #F59E0B;
            --color-warning-bg: rgba(245, 158, 11, 0.15);
            --color-error: #EF4444;
            --color-error-bg: rgba(239, 68, 68, 0.15);
            
            /* Background Colors */
            /* MLflow dark theme surfaces (grey800/700/650) */
            --bg-page: #11171C;      /* grey800 / backgroundPrimary */
            --bg-sidebar: #1F272D;   /* grey700 / backgroundSecondary (chrome: header/nav/subpanel) */
            --bg-card: #1F272D;      /* grey700 / backgroundSecondary */
            --bg-elevated: #37444F;  /* grey650 / codeBackground */
            --bg-hover: rgba(189, 205, 219, 0.04);  /* tableBackgroundUnselectedHover */
            --bg-active: rgba(189, 205, 219, 0.08); /* tableBackgroundSelectedDefault */
            --bg-overlay: rgba(0, 0, 0, 0.6);
            
            /* Border Colors */
            /* MLflow dark borders */
            --border-default: #1F272D;                 /* border */
            --border-subtle: rgba(232, 236, 240, 0.08);
            --border-hover: rgba(232, 236, 240, 0.14);
            --border-primary: rgba(34, 114, 180, 0.35);
            
            /* Text Colors */
            /* MLflow dark text (grey100/350/400/500/600) */
            --text-primary: #E8ECF0;    /* grey100 / textPrimary */
            --text-secondary: #92A4B3;  /* grey350 / textSecondary */
            --text-tertiary: #8396A5;   /* grey400 / textPlaceholder-ish */
            --text-muted: #5F7281;      /* grey500 */
            --text-faint: #445461;      /* grey600 */
            --text-link: var(--color-primary);
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            --font-mono: 'SF Mono', Monaco, 'Courier New', monospace;
            --font-size-xs: 11px;
            --font-size-sm: 13px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --line-height: 1.5;
            
            /* Spacing */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.3);
            
            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.2s ease;
            
            /* Layout */
            --sidebar-width: 150px;
            --header-height: 56px;
            --side-panel-width: 440px;
        }

        /* ==========================================
           RESET & BASE STYLES
           ========================================== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: var(--font-family);
            background-color: var(--bg-page);
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            line-height: var(--line-height);
        }

        /* ==========================================
           LAYOUT UTILITIES
           ========================================== */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-1 { flex: 1; }
        .flex-shrink-0 { flex-shrink: 0; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-1 { gap: 4px; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap: 16px; }
        .gap-6 { gap: 24px; }
        .gap-8 { gap: 32px; }
        
        .grid { display: grid; }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-12 { grid-template-columns: repeat(12, 1fr); }
        .col-span-5 { grid-column: span 5; }
        .col-span-7 { grid-column: span 7; }

        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .h-screen { height: 100vh; }
        .min-w-0 { min-width: 0; }
        .overflow-hidden { overflow: hidden; }
        .overflow-auto { overflow: auto; }

        /* Spacing */
        .p-2 { padding: 8px; }
        .p-3 { padding: 12px; }
        .p-4 { padding: 16px; }
        .p-5 { padding: 20px; }
        .p-6 { padding: 24px; }
        .px-3 { padding-left: 12px; padding-right: 12px; }
        .px-4 { padding-left: 16px; padding-right: 16px; }
        .px-6 { padding-left: 24px; padding-right: 24px; }
        .py-2 { padding-top: 8px; padding-bottom: 8px; }
        .py-3 { padding-top: 12px; padding-bottom: 12px; }
        .pl-3 { padding-left: 12px; }
        .m-4 { margin: 16px; }
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .mb-8 { margin-bottom: 32px; }
        .mt-1 { margin-top: 4px; }
        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .mt-6 { margin-top: 24px; }
        .ml-2 { margin-left: 8px; }
        .ml-4 { margin-left: 16px; }
        .ml-6 { margin-left: 24px; }
        .ml-auto { margin-left: auto; }

        /* ==========================================
           TYPOGRAPHY
           ========================================== */
        .text-xs { font-size: var(--font-size-xs); }
        .text-sm { font-size: var(--font-size-sm); }
        .text-lg { font-size: var(--font-size-xl); }
        .text-xl { font-size: var(--font-size-2xl); }
        .font-medium { font-weight: var(--font-weight-medium); }
        .font-semibold { font-weight: var(--font-weight-semibold); }
        .font-mono { font-family: var(--font-mono); }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .text-center { text-align: center; }
        .leading-relaxed { line-height: 1.7; }

        /* Colors */
        .text-white { color: var(--text-primary); }
        .text-gray-300 { color: var(--text-tertiary); }
        .text-gray-400 { color: var(--text-muted); }
        .text-gray-500 { color: var(--text-faint); }
        .text-primary { color: var(--color-primary); }
        .text-purple-400 { color: var(--color-primary); } /* Legacy alias */

        /* Status Colors */
        .status-success { color: var(--color-success); }
        .status-warning { color: var(--color-warning); }
        .status-error { color: var(--color-error); }

        /* Numeric alignment */
        .tabular-nums { font-variant-numeric: tabular-nums; }

        /* ==========================================
           Token usage + CostBadge (reusable)
           ========================================== */
        .token-usage-block {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-top: 6px;
        }

        .token-usage-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 8px;
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
        }

        .token-metric {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }

        .token-metric__label {
            font-size: var(--font-size-xs);
            color: var(--text-faint);
        }

        .token-metric__value {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
        }

        .cost-badge {
            --_cost-bg: rgba(255, 255, 255, 0.06);
            --_cost-border: rgba(255, 255, 255, 0.10);
            --_cost-fg: var(--text-secondary);
            --_cost-dot: rgba(255, 255, 255, 0.35);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            border: 1px solid var(--_cost-border);
            background: var(--_cost-bg);
            color: var(--_cost-fg);
            font-size: 11px;
            line-height: 1.2;
            font-weight: var(--font-weight-semibold);
            white-space: nowrap;
        }

        .cost-badge__dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--_cost-dot);
            box-shadow: 0 0 0 2px rgba(0,0,0,0.25);
        }

        .cost-badge__amount {
            font-variant-numeric: tabular-nums;
            color: var(--text-primary);
        }

        .cost-badge__tier {
            font-size: 10px;
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.3px;
            text-transform: uppercase;
            opacity: 0.9;
        }

        .cost-badge[data-level="low"] {
            --_cost-bg: var(--color-success-bg);
            --_cost-border: rgba(16, 185, 129, 0.35);
            --_cost-fg: var(--color-success);
            --_cost-dot: var(--color-success);
        }

        .cost-badge[data-level="medium"] {
            --_cost-bg: var(--color-warning-bg);
            --_cost-border: rgba(245, 158, 11, 0.35);
            --_cost-fg: var(--color-warning);
            --_cost-dot: var(--color-warning);
        }

        .cost-badge[data-level="high"] {
            --_cost-bg: var(--color-error-bg);
            --_cost-border: rgba(239, 68, 68, 0.35);
            --_cost-fg: var(--color-error);
            --_cost-dot: var(--color-error);
        }

        /* VersionBadge — reusable for agent/model/version chips */
        .version-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            background: rgba(34, 114, 180, 0.12);
            border: 1px solid rgba(34, 114, 180, 0.30);
            color: rgba(232, 236, 240, 0.92);
            font-size: 11px;
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.2px;
            white-space: nowrap;
        }

        .version-badge::before {
            content: "";
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(0,0,0,0.22);
        }
        .status-none { color: var(--text-faint); }

        /* Metric-specific colors (decoupled from status-*) */
        .cost-success { color: var(--color-success); }
        .cost-warning { color: var(--color-warning); }
        .cost-error { color: var(--color-error); }
        .cost-none { color: var(--text-faint); }

        /* ==========================================
           COMPONENTS
           ========================================== */
        
        /* Sidebar - MLflow Style */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-sidebar);
            border-right: none;
            display: flex;
            flex-direction: column;
            transition: width var(--transition-normal), padding var(--transition-normal);
            color: rgb(146, 164, 179);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-logo-icon-unused {
            width: 28px;
            height: 28px;
            background: var(--color-primary-gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            font-weight: var(--font-weight-semibold);
            font-size: 12px;
        }

        .sidebar-logo-text {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: rgb(146, 164, 179);
            letter-spacing: -0.3px;
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--space-3) var(--space-2);
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: var(--space-1);
        }

        .sidebar-section-title {
            font-size: 10px;
            font-weight: var(--font-weight-semibold);
            color: var(--text-faint);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: var(--space-3) var(--space-3) var(--space-2);
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            color: rgb(146, 164, 179);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
            font-weight: 450;
        }

        .sidebar-item:hover {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .sidebar-item.active {
            background: var(--bg-active);
            color: var(--color-primary);
        }

        .sidebar-icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-base);
            opacity: 0.85;
        }

        .sidebar-icon svg {
            width: 18px;
            height: 18px;
            display: block;
        }

        /* Sidebar sub-panel (MLflow-like static second column) */
        .sidebar-subpanel {
            width: 150px;
            /* Subpanel is part of main content area (no box) */
            background: transparent;
            border: none;
            border-radius: 0;
            box-shadow: none;
            margin: 0;
            display: none;
            flex-direction: column;
            flex-shrink: 0;
            overflow-y: auto;
            transition: width var(--transition-normal);
        }

        /* Main content area — single rounded card that holds subpanel + views */
        .content-area {
            flex: 1 1 0%;
            display: flex;
            overflow: hidden;
            margin: 12px;
            background: var(--bg-page);
            border: 1px solid rgba(232, 236, 240, 0.06);
            border-radius: var(--radius-xl);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
        }

        .sidebar-subpanel.visible {
            display: flex;
        }

        .sidebar-subpanel-header {
            display: flex;
            align-items: flex-end;
            padding: 20px 12px 16px;
            min-height: 87px;
            box-sizing: border-box;
            border-bottom: 1px solid rgba(232, 236, 240, 0.06);
            background: transparent;
        }

        .sidebar-subpanel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.75rem;
            font-weight: var(--font-weight-semibold);
            margin-left: 20px;
            margin-right: 20px;
            color: var(--text-primary);
            letter-spacing: -0.2px;
        }
        .sidebar-subpanel-title.deployment-header {
            margin-left: 12px !important;
            margin-right: 12px !important;
            width: calc(100% - 24px) !important;
            font-size: var(--font-size-2xl) !important; /* match .text-xl */
            font-weight: var(--font-weight-semibold) !important;
            line-height: 1.25 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        /* Deployment subpanel header: match sizing, pad top > bottom */
        #deployment-subpanel .sidebar-subpanel-header {
            align-items: flex-start !important;
            justify-content: center !important;
            padding-top: 24px !important;
            padding-bottom: 6px !important;
        }

        /* Deployment views render their own top header in main content. */

        .sidebar-subpanel-items {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 10px 8px;
        }

        .sidebar-subpanel-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
            font-weight: 450;
            position: relative;
        }

        .sidebar-subpanel-item-icon {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            opacity: 0.9;
        }

        .sidebar-subpanel-item-icon svg {
            width: 16px;
            height: 16px;
            display: block;
        }

        .sidebar-subpanel-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .sidebar-subpanel-item.active {
            background: var(--bg-active);
            color: var(--text-primary);
        }

        .sidebar-subpanel-item.active::before {
            content: '';
            position: absolute;
            left: 4px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            border-radius: 2px;
            background: var(--color-primary);
        }

        .sidebar-subpanel-item .sidebar-icon {
            width: 16px;
            height: 16px;
            font-size: 13px;
            opacity: 0.8;
        }

        .sidebar-divider {
            height: 1px;
            background: var(--border-subtle);
            margin: var(--space-2) var(--space-3);
        }

        /* Header - MLflow Style (full-width, above sidebar) */
        .main-header {
            height: var(--header-height);
            flex-shrink: 0;
            background: var(--bg-sidebar);
            border-bottom: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-5);
            z-index: 10;
            color: rgb(146, 164, 179);
        }

        .menu-toggle {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            cursor: pointer;
            color: rgb(146, 164, 179);
            transition: all var(--transition-fast);
            background: transparent;
            border: none;
        }

        .menu-toggle:hover {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .menu-toggle svg {
            width: 18px;
            height: 18px;
        }

        /* Sidebar collapsed state */
        .sidebar.collapsed {
            width: 0;
            padding: 0;
            overflow: hidden;
            border-right: none;
        }

        .sidebar.collapsed * {
            opacity: 0;
            visibility: hidden;
        }

        .sidebar-subpanel.hidden-by-sidebar {
            display: none !important;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--font-size-sm);
            color: rgb(146, 164, 179);
        }

        .breadcrumb-link {
            color: var(--color-primary);
            text-decoration: none;
            cursor: pointer;
            font-weight: var(--font-weight-medium);
        }

        .breadcrumb-link:hover {
            color: var(--color-primary-hover);
            text-decoration: underline;
        }

        .breadcrumb .separator {
            color: var(--text-faint);
            font-size: var(--font-size-xs);
        }

        .breadcrumb .current {
            color: var(--text-secondary);
            font-weight: var(--font-weight-medium);
        }

        /* Cards - MLflow Style */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            transition: all 0.2s ease;
        }

        /* Darker cards specifically in Deployment views */
        div[id^="view-deployment"] .card {
            background: transparent !important;
            border-color: rgba(232, 236, 240, 0.10) !important;
        }

        div[id^="view-deployment"] .card:hover {
            border-color: rgba(232, 236, 240, 0.16) !important;
        }

        .card:hover {
            border-color: var(--border-hover);
        }

        .card-clickable {
            cursor: pointer;
        }

        .card-clickable:hover {
            border-color: var(--border-primary);
            box-shadow: var(--shadow-lg);
        }

        /* Status Dot */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
        }

        .status-dot.success { background: var(--color-success); }
        .status-dot.warning { background: var(--color-warning); }
        .status-dot.error { background: var(--color-error); }

        .status-dot-sm {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
        }

        /* Score Badge */
        .score-badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) 10px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            border: 1px solid;
        }

        .score-badge.success {
            background: var(--color-success-bg);
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--color-success);
        }

        .score-badge.warning {
            background: var(--color-warning-bg);
            border-color: rgba(245, 158, 11, 0.3);
            color: var(--color-warning);
        }

        .score-badge.error {
            background: var(--color-error-bg);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--color-error);
        }

        /* Sparkline */
        .sparkline {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 24px;
        }

        .sparkline-bar {
            width: 4px;
            border-radius: var(--radius-sm);
        }

        /* Button - MLflow Style */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: 7px 14px;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            border: none;
            transition: all var(--transition-fast);
        }

        .btn-primary {
            background: var(--color-primary-gradient);
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--color-primary-hover) 0%, #0BA5F5 100%);
            box-shadow: 0 2px 4px rgba(67, 201, 237, 0.3);
        }

        .btn-secondary {
            background: var(--bg-active);
            color: var(--color-primary);
            border: 1px solid var(--border-primary);
        }

        .btn-secondary:hover {
            background: rgba(67, 201, 237, 0.2);
        }

        .btn-ghost {
            background: rgba(255, 255, 255, 0.04);
            color: var(--text-tertiary);
            border: 1px solid var(--border-hover);
        }

        .btn-ghost:hover {
            background: var(--bg-hover);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .btn-icon {
            padding: var(--space-2);
            border-radius: var(--radius-md);
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: var(--font-size-base);
        }

        .btn-icon:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        /* Filter Bar - MLflow Style */
        .filter-bar {
            display: flex;
            gap: 10px;
            padding: 10px 14px;
            background: var(--bg-sidebar);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-subtle);
        }

        .filter-select {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: 7px var(--space-3);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            cursor: pointer;
            outline: none;
        }

        .filter-select:focus {
            border-color: var(--border-primary);
        }

        /* Trace Row - MLflow Style */
        .trace-row {
            display: flex;
            align-items: center;
            padding: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .trace-row:hover {
            background: rgba(67, 201, 237, 0.04);
        }

        /* Trace Feedback — Boolean thumbs up/down */
        .trace-feedback {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            flex-shrink: 0;
            margin-right: 10px;
        }

        .trace-feedback.thumbs-up {
            background: rgba(16, 185, 129, 0.15);
        }

        .trace-feedback.thumbs-down {
            background: rgba(239, 68, 68, 0.15);
        }

        /* Waterfall Spans — Reusable component */
        .span-block {
            height: 28px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 11px;
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--text-primary);
            gap: 6px;
            white-space: nowrap;
        }

        .span-block:hover {
            filter: brightness(1.15);
        }

        /* Span type colors */
        .span-llm {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
        }

        .span-retriever {
            background: var(--color-primary-gradient);
        }

        .span-other {
            background: linear-gradient(135deg, #4B5563 0%, #374151 100%);
        }

        /* Span alert state */
        .span-alert {
            border: 1.5px solid var(--color-warning);
        }

        .span-alert-icon {
            color: var(--color-warning);
            font-size: 11px;
            flex-shrink: 0;
        }

        /* Span inline badge */
        .span-badge {
            padding: 1px 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            font-size: 10px;
        }

        /* Span duration label */
        .span-duration {
            margin-left: auto;
            font-size: 10px;
            opacity: 0.6;
        }

        /* Span chevron for expandable spans */
        .span-chevron {
            font-size: 9px;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        /* Waterfall layout helpers */
        .waterfall-children {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-left: 20px;
        }

        /* Assessment Badge - MLflow Style */
        .assessment-badge {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: 14px var(--space-4);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-subtle);
            flex: 1;
        }

        .assessment-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-lg);
        }

        /* Side Panel - MLflow Style */
        .side-panel-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-overlay);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 999;
        }

        .side-panel-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        .side-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: var(--side-panel-width);
            height: 100vh;
            background: var(--bg-sidebar);
            border-left: 1px solid var(--border-default);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .side-panel.open {
            transform: translateX(0);
        }

        /* Chunk Card - MLflow Style */
        .chunk-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 14px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .chunk-card:hover {
            border-color: var(--border-primary);
            background: #2a2a3d;
        }

        .chunk-card.problematic {
            border-left: 3px solid var(--color-error);
        }

        /* Lineage Node - MLflow Style */
        .lineage-node {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            padding: 18px 22px;
            text-align: center;
            transition: all var(--transition-normal);
            cursor: pointer;
            width: 260px;
        }

        .lineage-node:hover {
            border-color: var(--border-primary);
            box-shadow: 0 0 16px rgba(67, 201, 237, 0.15);
        }

        .lineage-node.highlight {
            border-color: var(--border-primary);
            background: var(--bg-active);
        }

        .lineage-connector {
            width: 2px;
            height: 28px;
            background: linear-gradient(180deg, rgba(67, 201, 237, 0.5) 0%, rgba(67, 201, 237, 0.2) 100%);
            margin: 0 auto;
        }

        .lineage-arrow {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid rgba(67, 201, 237, 0.5);
            margin: 0 auto;
        }

        /* Tables - MLflow Style */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 10px 12px;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            color: var(--text-muted);
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border-subtle);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            white-space: nowrap;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        tr:hover {
            background: rgba(67, 201, 237, 0.04);
        }

        .table-footer {
            padding: 6px var(--space-4);
            border-top: 1px solid var(--border-subtle);
            font-size: 12px;
            flex-shrink: 0;
        }

        /* Compact table variant */
        .table-compact th,
        .table-compact td {
            padding: 9px 6px;
            font-size: var(--font-size-sm);
        }

        .table-compact th:first-child,
        .table-compact td:first-child {
            padding-left: 12px;
        }

        .table-compact th:last-child,
        .table-compact td:last-child {
            padding-right: 12px;
        }

        /* Chart placeholder */
        .chart-histogram {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: var(--space-1);
            height: 140px;
            padding: var(--space-2) 0;
        }

        .chart-bar {
            flex: 1;
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
        }

        .chart-scatter {
            position: relative;
            height: 140px;
            background: #252536;
            border-radius: 6px;
        }

        .scatter-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        /* View management */
        .view {
            display: none !important;
        }

        .view.active {
            display: block !important;
        }

        .view.active[style*="flex-direction: column"] {
            display: flex !important;
            max-height: 100%;
        }

        /* Link styling */
        a {
            color: inherit;
            text-decoration: none;
        }

        .link-primary {
            color: var(--color-primary);
            cursor: pointer;
        }

        .link-primary:hover {
            color: var(--color-primary-hover);
        }

        /* Subtle link: keeps current color until hover */
        .link-inline {
            color: inherit;
            cursor: pointer;
        }

        .link-inline:hover {
            color: var(--color-primary-hover);
            text-decoration: underline;
            text-underline-offset: 2px;
        }

        /* ToolBadge (reusable) */
        .tool-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            background: rgba(55, 68, 79, 0.55);
            border: 1px solid rgba(232, 236, 240, 0.10);
            color: var(--text-secondary);
            font-size: 11px;
            line-height: 1.2;
            white-space: nowrap;
        }

        .tool-badge:hover {
            border-color: rgba(232, 236, 240, 0.16);
            background: rgba(55, 68, 79, 0.72);
        }

        .tool-badge__icon {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            display: inline-block;
            flex-shrink: 0;
        }

        .tool-badge__label {
            font-size: 10px;
            padding: 1px 6px;
            border-radius: var(--radius-full);
            border: 1px solid rgba(59, 130, 246, 0.30);
            background: rgba(59, 130, 246, 0.12);
            color: rgba(147, 197, 253, 0.95);
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .tool-badge__label--rag {
            border-color: rgba(168, 85, 247, 0.30) !important;
            background: rgba(168, 85, 247, 0.12) !important;
            color: rgba(216, 180, 254, 0.95) !important;
        }

        .guardrail-badge {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px 12px;
            border-radius: 10px;
            background: rgba(55, 68, 79, 0.55);
            border: 1px solid rgba(232, 236, 240, 0.10);
            color: var(--text-secondary);
            font-size: 11px;
            line-height: 1.2;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.15s ease, border-color 0.15s ease;
        }

        .guardrail-badge:hover {
            border-color: rgba(232, 236, 240, 0.16);
            background: rgba(55, 68, 79, 0.72);
        }

        .guardrail-badge__label {
            font-size: 10px;
            padding: 1px 6px;
            border-radius: var(--radius-full);
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .guardrail-badge__label--critical {
            border: 1px solid rgba(244, 63, 94, 0.30);
            background: rgba(244, 63, 94, 0.12);
            color: rgba(251, 148, 166, 0.95);
        }

        .guardrail-badge__label--high {
            border: 1px solid rgba(249, 115, 22, 0.30);
            background: rgba(249, 115, 22, 0.12);
            color: rgba(253, 186, 116, 0.95);
        }

        .guardrail-badge__label--medium {
            border: 1px solid rgba(251, 191, 36, 0.30);
            background: rgba(251, 191, 36, 0.12);
            color: rgba(253, 224, 128, 0.95);
        }

        .guardrail-badge__label--low {
            border: 1px solid rgba(16, 185, 129, 0.30);
            background: rgba(16, 185, 129, 0.12);
            color: rgba(167, 243, 208, 0.95);
        }

        .badge-label-model {
            border-color: rgba(16, 163, 127, 0.34) !important;
            background: rgba(16, 163, 127, 0.12) !important;
            color: rgba(167, 243, 208, 0.95) !important;
        }

        /* InlineCallout (reusable) */
        .inline-callout {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            border: 1px solid rgba(232, 236, 240, 0.10);
            background: rgba(55, 68, 79, 0.45);
            font-size: 11px;
            line-height: 1.2;
            white-space: nowrap;
        }

        .inline-callout--warning {
            border-color: rgba(245, 158, 11, 0.35);
            background: var(--color-warning-bg);
            color: var(--color-warning);
        }

        .inline-callout__icon {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.18);
            flex-shrink: 0;
        }

        .inline-callout__text {
            color: rgba(232, 236, 240, 0.92);
            font-weight: var(--font-weight-medium);
        }

        /* Mini histogram (for alert analytics) */
        .mini-histogram {
            position: relative;
            height: 54px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-subtle);
            background: var(--bg-elevated);
            overflow: hidden;
        }

        .mini-histogram__grid {
            position: absolute;
            inset: 0;
            background-image: linear-gradient(to top, rgba(232,236,240,0.06) 1px, transparent 1px);
            background-size: 100% 18px;
            pointer-events: none;
            opacity: 0.9;
        }

        .mini-histogram__threshold {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(245, 158, 11, 0.9);
            box-shadow: 0 0 0 1px rgba(0,0,0,0.25);
            pointer-events: none;
        }

        .mini-histogram__bars {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: flex-end;
            gap: 3px;
            padding: 8px 10px;
        }

        .mini-histogram__bar {
            width: 10px;
            border-radius: 4px;
            background: rgba(232,236,240,0.28);
        }

        .mini-histogram__bar.is-breach {
            background: rgba(245,158,11,0.92);
        }

        /* Deployment notices (clickable events under title) */
        .notice-panel {
            width: 100%;
            max-width: none;
            margin: 0 0 18px;
            padding: 0;
        }

        .notice-item {
            width: 100%;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 10px 12px;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(232, 236, 240, 0.10);
            background: rgba(55, 68, 79, 0.35);
            text-decoration: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .notice-item:hover {
            background: rgba(55, 68, 79, 0.55);
            border-color: rgba(232, 236, 240, 0.16);
        }

        .notice-item__left {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .notice-item__icon {
            width: 28px;
            height: 28px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: rgba(0,0,0,0.20);
            border: 1px solid rgba(232, 236, 240, 0.10);
        }

        .notice-item__title {
            font-size: 13px;
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .notice-item__detail {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .notice-item__right {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            color: var(--text-muted);
            font-size: 12px;
        }

        .notice-item--warning {
            border-color: rgba(245, 158, 11, 0.28);
            background: rgba(245, 158, 11, 0.08);
        }

        .notice-item--warning:hover {
            border-color: rgba(245, 158, 11, 0.38);
            background: rgba(245, 158, 11, 0.12);
        }

        .notice-item--warning .notice-item__icon {
            border-color: rgba(245, 158, 11, 0.28);
            background: rgba(245, 158, 11, 0.12);
        }

        /* ==========================================
           INBOX COMPONENT
           ========================================== */
        .inbox {
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            background: transparent;
            overflow: hidden;
        }

        .inbox__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-subtle);
            background: transparent;
        }

        .inbox__title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
        }

        .inbox__filters {
            display: flex;
            gap: 2px;
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
            padding: 2px;
        }

        .inbox__filter-btn {
            font-size: 11px;
            font-weight: var(--font-weight-medium);
            color: var(--text-muted);
            background: transparent;
            border: none;
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            line-height: 1.3;
        }

        .inbox__filter-btn:hover {
            color: var(--text-secondary);
        }

        .inbox__filter-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }

        .inbox__count {
            font-size: 10px;
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.14);
            border-radius: var(--radius-full);
            padding: 1px 6px;
            margin-left: 4px;
            line-height: 1.4;
        }

        .inbox__list {
            display: flex;
            flex-direction: column;
            max-height: 600px;
            overflow-y: auto;
        }

        .inbox__item {
            display: flex;
            align-items: flex-start;
            gap: 0;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: background var(--transition-fast);
            position: relative;
            text-decoration: none;
            color: inherit;
        }

        .inbox__item:last-child {
            border-bottom: none;
        }

        .inbox__item:hover {
            background: var(--bg-hover);
        }

        .inbox__item.is-unread {
            background: transparent;
        }

        .inbox__item.is-unread .inbox__item-title {
            font-weight: 600;
            color: #fff;
        }

        .inbox__item.is-unread .inbox__item-detail {
            color: var(--text-secondary);
        }

        .inbox__item:not(.is-unread) {
            background: transparent;
        }

        .inbox__item:not(.is-unread) .inbox__item-title {
            color: var(--text-secondary);
        }

        .inbox__item:not(.is-unread) .inbox__item-detail {
            color: var(--text-muted);
        }

        /* Priority left border on inbox items */
        .inbox__item--p1 { border-left: 3px solid #ef4444; }
        .inbox__item--p2 { border-left: 3px solid #f59e0b; }
        .inbox__item--p3 { border-left: 3px solid rgba(255, 255, 255, 0.25); }
        .inbox__item--p4 { border-left: 3px solid rgba(255, 255, 255, 0.08); }

        .inbox__item-body {
            flex: 1;
            min-width: 0;
        }

        .inbox__item-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .inbox__item-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .inbox__item-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .inbox__item-detail {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-top: 3px;
            line-height: 1.45;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .inbox__item-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 6px;
            flex-wrap: wrap;
        }

        .inbox__item-tag {
            font-size: 10px;
            font-weight: var(--font-weight-medium);
            padding: 1px 7px;
            border-radius: var(--radius-full);
            line-height: 1.5;
        }

        .inbox__item-tag--warning {
            color: var(--color-warning);
            background: var(--color-warning-bg);
            border: 1px solid rgba(245, 158, 11, 0.25);
        }

        .inbox__item-tag--error {
            color: var(--color-error);
            background: var(--color-error-bg);
            border: 1px solid rgba(239, 68, 68, 0.25);
        }

        .inbox__item-tag--success {
            color: var(--color-success);
            background: var(--color-success-bg);
            border: 1px solid rgba(16, 185, 129, 0.25);
        }

        .inbox__item-tag--info {
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .inbox__item-source {
            font-size: 10px;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        .inbox__empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 24px;
            color: var(--text-muted);
            text-align: center;
        }

        .inbox__empty-icon {
            font-size: 28px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .inbox__empty-text {
            font-size: var(--font-size-sm);
        }

        /* Legacy alias */
        .link-purple { color: var(--color-primary); cursor: pointer; }
        .link-purple:hover { color: var(--color-primary-hover); }

        /* Divider */
        .divider {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Content box - MLflow Style */
        .content-box {
            padding: 14px;
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.04);
        }

        /* Icon placeholder */
        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Card alert slot — fixed height so cards align with or without an alert */
        .card-alert-slot {
            height: 32px;
            display: flex;
            align-items: center;
        }

        .card-alert-slot-inner {
            width: 100%;
            height: 32px;
            display: flex;
            align-items: center;
            border-radius: var(--radius-md);
            padding: 7px 10px;
            overflow: hidden;
        }

        /* Alert Banner */
        .alert-banner {
            transition: all var(--transition-fast);
        }

        .alert-banner:hover {
            transform: translateY(-1px);
        }

        .alert-banner:hover > div {
            border-color: var(--color-warning);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
        }

        /* Service Map — flow-based layout */
        .svc-graph-scroll {
            width: 100%;
            max-width: 100%;
            position: relative;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
            /* Keep graphs contained inside cards */
            max-height: 420px;
            padding: 4px 0;
            user-select: none;
            cursor: grab;
            touch-action: none;
        }

        .svc-graph-scroll.dragging {
            cursor: grabbing;
        }

        .svc-graph-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            z-index: 30;
        }

        .svc-graph-controls button {
            width: 28px;
            height: 28px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(20, 24, 32, 0.72);
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 800;
            line-height: 1;
            transition: all 0.15s ease;
        }

        .svc-graph-controls button:hover {
            border-color: rgba(34,114,180,0.35);
            background: rgba(34,114,180,0.12);
            color: var(--color-primary);
        }

        .svc-graph-zoom {
            font-size: 11px;
            color: var(--text-muted);
            padding: 0 6px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.10);
            border-radius: 999px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            font-family: var(--font-mono, monospace);
        }

        .svc-graph {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 24px;
            padding: 8px 0;
            /* Allow horizontal scroll when content is wider */
            min-width: max-content;
        }

        .svc-graph svg.svc-edges {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .svc-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1;
            position: relative;
            flex-wrap: wrap;
        }

        .svc-zone {
            border: 1px dashed rgba(255,255,255,0.12);
            border-radius: 12px;
            padding: 28px 16px 14px;
            display: flex;
            gap: 16px;
            justify-content: center;
            position: relative;
            flex-wrap: wrap;
        }

        /* Column-oriented zone: wraps multiple rows of nodes */
        .svc-zone-col {
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 32px 20px 16px;
        }

        .svc-zone-label {
            position: absolute;
            top: 7px;
            left: 11px;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .svc-node {
            background: #282840;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 10px 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 1;
            min-width: 140px;
            max-width: 200px;
            flex-shrink: 1;
        }

        .svc-node:hover {
            transform: translateY(-2px);
            background: #30304a;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.08);
            border-color: var(--color-primary);
            z-index: 10;
        }

        .svc-node:hover .svc-node-name {
            color: var(--color-primary);
        }

        .svc-node.node-success { border-color: var(--color-success); }
        .svc-node.node-success:hover { border-color: #34d399; box-shadow: 0 8px 24px rgba(16,185,129,0.25); }
        .svc-node.node-warning { border-color: var(--color-warning); }
        .svc-node.node-warning:hover { border-color: #fbbf24; box-shadow: 0 8px 24px rgba(245,158,11,0.25); }
        .svc-node.node-primary { border-width: 2px; }

        .svc-node-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }
        .svc-node-icon svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
        }
        .svc-node:hover .svc-node-icon { color: var(--color-primary); }
        .svc-node-name { font-size: 11px; font-weight: 600; color: white; transition: color 0.2s; display: flex; align-items: center; flex-wrap: wrap; gap: 2px; }
        .svc-node-meta { font-size: 9px; color: var(--text-muted); margin-top: 1px; }
        /* Ensure status colors win inside svc-node meta lines */
        .svc-node-meta.status-success { color: var(--color-success) !important; }
        .svc-node-meta.status-warning { color: var(--color-warning) !important; }
        .svc-node-meta.status-error { color: var(--color-error) !important; }
        .svc-node-meta.status-none { color: var(--text-faint) !important; }
        .svc-node-pill {
            display: inline-flex;
            align-items: center;
            padding: 1px 6px;
            border-radius: 999px;
            font-size: 9px;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            margin-left: 6px;
            color: rgba(255,255,255,0.85);
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.10);
        }

        /* Pagination */
        .pagination-btn {
            padding: var(--space-1) var(--space-3);
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .pagination-btn:hover {
            color: var(--text-secondary);
            background: var(--bg-hover);
        }

        .pagination-btn.active {
            color: var(--text-primary);
            background: var(--color-primary-gradient);
        }

        /* Responsive grid */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-4);
        }

        @media (max-width: 1200px) {
            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Checkbox */
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }

        /* Search input */
        .search-input {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            outline: none;
            width: 100%;
            padding: var(--space-2) var(--space-3);
        }

        .search-input::placeholder {
            color: var(--text-faint);
        }

        .search-wrapper {
            position: relative;
            flex: 1;
        }

        .search-icon {
            position: absolute;
            left: var(--space-2);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-faint);
            font-size: var(--font-size-base);
        }

        /* Styled search box */
        .search-box {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: 0 var(--space-3);
            transition: all var(--transition-fast);
        }

        .search-box:focus-within {
            border-color: var(--border-primary);
            box-shadow: 0 0 0 2px rgba(67, 201, 237, 0.1);
        }

        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            padding: var(--space-2) 0;
            outline: none;
        }

        .search-box input::placeholder {
            color: var(--text-faint);
        }

        .search-box svg {
            width: 16px;
            height: 16px;
            color: var(--text-faint);
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div style="display: flex; flex-direction: column; height: 100vh;">
        <!-- Header - Full Width -->
        <header class="main-header">
            <div class="flex items-center gap-3">
                <button class="menu-toggle" data-action="toggle-sidebar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="sidebar-logo">
                    <span class="sidebar-logo-text">MLflow</span>
                </div>
                <span class="text-gray-500">|</span>
                <div class="breadcrumb" id="breadcrumb">
                    <span class="current">Agents</span>
                </div>
            </div>
        </header>

        <!-- Body: Sidebar + Main Content -->
        <div style="display: flex; flex: 1 1 0%; min-height: 0; overflow: hidden;">
            <!-- Sidebar - MLflow Style (narrow primary) -->
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <div class="sidebar-section">
                        <div class="sidebar-item" data-nav="home">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 10.5 12 3l9 7.5"></path>
                                    <path d="M5 10v11h14V10"></path>
                                </svg>
                            </span>
                            Home
                        </div>
                        <div class="sidebar-item" data-nav="experiments">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M10 2v6l-4.5 8A5 5 0 0 0 10 22h4a5 5 0 0 0 4.5-6L14 8V2"></path>
                                    <path d="M8.5 14h7"></path>
                                </svg>
                            </span>
                            Experiments
                        </div>
                        <div class="sidebar-item" data-nav="models">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 3 21 8.5 12 14 3 8.5 12 3Z"></path>
                                    <path d="M21 8.5V15.5L12 21 3 15.5V8.5"></path>
                                    <path d="M12 14v7"></path>
                                </svg>
                            </span>
                            Models
                        </div>
                        <div class="sidebar-item" data-nav="prompts">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 20h9"></path>
                                    <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5Z"></path>
                                </svg>
                            </span>
                            Prompts
                        </div>
                        <div class="sidebar-item" data-nav="gateway">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M7 7h13"></path>
                                    <path d="M7 7l3-3"></path>
                                    <path d="M7 7l3 3"></path>
                                    <path d="M17 17H4"></path>
                                    <path d="M17 17l-3-3"></path>
                                    <path d="M17 17l-3 3"></path>
                                </svg>
                            </span>
                            AI Gateway
                        </div>
                        <div class="sidebar-item active" data-nav="agents">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2l7 4v12l-7 4-7-4V6l7-4Z"></path>
                                    <path d="M12 7v10"></path>
                                    <path d="M8.5 10.5h7"></path>
                                </svg>
                            </span>
                            Agents
                        </div>
                        <!-- Deployments removed (confusing in prototype) -->
                        <div class="sidebar-item" data-nav="tools">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14.7 6.3a4.5 4.5 0 0 0-6.4 6.4l-5.1 5.1a2 2 0 0 0 2.8 2.8l5.1-5.1a4.5 4.5 0 0 0 6.4-6.4l-2.2 2.2-2.8-2.8 2.2-2.2Z"></path>
                                </svg>
                            </span>
                            Tools
                        </div>
                        <div class="sidebar-item" data-nav="guardrails">
                            <span class="sidebar-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2l8 4v6c0 5-3.5 9.5-8 10-4.5-.5-8-5-8-10V6l8-4Z"></path>
                                </svg>
                            </span>
                            Guardrails
                        </div>
                        <!-- Alerts removed (confusing in prototype) -->
                    </div>
                </nav>
            </aside>

            <!-- Main Content -->
            <main style="flex: 1 1 0%; min-width: 0; display: flex; flex-direction: column; overflow: hidden; background: var(--bg-sidebar);">

            <!-- Content Area (single rounded card) -->
            <div class="content-area">
                    <!-- Sub-panel: Agents (inside content area card) -->
                    <aside class="sidebar-subpanel" id="agents-subpanel">
                        <div class="sidebar-subpanel-header">
                        </div>
                        <div class="sidebar-subpanel-items">
                            <div class="sidebar-subpanel-item active" data-nav="agent-detail-cs">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                                        <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                                        <rect x="3" y="14" width="7" height="7" rx="1"></rect>
                                        <rect x="14" y="14" width="7" height="7" rx="1"></rect>
                                    </svg>
                                </span>
                                Overview
                            </div>
                            <div class="sidebar-subpanel-item" data-nav="agent-deployments">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"></path>
                                    </svg>
                                </span>
                                Deployments
                            </div>
                            <div class="sidebar-subpanel-item" data-nav="agent-analytics">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                    </svg>
                                </span>
                                Jobs
                            </div>
                            <div class="sidebar-subpanel-item" data-nav="agent-evaluations">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M9 11l3 3L22 4"></path>
                                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                    </svg>
                                </span>
                                Evaluations
                            </div>
                        </div>
                    </aside>

                    <!-- Sub-panel: Deployment (replaces Agents subpanel on deployment views) -->
                    <aside class="sidebar-subpanel" id="deployment-subpanel">
                        <div class="sidebar-subpanel-header">
                            <h2 class="sidebar-subpanel-title deployment-header" id="deployment-subpanel-title">Deployment</h2>
                        </div>
                        <div class="sidebar-subpanel-items">
                            <div class="sidebar-subpanel-item active" data-nav="deployment-cs-prod" data-dep-tab="overview">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                                        <path d="M3 9h18"></path>
                                        <path d="M9 21V9"></path>
                                    </svg>
                                </span>
                                Overview
                            </div>
                            <div class="sidebar-subpanel-item" data-nav="deployment-cs-prod-usage" data-dep-tab="usage">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 3v18h18"></path>
                                        <path d="M7 16l4-8 4 5 4-9"></path>
                                    </svg>
                                </span>
                                Usage
                            </div>
                            <div class="sidebar-subpanel-item" data-dep-tab="analytics">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 2a15 15 0 0 1 4 10 15 15 0 0 1-4 10"></path>
                                        <path d="M2 12h20"></path>
                                    </svg>
                                </span>
                                Analytics
                            </div>
                            <div class="sidebar-subpanel-item" data-nav="deployment-alerts" data-dep-tab="alerts">
                                <span class="sidebar-subpanel-item-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 22s8-4 8-10V6l-8-4-8 4v6c0 6 8 10 8 10Z"></path>
                                        <path d="M12 8v4"></path>
                                        <path d="M12 16h.01"></path>
                                    </svg>
                                </span>
                                Alerts
                            </div>
                        </div>
                    </aside>

                    <div style="flex: 1; min-width: 0; overflow-y: auto; padding: 20px;">

                <!-- View: Home -->
                <div id="view-home" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">Home</h1>
                    <p class="text-gray-400">Welcome to MLflow. Select a section from the sidebar to get started.</p>
                </div>

                <!-- View: Experiments -->
                <div id="view-experiments" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">Experiments</h1>
                    <p class="text-gray-400">Experiments view coming soon.</p>
                </div>

                <!-- View: Models -->
                <div id="view-models" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">Models</h1>
                    <p class="text-gray-400">Models view coming soon.</p>
                </div>

                <!-- View: Model Resource — gpt-4-turbo -->
                <div id="view-model-gpt-4-turbo" class="view">
                    <div class="flex items-center gap-4 mb-6">
                        <button class="btn-icon" data-nav="models">←</button>
                        <div class="flex-1">
                            <h1 class="text-xl font-semibold text-white">gpt-4-turbo</h1>
                            <p class="text-sm text-gray-400 mt-1">Model resource · OpenAI · Chat completion</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="status-dot success"></span>
                            <span class="text-sm status-success">Registered</span>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="card p-4">
                            <h3 class="text-xs text-gray-500 uppercase font-semibold mb-3">Model Metadata</h3>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Provider</span>
                                    <span class="text-gray-300">OpenAI</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Family</span>
                                    <span class="text-gray-300">GPT-4 Turbo</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Interface</span>
                                    <span class="text-gray-300">Chat Completions / Assistants</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Default context</span>
                                    <span class="text-gray-300 tabular-nums">128k</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Owned by</span>
                                    <span class="text-gray-300">ML Platform</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Last updated</span>
                                    <span class="text-gray-300">Today</span>
                                </div>
                            </div>
                            <div class="divider mt-4 mb-4"></div>
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-gray-500">Registry</span>
                                <a class="text-xs link-inline" href="#" data-nav="models">Open in MLflow →</a>
                            </div>
                        </div>

                        <div class="card">
                            <div class="p-4 divider">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-medium text-white">Versions</h3>
                                    <button class="btn btn-secondary btn-sm">+ Register Version</button>
                                </div>
                            </div>
                            <div class="p-4">
                                <table class="table-compact">
                                    <thead>
                                        <tr>
                                            <th>Version</th>
                                            <th>Stage</th>
                                            <th>Created</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-gray-300 font-mono text-xs">v2026.02</td>
                                            <td><span class="status-success">● Production</span></td>
                                            <td class="text-gray-400 text-xs">2026-02-06</td>
                                            <td class="text-gray-400 text-xs">Pinned for cs-bot-prod</td>
                                        </tr>
                                        <tr>
                                            <td class="text-gray-300 font-mono text-xs">v2026.01</td>
                                            <td><span class="status-warning">● Staging</span></td>
                                            <td class="text-gray-400 text-xs">2026-01-22</td>
                                            <td class="text-gray-400 text-xs">Eval A/B in progress</td>
                                        </tr>
                                        <tr>
                                            <td class="text-gray-300 font-mono text-xs">v2025.12</td>
                                            <td><span class="text-gray-500">● Archived</span></td>
                                            <td class="text-gray-400 text-xs">2025-12-10</td>
                                            <td class="text-gray-400 text-xs">Superseded</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <p class="text-xs text-gray-500 mt-2">Tip: versions here are registry references, not provider release names.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View: Prompts -->
                <div id="view-prompts" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">Prompts</h1>
                    <p class="text-gray-400">Prompts view coming soon.</p>
                </div>

                <!-- View: AI Gateway -->
                <div id="view-gateway" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">AI Gateway</h1>
                    <p class="text-gray-400">AI Gateway view coming soon.</p>
                </div>

                <!-- View: Tools -->
                <div id="view-tools" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">Tools</h1>
                    <p class="text-gray-400">Tools registry view coming soon.</p>
                </div>

                <!-- View: Guardrails -->
                <div id="view-guardrails" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">Guardrails</h1>
                    <p class="text-gray-400">Guardrails policies and moderation rules view coming soon.</p>
                </div>

                <!-- View: Databases -->
                <div id="view-databases" class="view">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h1 class="text-xl font-semibold text-white">Vector Stores &amp; Databases</h1>
                            <p class="text-sm text-gray-400 mt-1">Connected data sources used by your RAG pipelines</p>
                        </div>
                        <button class="btn btn-primary">+ Connect Database</button>
                    </div>

                    <!-- Database Cards -->
                    <div id="db-cards-root" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px; align-items: start;"></div>

                    <!-- All Databases Table -->
                    <div class="card">
                        <div class="p-4 divider">
                            <h3 class="font-medium text-white">All Connected Sources</h3>
                        </div>
                        <table class="table-compact">
                            <thead>
                                <tr>
                                    <th>Database Name</th>
                                    <th>Type</th>
                                    <th>Region</th>
                                    <th>Chunks</th>
                                    <th>Status</th>
                                    <th>Avg Score</th>
                                    <th>Issues</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-white font-medium">product-knowledge-store</td>
                                    <td class="text-gray-300">ChromaDB</td>
                                    <td class="text-gray-400">us-east-1</td>
                                    <td class="text-white">8,901</td>
                                    <td><span class="status-warning">● Issues</span></td>
                                    <td><span class="status-warning">0.62</span></td>
                                    <td><span class="score-badge error" style="font-size: 10px; padding: 1px 6px;">3 malformed</span></td>
                                </tr>
                                <tr>
                                    <td class="text-white font-medium">support-articles-store</td>
                                    <td class="text-gray-300">Milvus</td>
                                    <td class="text-gray-400">us-west-2</td>
                                    <td class="text-white">3,214</td>
                                    <td><span class="status-success">● Healthy</span></td>
                                    <td><span class="status-success">0.88</span></td>
                                    <td><span class="text-gray-500">—</span></td>
                                </tr>
                                <tr>
                                    <td class="text-white font-medium">legal-compliance-db</td>
                                    <td class="text-gray-300">Weaviate</td>
                                    <td class="text-gray-400">eu-west-1</td>
                                    <td class="text-white">1,560</td>
                                    <td><span class="status-success">● Healthy</span></td>
                                    <td><span class="status-success">0.91</span></td>
                                    <td><span class="text-gray-500">—</span></td>
                                </tr>
                                <tr>
                                    <td class="text-white font-medium">hr-policies-store</td>
                                    <td class="text-gray-300">ChromaDB</td>
                                    <td class="text-gray-400">us-east-1</td>
                                    <td class="text-white">742</td>
                                    <td><span class="text-gray-500">● Offline</span></td>
                                    <td><span class="text-gray-500">—</span></td>
                                    <td><span class="text-gray-500">—</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View: Data Sets -->
                <div id="view-datasets" class="view">
                    <h1 class="text-xl font-semibold text-white mb-4">Data Sets</h1>
                    <p class="text-gray-400">Data Sets view coming soon.</p>
                </div>
                
                <!-- View 1: Evaluation Runs Overview -->
                <div id="view-evaluations" class="view">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="text-xl font-semibold text-white">Evaluation Runs</h1>
                        <button class="btn btn-primary">+ New Run</button>
                    </div>

                    <div class="card-grid">
                        <!-- Failing Run Card -->
                        <div class="card card-clickable p-5" data-nav="eval-detail" style="border-left: 3px solid var(--color-error);">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h3 class="font-semibold text-white mb-1">prod-eval-42</h3>
                                    <p class="text-xs text-gray-500">2 hours ago · 156 traces</p>
                                </div>
                                <span class="score-badge error">2 Failing</span>
                            </div>
                            
                            <!-- Failing metrics highlighted -->
                            <div class="content-box mb-3" style="padding: 10px;">
                                <p class="text-xs text-gray-500 mb-2">Metrics below threshold:</p>
                                <div class="flex items-center gap-4">
                                    <span class="text-sm"><span class="status-error font-medium">Faithfulness: 0.41</span></span>
                                    <span class="text-sm"><span class="status-warning font-medium">Relevance: 0.55</span></span>
                                </div>
                            </div>

                            <div class="sparkline">
                                <div class="sparkline-bar" style="height: 30%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 40%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 25%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 50%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 35%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 30%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 45%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 20%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 55%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 25%; background: #EF4444"></div>
                            </div>
                        </div>

                        <!-- Warning Run Card -->
                        <div class="card card-clickable p-5" data-nav="eval-detail" style="border-left: 3px solid var(--color-warning);">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h3 class="font-semibold text-white mb-1">staging-v2.1</h3>
                                    <p class="text-xs text-gray-500">5 hours ago · 89 traces</p>
                                </div>
                                <span class="score-badge warning">1 Degraded</span>
                            </div>
                            
                            <!-- Degraded metrics highlighted -->
                            <div class="content-box mb-3" style="padding: 10px;">
                                <p class="text-xs text-gray-500 mb-2">Metrics below threshold:</p>
                                <div class="flex items-center gap-4">
                                    <span class="text-sm"><span class="status-warning font-medium">Faithfulness: 0.67</span></span>
                                </div>
                            </div>

                            <div class="sparkline">
                                <div class="sparkline-bar" style="height: 70%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 75%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 65%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 80%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 85%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 75%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 90%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 80%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 85%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 78%; background: #F59E0B"></div>
                            </div>
                        </div>

                        <!-- Passing Run Card -->
                        <div class="card card-clickable p-5" data-nav="eval-detail" style="border-left: 3px solid var(--color-success);">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h3 class="font-semibold text-white mb-1">nightly-run</h3>
                                    <p class="text-xs text-gray-500">12 hours ago · 203 traces</p>
                                </div>
                                <span class="score-badge success">All Passing</span>
                            </div>
                            
                            <!-- All metrics passing -->
                            <div class="content-box mb-3" style="padding: 10px;">
                                <p class="text-xs text-gray-500 mb-2">All metrics above threshold:</p>
                                <div class="flex items-center gap-4">
                                    <span class="text-xs text-gray-400">Faith: 0.89</span>
                                    <span class="text-xs text-gray-400">Rel: 0.91</span>
                                    <span class="text-xs text-gray-400">Ground: 0.94</span>
                                </div>
                            </div>

                            <div class="sparkline">
                                <div class="sparkline-bar" style="height: 90%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 92%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 88%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 91%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 93%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 90%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 94%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 92%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 95%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 94%; background: #10B981"></div>
                            </div>
                        </div>

                        <!-- More Cards -->
                        <div class="card card-clickable p-5" data-nav="eval-detail" style="border-left: 3px solid var(--color-success);">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h3 class="font-semibold text-white mb-1">qa-baseline</h3>
                                    <p class="text-xs text-gray-500">1 day ago · 175 traces</p>
                                </div>
                                <span class="score-badge success">All Passing</span>
                            </div>
                            
                            <!-- All metrics passing -->
                            <div class="content-box mb-3" style="padding: 10px;">
                                <p class="text-xs text-gray-500 mb-2">All metrics above threshold:</p>
                                <div class="flex items-center gap-4">
                                    <span class="text-xs text-gray-400">Faith: 0.85</span>
                                    <span class="text-xs text-gray-400">Rel: 0.88</span>
                                    <span class="text-xs text-gray-400">Ground: 0.91</span>
                                </div>
                            </div>

                            <div class="sparkline">
                                <div class="sparkline-bar" style="height: 88%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 90%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 89%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 91%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 90%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 92%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 91%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 90%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 91%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 91%; background: #10B981"></div>
                            </div>
                        </div>

                        <div class="card card-clickable p-5" data-nav="eval-detail" style="border-left: 3px solid var(--color-success);">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h3 class="font-semibold text-white mb-1">regression-3</h3>
                                    <p class="text-xs text-gray-500">2 days ago · 142 traces</p>
                                </div>
                                <span class="score-badge success">All Passing</span>
                            </div>
                            
                            <!-- All metrics passing -->
                            <div class="content-box mb-3" style="padding: 10px;">
                                <p class="text-xs text-gray-500 mb-2">All metrics above threshold:</p>
                                <div class="flex items-center gap-4">
                                    <span class="text-xs text-gray-400">Faith: 0.82</span>
                                    <span class="text-xs text-gray-400">Rel: 0.86</span>
                                    <span class="text-xs text-gray-400">Ground: 0.88</span>
                                </div>
                            </div>

                            <div class="sparkline">
                                <div class="sparkline-bar" style="height: 85%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 87%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 86%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 88%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 87%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 89%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 88%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 87%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 88%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 88%; background: #10B981"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View 2: Alert Detail -->
                <div id="view-eval-detail" class="view">
                    <div class="flex items-center gap-4 mb-6">
                        <button class="btn-icon" data-nav="agent-detail-pa">←</button>
                        <div class="flex-1">
                            <div class="flex items-center gap-3">
                                <h1 class="text-xl font-semibold text-white">Product Advisor Agent — Alert</h1>
                                <span class="score-badge error">Active</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-1">Triggered 2 hours ago · product-advisor-v1.3 · Red Hat OpenShift AI</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="btn btn-ghost">Acknowledge</button>
                            <button class="btn btn-secondary">Mute Alert</button>
                        </div>
                    </div>

                    <!-- Alert Summary -->
                    <div class="card p-5 mb-6" style="border-left: 3px solid var(--color-error);">
                        <div class="flex items-start gap-4">
                            <div style="padding: 8px; background: rgba(239,68,68,0.15); border-radius: 8px;">
                                <span style="font-size: 18px;">⚠️</span>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-white font-semibold mb-1">Response Satisfaction dropped below threshold</h3>
                                <p class="text-sm text-gray-400 mb-3">MLflow Judge score for <span class="font-mono text-gray-300">response_satisfaction</span> fell to <span class="status-error font-semibold">0.61</span>, below the configured threshold of <span class="text-white">0.70</span>. This alert was triggered by the scheduled judge evaluation <span class="font-mono text-gray-300">prod-eval-42</span>.</p>
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-500">Rule:</span>
                                        <span class="text-xs font-mono text-gray-300">satisfaction &lt; 0.70 for 2 consecutive runs</span>
                                    </div>
                                    <span class="text-xs text-gray-500">·</span>
                                    <span class="text-xs text-gray-400">Severity: <span class="status-error">High</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <!-- Alert Trigger: Judgement -->
                        <div class="card p-4">
                            <h3 class="text-xs text-gray-500 uppercase font-semibold mb-3">Judgement Trigger</h3>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Evaluation Run</span>
                                    <span class="text-white font-mono">prod-eval-42</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Judge Model</span>
                                    <span class="text-gray-300">gpt-4-turbo (MLflow Judge)</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Traces Evaluated</span>
                                    <span class="text-white">156</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Satisfaction Score</span>
                                    <span class="status-error font-semibold">0.61</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Previous Score</span>
                                    <span class="status-warning">0.68</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Threshold</span>
                                    <span class="text-white">0.70</span>
                                </div>
                            </div>
                        </div>

                        <!-- OTel Signal Context -->
                        <div class="card p-4">
                            <h3 class="text-xs text-gray-500 uppercase font-semibold mb-3">OpenTelemetry Context</h3>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Span Kind</span>
                                    <span class="text-gray-300 font-mono">INTERNAL</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Service</span>
                                    <span class="text-gray-300 font-mono">product-advisor-agent</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Error Rate (1h)</span>
                                    <span class="status-warning">4.2%</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">P99 Latency (1h)</span>
                                    <span class="status-warning">1,240ms</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Throughput (1h)</span>
                                    <span class="text-gray-300">342 req/min</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">Malformed Chunks</span>
                                    <span class="status-error font-mono" style="cursor: pointer;" data-nav="databases">3 in product-knowledge-store →</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Failing Traces -->
                    <div class="card overflow-hidden">
                        <div class="p-4 divider flex items-center justify-between gap-4">
                            <h3 class="font-medium text-white flex-shrink-0">Traces Contributing to Alert</h3>
                            <div class="flex items-center gap-2">
                                <select class="filter-select" style="font-size: 12px; padding: 5px 10px;">
                                    <option>Worst scores first</option>
                                    <option>Best scores first</option>
                                    <option>Most recent</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div class="trace-row" data-nav="trace-detail">
                                <span class="trace-feedback thumbs-down">👎</span>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white truncate mb-1">"What is the refund policy for damaged items?"</p>
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs"><span class="text-gray-500">Satisfaction:</span> <span class="status-error">0.21</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Faith:</span> <span class="status-error">0.21</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Rel:</span> <span class="status-warning">0.45</span></span>
                                    </div>
                                </div>
                                <span class="text-gray-500">›</span>
                            </div>

                            <div class="trace-row" data-nav="trace-detail">
                                <span class="trace-feedback thumbs-down">👎</span>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white truncate mb-1">"How do I cancel my subscription?"</p>
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs"><span class="text-gray-500">Satisfaction:</span> <span class="status-error">0.33</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Faith:</span> <span class="status-error">0.33</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Rel:</span> <span class="status-warning">0.52</span></span>
                                    </div>
                                </div>
                                <span class="text-gray-500">›</span>
                            </div>

                            <div class="trace-row" data-nav="trace-detail">
                                <span class="trace-feedback thumbs-down">👎</span>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white truncate mb-1">"Where can I find my order history?"</p>
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs"><span class="text-gray-500">Satisfaction:</span> <span class="status-warning">0.58</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Faith:</span> <span class="status-warning">0.58</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Rel:</span> <span class="status-warning">0.62</span></span>
                                    </div>
                                </div>
                                <span class="text-gray-500">›</span>
                            </div>

                            <div class="trace-row" data-nav="trace-detail">
                                <span class="trace-feedback thumbs-up">👍</span>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white truncate mb-1">"What are your business hours?"</p>
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs"><span class="text-gray-500">Satisfaction:</span> <span class="status-success">0.92</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Faith:</span> <span class="status-success">0.92</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Rel:</span> <span class="status-success">0.88</span></span>
                                    </div>
                                </div>
                                <span class="text-gray-500">›</span>
                            </div>

                            <div class="trace-row" data-nav="trace-detail">
                                <span class="trace-feedback thumbs-up">👍</span>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-white truncate mb-1">"Can I exchange an item purchased online?"</p>
                                    <div class="flex items-center gap-3">
                                        <span class="text-xs"><span class="text-gray-500">Satisfaction:</span> <span class="status-success">0.85</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Faith:</span> <span class="status-success">0.85</span></span>
                                        <span class="text-xs"><span class="text-gray-500">Rel:</span> <span class="status-success">0.79</span></span>
                                    </div>
                                </div>
                                <span class="text-gray-500">›</span>
                            </div>
                        </div>

                        <div class="table-footer flex items-center justify-between">
                            <p class="text-sm text-gray-500">Showing 5 of 47 flagged traces</p>
                            <div class="flex items-center gap-2">
                                <button class="pagination-btn">Previous</button>
                                <button class="pagination-btn active">1</button>
                                <button class="pagination-btn">2</button>
                                <button class="pagination-btn">3</button>
                                <button class="pagination-btn">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View 3: Trace Detail (Waterfall) -->
                <div id="view-trace-detail" class="view">
                    <div class="flex items-center gap-4 mb-6">
                        <button class="btn-icon" data-nav="eval-detail">←</button>
                        <div>
                            <h1 class="text-xl font-semibold text-white">Trace #a3f2b1</h1>
                            <p class="text-sm text-gray-500 mt-1">prod-eval-42 · 2 hours ago</p>
                        </div>
                    </div>

                    <!-- Query Display -->
                    <div class="card p-5 mb-6">
                        <div class="flex items-start gap-4">
                            <div style="padding: 8px; background: rgba(139,92,246,0.2); border-radius: 8px;">
                                <span style="font-size: 18px;">💬</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm text-gray-400 mb-1">Query</p>
                                <p class="text-white">"What is the refund policy for damaged items?"</p>
                            </div>
                        </div>
                    </div>

                    <!-- Waterfall Chart -->
                    <div class="card p-5 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-medium text-gray-400">Trace Waterfall</h3>
                            <div class="flex items-center gap-4 text-xs text-gray-500">
                                <span>0ms</span>
                                <div style="width: 120px; height: 1px; background: #374151"></div>
                                <span>500ms</span>
                            </div>
                        </div>

                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <!-- Root span -->
                            <div class="span-block span-other w-full">
                                <span>LLMChain</span>
                                <span class="span-duration">487ms</span>
                            </div>
                            
                            <!-- Child spans -->
                            <div class="waterfall-children">
                                <!-- Milvus Retrieval (expandable, alert) -->
                                <div>
                                    <div class="span-block span-retriever span-alert" style="width: 35%;" data-action="toggle-retriever">
                                        <span class="span-chevron" id="retriever-chevron">▶</span>
                                        <span class="span-alert-icon">⚠</span>
                                        Milvus Retrieval
                                        <span class="span-badge">5 docs</span>
                                        <span class="span-duration">142ms</span>
                                    </div>

                                    <!-- Expandable retrieved docs box -->
                                    <div id="retriever-docs" style="display: none; margin-top: 6px; margin-left: 20px; flex-direction: column; border: 1px solid var(--border-subtle); border-radius: var(--radius-md); overflow: hidden; background: var(--bg-card);">
                                        <!-- Header with DB link -->
                                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 6px 10px; background: var(--bg-elevated); border-bottom: 1px solid var(--border-subtle);">
                                            <span style="font-size: 10px; color: var(--text-muted);">Retrieved from <span class="font-mono">product-knowledge-store</span></span>
                                            <span style="font-size: 10px; cursor: pointer;" class="text-primary" data-nav="databases">View Database →</span>
                                        </div>
                                        <!-- Chunk rows -->
                                        <div style="display: flex; flex-direction: column;">
                                            <div class="span-block span-alert" style="background: var(--bg-elevated); border: none; border-bottom: 1px solid var(--border-subtle); border-radius: 0; cursor: pointer;" data-nav="chunk-lineage">
                                                <span class="span-alert-icon">⚠</span>
                                                <span class="font-mono" style="font-size: 10px; color: var(--color-primary);">chunk_8a2d</span>
                                                <span style="font-size: 10px; color: var(--color-error); font-weight: 500;">MALFORMED</span>
                                                <span style="font-size: 10px; color: var(--text-faint); flex: 1; overflow: hidden; text-overflow: ellipsis;">"Refunds for damaged items must be...NUL...ph—"</span>
                                                <span class="score-badge error" style="font-size: 9px; padding: 1px 5px;">0.31</span>
                                            </div>
                                            <div class="span-block" style="background: var(--bg-elevated); border: none; border-bottom: 1px solid var(--border-subtle); border-radius: 0;">
                                                <span style="color: var(--color-success); font-size: 10px;">✓</span>
                                                <span class="font-mono" style="font-size: 10px; color: var(--color-primary);">chunk_f91b</span>
                                                <span style="font-size: 10px; color: var(--text-faint); flex: 1; overflow: hidden; text-overflow: ellipsis;">"Our return policy allows for full refunds..."</span>
                                                <span class="score-badge success" style="font-size: 9px; padding: 1px 5px;">0.82</span>
                                            </div>
                                            <div class="span-block" style="background: var(--bg-elevated); border: none; border-bottom: 1px solid var(--border-subtle); border-radius: 0;">
                                                <span style="color: var(--color-success); font-size: 10px;">✓</span>
                                                <span class="font-mono" style="font-size: 10px; color: var(--color-primary);">chunk_2c4e</span>
                                                <span style="font-size: 10px; color: var(--text-faint); flex: 1; overflow: hidden; text-overflow: ellipsis;">"For warranty claims, contact support..."</span>
                                                <span class="score-badge" style="background: rgba(107,114,128,0.15); border-color: rgba(107,114,128,0.3); color: #9CA3AF; font-size: 9px; padding: 1px 5px;">0.67</span>
                                            </div>
                                            <div class="span-block" style="background: var(--bg-elevated); border: none; border-bottom: 1px solid var(--border-subtle); border-radius: 0;">
                                                <span style="color: var(--color-success); font-size: 10px;">✓</span>
                                                <span class="font-mono" style="font-size: 10px; color: var(--color-primary);">chunk_7d3f</span>
                                                <span style="font-size: 10px; color: var(--text-faint); flex: 1; overflow: hidden; text-overflow: ellipsis;">"Customer satisfaction is our priority..."</span>
                                                <span class="score-badge success" style="font-size: 9px; padding: 1px 5px;">0.79</span>
                                            </div>
                                            <div class="span-block" style="background: var(--bg-elevated); border: none; border-radius: 0;">
                                                <span style="color: var(--color-success); font-size: 10px;">✓</span>
                                                <span class="font-mono" style="font-size: 10px; color: var(--color-primary);">chunk_a1b3</span>
                                                <span style="font-size: 10px; color: var(--text-faint); flex: 1; overflow: hidden; text-overflow: ellipsis;">"Exchanges for items of equal or lesser..."</span>
                                                <span class="score-badge success" style="font-size: 9px; padding: 1px 5px;">0.74</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- LLM span (alert) -->
                                <div class="span-block span-llm span-alert" style="width: 85%; margin-left: 15%;">
                                    <span class="span-alert-icon">⚠</span>
                                    LLM (gpt-4-turbo)
                                    <span class="span-duration">345ms</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Assessment Badges -->
                    <div class="flex gap-4 mb-6">
                        <div class="assessment-badge">
                            <div class="assessment-icon status-error">⚠</div>
                            <div>
                                <p class="text-xs text-gray-500">Faithfulness</p>
                                <p class="text-lg font-semibold status-error">0.21</p>
                            </div>
                        </div>
                        <div class="assessment-badge">
                            <div class="assessment-icon status-warning">!</div>
                            <div>
                                <p class="text-xs text-gray-500">Relevance</p>
                                <p class="text-lg font-semibold status-warning">0.45</p>
                            </div>
                        </div>
                        <div class="assessment-badge">
                            <div class="assessment-icon status-success">✓</div>
                            <div>
                                <p class="text-xs text-gray-500">Groundedness</p>
                                <p class="text-lg font-semibold status-success">0.82</p>
                            </div>
                        </div>
                    </div>

                    <!-- Output -->
                    <div class="card p-5">
                        <div class="flex items-start gap-4">
                            <div style="padding: 8px; background: rgba(59,130,246,0.2); border-radius: 8px;">
                                <span style="font-size: 18px;">🤖</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm text-gray-400 mb-1">Response</p>
                                <p class="text-white">"You can request a refund within 30 days of purchase. Please provide photos of the damage and your order confirmation number. Our team will review your request within 2-3 business days."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View 4: Chunk Lineage -->
                <div id="view-chunk-lineage" class="view">
                    <div class="flex items-center gap-4 mb-6">
                        <button class="btn-icon" data-nav="trace-detail" data-action="close-panel">←</button>
                        <div>
                            <h1 class="text-xl font-semibold text-white">Chunk Lineage</h1>
                            <p class="text-sm text-gray-500 font-mono mt-1">chunk_8a2d7f3e</p>
                        </div>
                    </div>

                    <!-- Chunk Details Header -->
                    <div class="card p-5 mb-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div style="padding: 8px; background: rgba(139,92,246,0.2); border-radius: 8px;">
                                    <span style="font-size: 18px;">📄</span>
                                </div>
                                <div>
                                    <p class="text-sm font-mono text-gray-400">chunk_8a2d7f3e</p>
                                    <p class="text-xs text-gray-500">s3://docs/policies/refunds.pdf</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-6 text-sm">
                                <div class="text-center">
                                    <p class="text-gray-500 text-xs">Retrieved</p>
                                    <p class="text-white font-semibold">47 times</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-gray-500 text-xs">Avg Score</p>
                                    <p class="status-warning font-semibold">0.62</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-gray-500 text-xs">Last Used</p>
                                    <p class="text-white font-semibold">2h ago</p>
                                </div>
                            </div>
                        </div>
                        <div class="content-box">
                            <p class="text-sm text-gray-300 leading-relaxed">"Refunds for damaged items must be requested within 30 days of purchase. Please provide photos of the damage and your order confirmation number. Our customer service team will review your request within 2-3 business days..."</p>
                            <button class="text-xs link-purple mt-2">Show more</button>
                        </div>
                    </div>

                    <!-- Lineage Flow -->
                    <div class="flex gap-8">
                        <div class="flex-1">
                            <h3 class="text-sm font-medium text-gray-400 mb-6">Lineage Flow</h3>
                            
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <!-- Source Document -->
                                <div class="lineage-node">
                                    <div class="flex items-center justify-center gap-2 mb-2">
                                        <span>📄</span>
                                        <span class="text-sm text-gray-400">SOURCE DOCUMENT</span>
                                    </div>
                                    <p class="text-white font-medium">refunds.pdf</p>
                                    <p class="text-xs text-gray-500 mt-1">s3://docs/policies/</p>
                                </div>

                                <div class="lineage-connector"></div>
                                <div class="lineage-arrow"></div>

                                <!-- Ingestion Run -->
                                <div class="lineage-node">
                                    <div class="flex items-center justify-center gap-2 mb-2">
                                        <span>⚙</span>
                                        <span class="text-sm text-gray-400">INGESTION RUN</span>
                                    </div>
                                    <p class="text-white font-medium font-mono">ing_4f2a</p>
                                    <p class="text-xs text-gray-500 mt-1">2024-01-15 14:32</p>
                                    <button class="text-xs link-purple mt-2">View in MLflow →</button>
                                </div>

                                <div class="lineage-connector"></div>
                                <div class="lineage-arrow"></div>

                                <!-- This Chunk -->
                                <div class="lineage-node highlight">
                                    <div class="flex items-center justify-center gap-2 mb-2">
                                        <span>☷</span>
                                        <span class="text-sm text-primary">THIS CHUNK</span>
                                    </div>
                                    <p class="text-white font-medium font-mono">chunk_8a2d7f3e</p>
                                    <p class="text-xs status-warning mt-1">⚠ Avg downstream: 0.62</p>
                                </div>

                                <div class="lineage-connector"></div>
                                <div class="lineage-arrow"></div>

                                <!-- Affected Traces -->
                                <div class="lineage-node">
                                    <div class="flex items-center justify-center gap-2 mb-2">
                                        <span>⑂</span>
                                        <span class="text-sm text-gray-400">AFFECTED TRACES</span>
                                    </div>
                                    <p class="text-white font-medium">47 traces</p>
                                    <button class="text-xs link-purple mt-2">Expand to see all →</button>
                                </div>
                            </div>
                        </div>

                        <!-- Ingestion Parameters -->
                        <div style="width: 280px;">
                            <h3 class="text-sm font-medium text-gray-400 mb-4">Ingestion Parameters</h3>
                            <div class="card p-5">
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1">Chunk Size</p>
                                        <p class="text-white font-mono">512</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1">Overlap</p>
                                        <p class="text-white font-mono">50</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1">Embedding Model</p>
                                        <p class="text-white font-mono">text-embedding-ada-002</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 mb-1">Splitter</p>
                                        <p class="text-white font-mono">recursive</p>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-full mt-6">View Full Run</button>
                            </div>

                            <h3 class="text-sm font-medium text-gray-400 mt-6 mb-4">Actions</h3>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button class="btn btn-ghost">✕ Exclude from dataset</button>
                                <button class="btn btn-ghost">⚑ Flag for review</button>
                                <button class="btn btn-ghost">↻ Re-index chunk</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View 5: Pipeline Health -->
                <div id="view-pipelines" class="view">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="text-xl font-semibold text-white">Ingestion Pipelines</h1>
                        <button class="btn btn-primary">+ New Pipeline</button>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 32px;">
                        <!-- Failing Pipeline -->
                        <div class="card card-clickable p-5">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="status-dot error"></span>
                                        <h3 class="font-semibold text-white">policy-docs-v2</h3>
                                    </div>
                                    <p class="text-xs text-gray-500">Last run: 3 hours ago</p>
                                </div>
                                <span class="score-badge error">Unhealthy</span>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4 mb-4">
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Chunks</p>
                                    <p class="text-lg font-semibold text-white">1,247</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Health</p>
                                    <p class="text-lg font-semibold status-error">0.58</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Trend</p>
                                    <p class="text-lg font-semibold status-error">▼</p>
                                </div>
                            </div>

                            <div class="sparkline">
                                <div class="sparkline-bar" style="height: 85%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 80%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 70%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 60%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 55%; background: rgba(245,158,11,0.6)"></div>
                                <div class="sparkline-bar" style="height: 45%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 40%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 35%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 30%; background: rgba(239,68,68,0.6)"></div>
                                <div class="sparkline-bar" style="height: 25%; background: #EF4444"></div>
                            </div>
                        </div>

                        <!-- Healthy Pipeline -->
                        <div class="card card-clickable p-5">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="status-dot success"></span>
                                        <h3 class="font-semibold text-white">faq-pipeline</h3>
                                    </div>
                                    <p class="text-xs text-gray-500">Last run: 1 hour ago</p>
                                </div>
                                <span class="score-badge success">Healthy</span>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4 mb-4">
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Chunks</p>
                                    <p class="text-lg font-semibold text-white">892</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Health</p>
                                    <p class="text-lg font-semibold status-success">0.91</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 mb-1">Trend</p>
                                    <p class="text-lg font-semibold status-success">▲</p>
                                </div>
                            </div>

                            <div class="sparkline">
                                <div class="sparkline-bar" style="height: 75%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 80%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 82%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 85%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 87%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 88%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 90%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 89%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 91%; background: rgba(16,185,129,0.6)"></div>
                                <div class="sparkline-bar" style="height: 91%; background: #10B981"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Runs Table -->
                    <div class="card">
                        <div class="p-4 divider">
                            <div class="flex items-center justify-between">
                                <h3 class="font-medium text-white">Recent Ingestion Runs</h3>
                                <button class="text-sm link-purple">View All →</button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Pipeline</th>
                                    <th>Run ID</th>
                                    <th>Status</th>
                                    <th>Chunks</th>
                                    <th>Health</th>
                                    <th>Timestamp</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-white">policy-docs-v2</td>
                                    <td class="font-mono text-gray-400">ing_8f2a</td>
                                    <td><span class="status-success">✓ Complete</span></td>
                                    <td class="text-white">+124</td>
                                    <td><span class="status-error">0.52 ▼</span></td>
                                    <td class="text-gray-400">3h ago</td>
                                </tr>
                                <tr>
                                    <td class="text-white">faq-pipeline</td>
                                    <td class="font-mono text-gray-400">ing_7b3c</td>
                                    <td><span class="status-success">✓ Complete</span></td>
                                    <td class="text-white">+89</td>
                                    <td><span class="status-success">0.93</span></td>
                                    <td class="text-gray-400">1h ago</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View 6: Chunk Explorer -->
                <div id="view-chunks" class="view">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="text-xl font-semibold text-white">Chunk Explorer</h1>
                        <div class="flex items-center gap-3">
                            <button class="btn btn-ghost">↓ Export</button>
                            <button class="btn btn-primary">↻ Re-index Selected</button>
                        </div>
                    </div>

                    <div class="filter-bar mb-6">
                        <div class="search-box" style="flex: 1;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text" placeholder="Search chunks by content or ID...">
                        </div>
                        <select class="filter-select">
                            <option>All Pipelines</option>
                            <option>policy-docs-v2</option>
                            <option>faq-pipeline</option>
                        </select>
                        <select class="filter-select">
                            <option>All Scores</option>
                            <option>Below 0.5</option>
                            <option>0.5 - 0.8</option>
                            <option>Above 0.8</option>
                        </select>
                    </div>

                    <div class="card overflow-hidden">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 32px;"><input type="checkbox"></th>
                                    <th>Chunk ID</th>
                                    <th>Source Document</th>
                                    <th>Pipeline</th>
                                    <th>Retrievals</th>
                                    <th>Avg Score</th>
                                    <th>Created</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="cursor: pointer;" data-nav="chunk-lineage">
                                    <td><input type="checkbox"></td>
                                    <td class="font-mono text-purple-400">chunk_8a2d</td>
                                    <td class="text-white">refunds.pdf</td>
                                    <td class="text-gray-400">policy-docs-v2</td>
                                    <td class="text-white">47</td>
                                    <td><span class="status-warning">0.62</span></td>
                                    <td class="text-gray-400">Jan 15</td>
                                    <td class="text-gray-500">›</td>
                                </tr>
                                <tr style="cursor: pointer;" data-nav="chunk-lineage">
                                    <td><input type="checkbox"></td>
                                    <td class="font-mono text-purple-400">chunk_f91b</td>
                                    <td class="text-white">returns.pdf</td>
                                    <td class="text-gray-400">policy-docs-v2</td>
                                    <td class="text-white">89</td>
                                    <td><span class="status-success">0.87</span></td>
                                    <td class="text-gray-400">Jan 15</td>
                                    <td class="text-gray-500">›</td>
                                </tr>
                                <tr style="cursor: pointer;" data-nav="chunk-lineage">
                                    <td><input type="checkbox"></td>
                                    <td class="font-mono text-purple-400">chunk_2c4e</td>
                                    <td class="text-white">faq-general.md</td>
                                    <td class="text-gray-400">faq-pipeline</td>
                                    <td class="text-white">156</td>
                                    <td><span class="status-success">0.92</span></td>
                                    <td class="text-gray-400">Jan 14</td>
                                    <td class="text-gray-500">›</td>
                                </tr>
                                <tr style="cursor: pointer;" data-nav="chunk-lineage">
                                    <td><input type="checkbox"></td>
                                    <td class="font-mono text-purple-400">chunk_7d3f</td>
                                    <td class="text-white">shipping.pdf</td>
                                    <td class="text-gray-400">policy-docs-v2</td>
                                    <td class="text-white">34</td>
                                    <td><span class="status-error">0.41</span></td>
                                    <td class="text-gray-400">Jan 14</td>
                                    <td class="text-gray-500">›</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="table-footer flex items-center justify-between">
                            <p class="text-sm text-gray-500">Showing 1-4 of 8,901 chunks</p>
                            <div class="flex items-center gap-2">
                                <button class="pagination-btn">Previous</button>
                                <button class="pagination-btn active">1</button>
                                <button class="pagination-btn">2</button>
                                <button class="pagination-btn">3</button>
                                <button class="pagination-btn">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View 7: Agents -->
                <div id="view-agents" class="view active" style="display: flex; flex-direction: column; height: 100%; overflow: hidden;">
                    <!-- Agents Registry List (Preact DataTable) -->
                    <div id="agents-table-root" style="flex: 1; min-height: 0; overflow: hidden;"></div>
                </div>

                <!-- View: Agent Detail — Customer Support Bot (Preact-rendered) -->
                <div id="view-agent-detail-cs" class="view">
                    <div id="agent-detail-cs-root"></div>
                </div>

                <!-- View: Agent Deployments (extracted from agent detail) -->
                <div id="view-agent-deployments" class="view">
                    <div id="agent-deployments-root"></div>
                </div>

                <!-- View: Agent Evaluations (extracted from agent detail) -->
                <div id="view-agent-evaluations" class="view">
                    <div id="agent-evaluations-root"></div>
                </div>

                <!-- View: Agent Analytics -->
                <div id="view-agent-analytics" class="view">
                    <div id="agent-analytics-root"></div>
                </div>

                <!-- View: Agent Detail — Product Advisor Agent (Preact) -->
                <div id="view-agent-detail-pa" class="view">
                    <div id="agent-detail-pa-root"></div>
                </div>

                <!-- View: Database Detail — product-knowledge-store -->
                <div id="view-db-detail-pks" class="view">
                    <div class="flex items-center gap-4 mb-6">
                        <button class="btn-icon" data-nav="databases">←</button>
                        <div class="flex items-center gap-3 flex-1">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #7C3AED 0%, #5B21B6 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 18px;">▤</span>
                            </div>
                            <div>
                                <h1 class="text-xl font-semibold text-white">product-knowledge-store</h1>
                                <p class="text-sm text-gray-500 mt-0">ChromaDB · us-east-1</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="status-dot warning"></span>
                            <span class="text-sm status-warning">Issues</span>
                        </div>
                    </div>

                    <!-- Alert -->
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.25); border-radius: var(--radius-md); padding: 10px 14px; margin-bottom: 24px;">
                        <div class="flex items-center gap-2">
                            <span style="font-size: 14px;">⚠️</span>
                            <p class="text-sm text-white flex-1">3 malformed chunks detected — affecting 12 traces across 1 agent</p>
                            <span class="text-primary text-xs" style="cursor: pointer;" data-nav="chunks">Inspect Chunks →</span>
                        </div>
                    </div>

                    <!-- Concise Component Summary -->
                    <div class="card p-4 mb-6">
                        <div class="flex items-center gap-6 flex-wrap">
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">🗄️</span><span class="text-xs text-gray-400">Engine</span><span class="text-xs text-white font-medium">ChromaDB v0.4.22</span></div>
                            <span class="text-gray-600">|</span>
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">✂️</span><span class="text-xs text-gray-400">Chunking</span><span class="text-xs text-white font-medium">512 tok / 64 overlap</span></div>
                            <span class="text-gray-600">|</span>
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">📂</span><span class="text-xs text-gray-400">Sources</span><span class="text-xs text-white font-medium">47 docs · S3</span></div>
                        </div>
                    </div>

                    <!-- Service Map -->
                    <h2 class="text-sm text-gray-500 uppercase font-semibold mb-3">Service Map</h2>
                    <div class="card p-6 mb-6">
                        <div id="svc-graph-db-pks"></div>
                    </div>

                    <!-- Deployments -->
                    <h2 class="text-sm text-gray-500 uppercase font-semibold mb-3">Deployments</h2>
                    <div class="card overflow-hidden">
                        <table class="table-compact">
                            <thead>
                                <tr>
                                    <th>Instance</th>
                                    <th>Environment</th>
                                    <th>Host</th>
                                    <th>Status</th>
                                    <th>Chunks</th>
                                    <th>Last Synced</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="card-clickable" data-nav="deployment-pks-prod" style="cursor: pointer;">
                                    <td class="text-white font-medium">pks-prod</td>
                                    <td><span class="score-badge" style="font-size: 10px; padding: 1px 6px; background: rgba(245,158,11,0.15); border-color: rgba(245,158,11,0.3); color: #F59E0B;">production ⚠</span></td>
                                    <td class="font-mono text-gray-400 text-xs">chroma-prod.internal:8000</td>
                                    <td><span class="status-warning">● Issues</span></td>
                                    <td class="text-white">8,901</td>
                                    <td class="text-gray-400">2h ago</td>
                                    <td class="text-gray-500">›</td>
                                </tr>
                                <tr style="cursor: pointer;">
                                    <td class="text-white font-medium">pks-staging</td>
                                    <td><span class="score-badge" style="font-size: 10px; padding: 1px 6px; background: rgba(59,130,246,0.15); border-color: rgba(59,130,246,0.3); color: #3B82F6;">staging</span></td>
                                    <td class="font-mono text-gray-400 text-xs">chroma-stg.internal:8000</td>
                                    <td><span class="status-success">● Healthy</span></td>
                                    <td class="text-white">8,901</td>
                                    <td class="text-gray-400">6h ago</td>
                                    <td class="text-gray-500">›</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View: Database Detail — support-articles-store -->
                <div id="view-db-detail-sas" class="view">
                    <div class="flex items-center gap-4 mb-6">
                        <button class="btn-icon" data-nav="databases">←</button>
                        <div class="flex items-center gap-3 flex-1">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 18px;">▤</span>
                            </div>
                            <div>
                                <h1 class="text-xl font-semibold text-white">support-articles-store</h1>
                                <p class="text-sm text-gray-500 mt-0">Milvus · us-west-2</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="status-dot success"></span>
                            <span class="text-sm status-success">Healthy</span>
                        </div>
                    </div>

                    <!-- Concise Component Summary -->
                    <div class="card p-4 mb-6">
                        <div class="flex items-center gap-6 flex-wrap">
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">🗄️</span><span class="text-xs text-gray-400">Engine</span><span class="text-xs text-white font-medium">Milvus</span></div>
                            <span class="text-gray-600">|</span>
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">✂️</span><span class="text-xs text-gray-400">Chunking</span><span class="text-xs text-white font-medium">256 tok / 32 overlap</span></div>
                            <span class="text-gray-600">|</span>
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">📂</span><span class="text-xs text-gray-400">Sources</span><span class="text-xs text-white font-medium">128 docs · Zendesk</span></div>
                        </div>
                    </div>

                    <!-- Service Map -->
                    <h2 class="text-sm text-gray-500 uppercase font-semibold mb-3">Service Map</h2>
                    <div class="card p-6 mb-6">
                        <div id="svc-graph-db-sas"></div>
                    </div>

                    <!-- Deployments -->
                    <h2 class="text-sm text-gray-500 uppercase font-semibold mb-3">Deployments</h2>
                    <div class="card overflow-hidden">
                        <table class="table-compact">
                            <thead>
                                <tr>
                                    <th>Instance</th>
                                    <th>Environment</th>
                                    <th>Host</th>
                                    <th>Status</th>
                                    <th>Chunks</th>
                                    <th>Last Synced</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="cursor: pointer;">
                                    <td class="text-white font-medium">sas-prod</td>
                                    <td><span class="score-badge success" style="font-size: 10px; padding: 1px 6px;">production</span></td>
                                    <td class="font-mono text-gray-400 text-xs">sas-prod-abc123.milvus.svc.cluster.local</td>
                                    <td><span class="status-success">● Healthy</span></td>
                                    <td class="text-white">3,214</td>
                                    <td class="text-gray-400">6h ago</td>
                                    <td class="text-gray-500">›</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View: Database Detail — support-articles-store (stale snapshot) -->
                <div id="view-db-detail-sas-stale" class="view">
                    <div class="flex items-center gap-4 mb-6">
                        <button class="btn-icon" data-nav="deployment-cs-openai">←</button>
                        <div class="flex items-center gap-3 flex-1">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 18px;">▤</span>
                            </div>
                            <div>
                                <h1 class="text-xl font-semibold text-white">support-articles-store</h1>
                                <p class="text-sm text-gray-500 mt-0">Milvus · us-west-2 · snapshot@2025-12-18</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="status-dot warning"></span>
                            <span class="text-sm status-warning">Stale</span>
                        </div>
                    </div>

                    <div class="card mb-6" style="border-left: 3px solid var(--color-warning); padding: 14px 18px;">
                        <div class="flex items-start gap-3">
                            <div class="flex-1">
                                <h3 class="text-white font-semibold" style="font-size: 14px; margin-bottom: 4px;">Stale snapshot detected</h3>
                                <p class="text-sm text-gray-400" style="margin-bottom: 8px;">
                                    This deployment is using <span class="font-mono text-gray-300">snapshot@2025-12-18</span>, which is 50 days behind the latest snapshot (<span class="font-mono text-gray-300">snapshot@2026-02-06</span>). Stale vector data may contribute to inaccurate or incomplete chunk retrieval.
                                </p>
                                <div class="flex items-center gap-3" style="flex-wrap: wrap;">
                                    <span class="inline-callout inline-callout--warning"><span class="inline-callout__text">Latest: snapshot@2026-02-06</span></span>
                                    <span class="inline-callout inline-callout--warning"><span class="inline-callout__text">Deployed: snapshot@2025-12-18</span></span>
                                    <span class="inline-callout inline-callout--warning"><span class="inline-callout__text">Drift: 50 days</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Concise Component Summary -->
                    <div class="card p-4 mb-6">
                        <div class="flex items-center gap-6 flex-wrap">
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">🗄️</span><span class="text-xs text-gray-400">Engine</span><span class="text-xs text-white font-medium">Milvus</span></div>
                            <span class="text-gray-600">|</span>
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">✂️</span><span class="text-xs text-gray-400">Chunking</span><span class="text-xs text-white font-medium">256 tok / 32 overlap</span></div>
                            <span class="text-gray-600">|</span>
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">📂</span><span class="text-xs text-gray-400">Sources</span><span class="text-xs text-white font-medium">112 docs · Zendesk</span></div>
                            <span class="text-gray-600">|</span>
                            <div class="flex items-center gap-2"><span style="font-size: 13px;">📐</span><span class="text-xs text-gray-400">Chunks</span><span class="text-xs text-white font-medium">2,847</span></div>
                        </div>
                    </div>

                    <h2 class="text-sm text-gray-500 uppercase font-semibold mb-3">Snapshot Comparison</h2>
                    <div class="card overflow-hidden mb-6">
                        <table class="table-compact">
                            <thead>
                                <tr>
                                    <th>Snapshot</th>
                                    <th>Docs</th>
                                    <th>Chunks</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font-mono text-gray-300 text-xs">snapshot@2026-02-06</td>
                                    <td class="text-white">128</td>
                                    <td class="text-white">3,214</td>
                                    <td><span class="status-success">● Latest</span></td>
                                    <td class="text-gray-400">6h ago</td>
                                </tr>
                                <tr style="background: rgba(245,158,11,0.05);">
                                    <td class="font-mono text-yellow-400 text-xs">snapshot@2025-12-18 ← deployed</td>
                                    <td class="text-white">112</td>
                                    <td class="text-white">2,847</td>
                                    <td><span class="status-warning">● Stale</span></td>
                                    <td class="text-gray-400">50d ago</td>
                                </tr>
                                <tr>
                                    <td class="font-mono text-gray-300 text-xs">snapshot@2025-11-30</td>
                                    <td class="text-gray-400">105</td>
                                    <td class="text-gray-400">2,610</td>
                                    <td><span class="text-gray-500">Archived</span></td>
                                    <td class="text-gray-400">68d ago</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View: Deployment Detail — Product Advisor prod -->
                <div id="view-deployment-pa-prod" class="view">
                    <div id="deployment-pa-prod-root"></div>
                </div>

                <!-- View: Deployment Detail — Customer Support prod -->
                <div id="view-deployment-cs-prod" class="view">
                    <div id="deployment-cs-prod-root"></div>
                </div>

                <!-- View: Deployment Usage — Customer Support prod -->
                <div id="view-deployment-cs-prod-usage" class="view">
                    <div id="deployment-cs-prod-usage-root"></div>
                </div>

                <!-- View: Deployment Detail — Customer Support (OpenAI hosted) -->
                <div id="view-deployment-cs-openai" class="view">
                    <div id="deployment-cs-openai-root"></div>
                </div>

                <!-- View: Deployment Alert — cs-bot-openai (Analytics SLO) -->
                <div id="view-deployment-alert-cs-openai-feedback" class="view">
                    <div id="deployment-alert-cs-openai-feedback-root"></div>
                </div>

                <!-- View: Deployment Alerts Inbox -->
                <div id="view-deployment-alerts" class="view">
                    <div id="deployment-alerts-root"></div>
                </div>

                <!-- View: Deployment Detail — Customer Support (Edge) -->
                <div id="view-deployment-cs-edge" class="view">
                    <div id="deployment-cs-edge-root"></div>
                </div>

                <!-- View: Deployment Detail — Customer Support (Bedrock) -->
                <div id="view-deployment-cs-bedrock" class="view">
                    <div id="deployment-cs-bedrock-root"></div>
                </div>

                <!-- View: Deployment Detail — product-knowledge-store prod -->
                <div id="view-deployment-pks-prod" class="view">
                    <div id="deployment-pks-prod-root"></div>
                </div>

                    </div><!-- /.views-scroll -->
            </div><!-- /.content-area -->
            </main>
        </div>
    </div>

    <!-- Side Panel for Retriever Details -->
    <div class="side-panel-overlay" id="sidePanelOverlay"></div>
    <div class="side-panel" id="sidePanel">
        <div class="p-6" style="overflow-y: auto; height: 100%;">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-lg font-semibold text-white">Retriever Span</h2>
                <button class="btn-icon" data-action="close-panel">✕</button>
            </div>

            <!-- Span Metadata -->
            <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;">
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Name</span>
                    <span class="text-white font-mono">semantic_search</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Duration</span>
                    <span class="text-white">142ms</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Timestamp</span>
                    <span class="text-white">2024-01-15 14:32:15</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-gray-500">Vector Store</span>
                    <span class="text-primary font-mono" style="cursor: pointer;" data-nav="databases" data-action="close-panel">▤ product-knowledge-store →</span>
                </div>
            </div>

            <!-- Alert: Malformed Chunk Detected -->
            <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 14px; margin-bottom: 20px;">
                <div class="flex items-start gap-3">
                    <span style="font-size: 16px; line-height: 1;">⚠️</span>
                    <div>
                        <p class="text-sm font-semibold text-white mb-1">Malformed chunk detected</p>
                        <p class="text-xs text-gray-400 mb-2">chunk_8a2d7f3e contains truncated content and mismatched metadata. This chunk was ingested with incorrect byte-offset boundaries, resulting in a partial sentence that misleads the LLM.</p>
                        <div class="flex items-center gap-3">
                            <span class="text-xs" style="color: var(--color-error);">Faithfulness impact: -0.49</span>
                            <span class="text-xs text-gray-500">·</span>
                            <span class="text-xs text-gray-400">Affects 12 traces</span>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="text-sm font-medium text-gray-400 mb-4">Retrieved Documents (5)</h3>

            <div style="display: flex; flex-direction: column; gap: 12px;">
                <!-- Problematic Chunk (malformed) -->
                <div class="chunk-card problematic" data-nav="chunk-lineage" data-action="close-panel">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="font-mono text-xs text-purple-400">chunk_8a2d7f3e</span>
                            <span class="score-badge error" style="font-size: 10px; padding: 1px 6px;">MALFORMED</span>
                        </div>
                        <span class="score-badge error">⚠ 0.31</span>
                    </div>
                    <p class="text-sm text-gray-300 line-clamp-2 mb-2" style="border-left: 2px solid var(--color-error); padding-left: 8px;">"Refunds for damaged items must be requested within 30 days of purchase. Please provide photos...</p>
                    <p class="text-xs mb-2" style="color: var(--color-error); opacity: 0.8;">⚑ Truncated at byte offset 2048 — sentence incomplete, missing policy details</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">refunds.pdf · <span class="text-primary" style="cursor: pointer;" data-nav="databases" data-action="close-panel">product-knowledge-store</span></span>
                        <span class="text-xs link-purple">Trace Lineage →</span>
                    </div>
                </div>

                <!-- Good Chunk -->
                <div class="chunk-card">
                    <div class="flex items-start justify-between mb-2">
                        <span class="font-mono text-xs text-purple-400">chunk_f91bc2e4</span>
                        <span class="score-badge success">✓ 0.82</span>
                    </div>
                    <p class="text-sm text-gray-300 line-clamp-2 mb-2">"Our return policy allows for full refunds on undamaged items within 30 days. Simply contact..."</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">returns.pdf · product-knowledge-store</span>
                        <span class="text-xs link-purple">Trace Lineage →</span>
                    </div>
                </div>

                <!-- Neutral Chunk -->
                <div class="chunk-card">
                    <div class="flex items-start justify-between mb-2">
                        <span class="font-mono text-xs text-purple-400">chunk_2c4e8f1a</span>
                        <span class="score-badge" style="background: rgba(107,114,128,0.15); border-color: rgba(107,114,128,0.3); color: #9CA3AF;">0.67</span>
                    </div>
                    <p class="text-sm text-gray-300 line-clamp-2 mb-2">"For warranty claims, please contact our support team with your order number and a description..."</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">warranty.pdf · product-knowledge-store</span>
                        <span class="text-xs link-purple">Trace Lineage →</span>
                    </div>
                </div>

                <div class="chunk-card">
                    <div class="flex items-start justify-between mb-2">
                        <span class="font-mono text-xs text-purple-400">chunk_7d3fb9c2</span>
                        <span class="score-badge success">✓ 0.79</span>
                    </div>
                    <p class="text-sm text-gray-300 line-clamp-2 mb-2">"Customer satisfaction is our priority. If you're not happy with your purchase, we offer..."</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">satisfaction.pdf · product-knowledge-store</span>
                        <span class="text-xs link-purple">Trace Lineage →</span>
                    </div>
                </div>

                <div class="chunk-card">
                    <div class="flex items-start justify-between mb-2">
                        <span class="font-mono text-xs text-purple-400">chunk_a1b3c5d7</span>
                        <span class="score-badge success">✓ 0.74</span>
                    </div>
                    <p class="text-sm text-gray-300 line-clamp-2 mb-2">"Exchanges can be made for items of equal or lesser value. Visit any store location or..."</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">exchanges.pdf · product-knowledge-store</span>
                        <span class="text-xs link-purple">Trace Lineage →</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================================================
         Vendor (inlined): Preact + Hooks + htm
         Self-contained for securedesign CSP
         ================================================== -->
    <script>
!function(n){"function"==typeof define&&define.amd?define(n):n()}(function(){var n,l,t,u,i,o,r,e,f,c,s=65536,a=1<<17,h={},v=[],d=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,p=Array.isArray;function y(n,l){for(var t in l)n[t]=l[t];return n}function _(n){var l=n.parentNode;l&&l.removeChild(n)}function m(l,t,u){var i,o,r,e={};for(r in t)"key"==r?i=t[r]:"ref"==r?o=t[r]:e[r]=t[r];if(arguments.length>2&&(e.children=arguments.length>3?n.call(arguments,2):u),"function"==typeof l&&null!=l.defaultProps)for(r in l.defaultProps)void 0===e[r]&&(e[r]=l.defaultProps[r]);return g(l,e,i,o,null)}function g(n,u,i,o,r){var e={type:n,props:u,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==r?++t:r,__i:-1,__u:0};return null==r&&null!=l.vnode&&l.vnode(e),e}function b(n){return n.children}function w(n,l){this.props=n,this.context=l}function k(n,l){if(null==l)return n.__?k(n.__,n.__i+1):null;for(var t;l<n.__k.length;l++)if(null!=(t=n.__k[l])&&null!=t.__e)return t.__e;return"function"==typeof n.type?k(n):null}function C(n,t,u){var i,o=n.__v,r=o.__e,e=n.__P;if(e)return(i=y({},o)).__v=o.__v+1,l.vnode&&l.vnode(i),M(e,i,o,n.__n,void 0!==e.ownerSVGElement,32&o.__u?[r]:null,t,null==r?k(o):r,!!(32&o.__u),u),i.__v=o.__v,i.__.__k[i.__i]=i,i.__d=void 0,i.__e!=r&&x(i),i}function x(n){var l,t;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(t=n.__k[l])&&null!=t.__e){n.__e=n.__c.base=t.__e;break}return x(n)}}function P(n){(!n.__d&&(n.__d=!0)&&i.push(n)&&!S.__r++||o!==l.debounceRendering)&&((o=l.debounceRendering)||r)(S)}function S(){var n,t,u,o=[],r=[];for(i.sort(e);n=i.shift();)n.__d&&(u=i.length,t=C(n,o,r)||t,0===u||i.length>u?(j(o,t,r),r.length=o.length=0,t=void 0,i.sort(e)):t&&l.__c&&l.__c(t,v));t&&j(o,t,r),S.__r=0}function $(n,l,t,u,i,o,r,e,f,c,a){var d,p,y,_,m,g=u&&u.__k||v,b=l.length;for(t.__d=f,A(t,l,g),f=t.__d,d=0;d<b;d++)null!=(y=t.__k[d])&&"boolean"!=typeof y&&"function"!=typeof y&&(p=-1===y.__i?h:g[y.__i]||h,y.__i=d,M(n,y,p,i,o,r,e,f,c,a),_=y.__e,y.ref&&p.ref!=y.ref&&(p.ref&&F(p.ref,null,y),a.push(y.ref,y.__c||_,y)),null==m&&null!=_&&(m=_),y.__u&s||p.__k===y.__k?f=E(y,f,n):"function"==typeof y.type&&void 0!==y.__d?f=y.__d:_&&(f=_.nextSibling),y.__d=void 0,y.__u&=-196609);t.__d=f,t.__e=m}function A(n,l,t){var u,i,o,r,e,f=l.length,c=t.length,h=c,v=0;for(n.__k=[],u=0;u<f;u++)r=u+v,null!=(i=n.__k[u]=null==(i=l[u])||"boolean"==typeof i||"function"==typeof i?null:"string"==typeof i||"number"==typeof i||"bigint"==typeof i||i.constructor==String?g(null,i,null,null,null):p(i)?g(b,{children:i},null,null,null):void 0===i.constructor&&i.__b>0?g(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i)?(i.__=n,i.__b=n.__b+1,e=H(i,t,r,h),i.__i=e,o=null,-1!==e&&(h--,(o=t[e])&&(o.__u|=a)),null==o||null===o.__v?(-1==e&&v--,"function"!=typeof i.type&&(i.__u|=s)):e!==r&&(e===r+1?v++:e>r?h>f-r?v+=e-r:v--:e<r?e==r-1&&(v=e-r):v=0,e!==u+v&&(i.__u|=s))):(o=t[r])&&null==o.key&&o.__e&&0==(o.__u&a)&&(o.__e==n.__d&&(n.__d=k(o)),N(o,o,!1),t[r]=null,h--);if(h)for(u=0;u<c;u++)null!=(o=t[u])&&0==(o.__u&a)&&(o.__e==n.__d&&(n.__d=k(o)),N(o,o))}function E(n,l,t){var u,i;if("function"==typeof n.type){for(u=n.__k,i=0;u&&i<u.length;i++)u[i]&&(u[i].__=n,l=E(u[i],l,t));return l}n.__e!=l&&(t.insertBefore(n.__e,l||null),l=n.__e);do{l=l&&l.nextSibling}while(null!=l&&8===l.nodeType);return l}function H(n,l,t,u){var i=n.key,o=n.type,r=t-1,e=t+1,f=l[t];if(null===f||f&&i==f.key&&o===f.type&&0==(f.__u&a))return t;if(u>(null!=f&&0==(f.__u&a)?1:0))for(;r>=0||e<l.length;){if(r>=0){if((f=l[r])&&0==(f.__u&a)&&i==f.key&&o===f.type)return r;r--}if(e<l.length){if((f=l[e])&&0==(f.__u&a)&&i==f.key&&o===f.type)return e;e++}}return-1}function I(n,l,t){"-"===l[0]?n.setProperty(l,null==t?"":t):n[l]=null==t?"":"number"!=typeof t||d.test(l)?t:t+"px"}function T(n,l,t,u,i){var o;n:if("style"===l)if("string"==typeof t)n.style.cssText=t;else{if("string"==typeof u&&(n.style.cssText=u=""),u)for(l in u)t&&l in t||I(n.style,l,"");if(t)for(l in t)u&&t[l]===u[l]||I(n.style,l,t[l])}else if("o"===l[0]&&"n"===l[1])o=l!==(l=l.replace(/(PointerCapture)$|Capture$/i,"$1")),l=l.toLowerCase()in n?l.toLowerCase().slice(2):l.slice(2),n.l||(n.l={}),n.l[l+o]=t,t?u?t.t=u.t:(t.t=Date.now(),n.addEventListener(l,o?L:D,o)):n.removeEventListener(l,o?L:D,o);else{if(i)l=l.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==l&&"height"!==l&&"href"!==l&&"list"!==l&&"form"!==l&&"tabIndex"!==l&&"download"!==l&&"rowSpan"!==l&&"colSpan"!==l&&"role"!==l&&l in n)try{n[l]=null==t?"":t;break n}catch(n){}"function"==typeof t||(null==t||!1===t&&"-"!==l[4]?n.removeAttribute(l):n.setAttribute(l,t))}}function D(n){if(this.l){var t=this.l[n.type+!1];if(n.u){if(n.u<=t.t)return}else n.u=Date.now();return t(l.event?l.event(n):n)}}function L(n){if(this.l)return this.l[n.type+!0](l.event?l.event(n):n)}function M(n,t,u,i,o,r,e,f,c,s){var a,h,v,d,_,m,g,k,C,x,P,S,A,E,H,I=t.type;if(void 0!==t.constructor)return null;128&u.__u&&(c=!!(32&u.__u),r=[f=t.__e=u.__e]),(a=l.__b)&&a(t);n:if("function"==typeof I)try{if(k=t.props,C=(a=I.contextType)&&i[a.__c],x=a?C?C.props.value:a.__:i,u.__c?g=(h=t.__c=u.__c).__=h.__E:("prototype"in I&&I.prototype.render?t.__c=h=new I(k,x):(t.__c=h=new w(k,x),h.constructor=I,h.render=O),C&&C.sub(h),h.props=k,h.state||(h.state={}),h.context=x,h.__n=i,v=h.__d=!0,h.__h=[],h._sb=[]),null==h.__s&&(h.__s=h.state),null!=I.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=y({},h.__s)),y(h.__s,I.getDerivedStateFromProps(k,h.__s))),d=h.props,_=h.state,h.__v=t,v)null==I.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==I.getDerivedStateFromProps&&k!==d&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(k,x),!h.__e&&(null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(k,h.__s,x)||t.__v===u.__v)){for(t.__v!==u.__v&&(h.props=k,h.state=h.__s,h.__d=!1),t.__e=u.__e,t.__k=u.__k,t.__k.forEach(function(n){n&&(n.__=t)}),P=0;P<h._sb.length;P++)h.__h.push(h._sb[P]);h._sb=[],h.__h.length&&e.push(h);break n}null!=h.componentWillUpdate&&h.componentWillUpdate(k,h.__s,x),null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(d,_,m)})}if(h.context=x,h.props=k,h.__P=n,h.__e=!1,S=l.__r,A=0,"prototype"in I&&I.prototype.render){for(h.state=h.__s,h.__d=!1,S&&S(t),a=h.render(h.props,h.state,h.context),E=0;E<h._sb.length;E++)h.__h.push(h._sb[E]);h._sb=[]}else do{h.__d=!1,S&&S(t),a=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++A<25);h.state=h.__s,null!=h.getChildContext&&(i=y(y({},i),h.getChildContext())),v||null==h.getSnapshotBeforeUpdate||(m=h.getSnapshotBeforeUpdate(d,_)),$(n,p(H=null!=a&&a.type===b&&null==a.key?a.props.children:a)?H:[H],t,u,i,o,r,e,f,c,s),h.base=t.__e,t.__u&=-161,h.__h.length&&e.push(h),g&&(h.__E=h.__=null)}catch(n){t.__v=null,c||null!=r?(t.__e=f,t.__u|=c?160:32,r[r.indexOf(f)]=null):(t.__e=u.__e,t.__k=u.__k),l.__e(n,t,u)}else null==r&&t.__v===u.__v?(t.__k=u.__k,t.__e=u.__e):t.__e=z(u.__e,t,u,i,o,r,e,c,s);(a=l.diffed)&&a(t)}function j(n,t,u){for(var i=0;i<u.length;i++)F(u[i],u[++i],u[++i]);l.__c&&l.__c(t,n),n.some(function(t){try{n=t.__h,t.__h=[],n.some(function(n){n.call(t)})}catch(n){l.__e(n,t.__v)}})}function z(l,t,u,i,o,r,e,f,c){var s,a,v,d,y,m,g,b=u.props,w=t.props,C=t.type;if("svg"===C&&(o=!0),null!=r)for(s=0;s<r.length;s++)if((y=r[s])&&"setAttribute"in y==!!C&&(C?y.localName===C:3===y.nodeType)){l=y,r[s]=null;break}if(null==l){if(null===C)return document.createTextNode(w);l=o?document.createElementNS("http://www.w3.org/2000/svg",C):document.createElement(C,w.is&&w),r=null,f=!1}if(null===C)b===w||f&&l.data===w||(l.data=w);else{if(r=r&&n.call(l.childNodes),b=u.props||h,!f&&null!=r)for(b={},s=0;s<l.attributes.length;s++)b[(y=l.attributes[s]).name]=y.value;for(s in b)y=b[s],"children"==s||("dangerouslySetInnerHTML"==s?v=y:"key"===s||s in w||T(l,s,null,y,o));for(s in w)y=w[s],"children"==s?d=y:"dangerouslySetInnerHTML"==s?a=y:"value"==s?m=y:"checked"==s?g=y:"key"===s||f&&"function"!=typeof y||b[s]===y||T(l,s,y,b[s],o);if(a)f||v&&(a.__html===v.__html||a.__html===l.innerHTML)||(l.innerHTML=a.__html),t.__k=[];else if(v&&(l.innerHTML=""),$(l,p(d)?d:[d],t,u,i,o&&"foreignObject"!==C,r,e,r?r[0]:u.__k&&k(u,0),f,c),null!=r)for(s=r.length;s--;)null!=r[s]&&_(r[s]);f||(s="value",void 0!==m&&(m!==l[s]||"progress"===C&&!m||"option"===C&&m!==b[s])&&T(l,s,m,b[s],!1),s="checked",void 0!==g&&g!==l[s]&&T(l,s,g,b[s],!1))}return l}function F(n,t,u){try{"function"==typeof n?n(t):n.current=t}catch(n){l.__e(n,u)}}function N(n,t,u){var i,o;if(l.unmount&&l.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||F(i,null,t)),null!=(i=n.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){l.__e(n,t)}i.base=i.__P=null,n.__c=void 0}if(i=n.__k)for(o=0;o<i.length;o++)i[o]&&N(i[o],t,u||"function"!=typeof n.type);u||null==n.__e||_(n.__e),n.__=n.__e=n.__d=void 0}function O(n,l,t){return this.constructor(n,t)}function R(t,u,i){var o,r,e,f;l.__&&l.__(t,u),r=(o="function"==typeof i)?null:i&&i.__k||u.__k,e=[],f=[],M(u,t=(!o&&i||u).__k=m(b,null,[t]),r||h,h,void 0!==u.ownerSVGElement,!o&&i?[i]:r?null:u.firstChild?n.call(u.childNodes):null,e,!o&&i?i:r?r.__e:u.firstChild,o,f),t.__d=void 0,j(e,t,f)}n=v.slice,l={__e:function(n,l,t,u){for(var i,o,r;l=l.__;)if((i=l.__c)&&!i.__)try{if((o=i.constructor)&&null!=o.getDerivedStateFromError&&(i.setState(o.getDerivedStateFromError(n)),r=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(n,u||{}),r=i.__d),r)return i.__E=i}catch(l){n=l}throw n}},t=0,u=function(n){return null!=n&&null==n.constructor},w.prototype.setState=function(n,l){var t;t=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=y({},this.state),"function"==typeof n&&(n=n(y({},t),this.props)),n&&y(t,n),null!=n&&this.__v&&(l&&this._sb.push(l),P(this))},w.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),P(this))},w.prototype.render=b,i=[],r="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e=function(n,l){return n.__v.__b-l.__v.__b},S.__r=0,f=0,c={__proto__:null,render:R,hydrate:function n(l,t){R(l,t,n)},createElement:m,h:m,Fragment:b,createRef:function(){return{current:null}},isValidElement:u,Component:w,cloneElement:function(l,t,u){var i,o,r,e,f=y({},l.props);for(r in l.type&&l.type.defaultProps&&(e=l.type.defaultProps),t)"key"==r?i=t[r]:"ref"==r?o=t[r]:f[r]=void 0===t[r]&&void 0!==e?e[r]:t[r];return arguments.length>2&&(f.children=arguments.length>3?n.call(arguments,2):u),g(l.type,f,i||l.key,o||l.ref,null)},createContext:function(n,l){var t={__c:l="__cC"+f++,__:n,Consumer:function(n,l){return n.children(l)},Provider:function(n){var t,u;return this.getChildContext||(t=[],(u={})[l]=this,this.getChildContext=function(){return u},this.shouldComponentUpdate=function(n){this.props.value!==n.value&&t.some(function(n){n.__e=!0,P(n)})},this.sub=function(n){t.push(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){t.splice(t.indexOf(n),1),l&&l.call(n)}}),n.children}};return t.Provider.__=t.Consumer.contextType=t},toChildArray:function n(l,t){return t=t||[],null==l||"boolean"==typeof l||(p(l)?l.some(function(l){n(l,t)}):t.push(l)),t},options:l},typeof module<"u"?module.exports=c:self.preact=c});
    </script>
    <script>
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("preact")):"function"==typeof define&&define.amd?define(["exports","preact"],t):t((n||self).preactHooks={},n.preact)}(this,function(n,t){var u,r,i,o,f=0,c=[],e=[],a=t.options,v=a.__b,l=a.__r,d=a.diffed,s=a.__c,p=a.unmount,h=a.__;function y(n,t){a.__h&&a.__h(r,n,f||t),f=0;var u=r.__H||(r.__H={__:[],__h:[]});return n>=u.__.length&&u.__.push({__V:e}),u.__[n]}function m(n){return f=1,_(P,n)}function _(n,t,i){var o=y(u++,2);if(o.t=n,!o.__c&&(o.__=[i?i(t):P(void 0,t),function(n){var t=o.__N?o.__N[0]:o.__[0],u=o.t(t,n);t!==u&&(o.__N=[u,o.__[1]],o.__c.setState({}))}],o.__c=r,!r.u)){var f=function(n,t,u){if(!o.__c.__H)return!0;var r=o.__c.__H.__.filter(function(n){return!!n.__c});if(r.every(function(n){return!n.__N}))return!c||c.call(this,n,t,u);var i=!1;return r.forEach(function(n){if(n.__N){var t=n.__[0];n.__=n.__N,n.__N=void 0,t!==n.__[0]&&(i=!0)}}),!(!i&&o.__c.props===n)&&(!c||c.call(this,n,t,u))};r.u=!0;var c=r.shouldComponentUpdate,e=r.componentWillUpdate;r.componentWillUpdate=function(n,t,u){if(this.__e){var r=c;c=void 0,f(n,t,u),c=r}e&&e.call(this,n,t,u)},r.shouldComponentUpdate=f}return o.__N||o.__}function T(n,t){var i=y(u++,4);!a.__s&&j(i.__H,t)&&(i.__=n,i.i=t,r.__h.push(i))}function b(n,t){var r=y(u++,7);return j(r.__H,t)?(r.__V=n(),r.i=t,r.__h=n,r.__V):r.__}function q(){for(var n;n=c.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(F),n.__H.__h.forEach(g),n.__H.__h=[]}catch(t){n.__H.__h=[],a.__e(t,n.__v)}}a.__b=function(n){r=null,v&&v(n)},a.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),h&&h(n,t)},a.__r=function(n){l&&l(n),u=0;var t=(r=n.__c).__H;t&&(i===r?(t.__h=[],r.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=e,n.__N=n.i=void 0})):(t.__h.forEach(F),t.__h.forEach(g),t.__h=[],u=0)),i=r},a.diffed=function(n){d&&d(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(1!==c.push(t)&&o===a.requestAnimationFrame||((o=a.requestAnimationFrame)||A)(q)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==e&&(n.__=n.__V),n.i=void 0,n.__V=e})),i=r=null},a.__c=function(n,t){t.some(function(n){try{n.__h.forEach(F),n.__h=n.__h.filter(function(n){return!n.__||g(n)})}catch(u){t.some(function(n){n.__h&&(n.__h=[])}),t=[],a.__e(u,n.__v)}}),s&&s(n,t)},a.unmount=function(n){p&&p(n);var t,u=n.__c;u&&u.__H&&(u.__H.__.forEach(function(n){try{F(n)}catch(n){t=n}}),u.__H=void 0,t&&a.__e(t,u.__v))};var x="function"==typeof requestAnimationFrame;function A(n){var t,u=function(){clearTimeout(r),x&&cancelAnimationFrame(t),setTimeout(n)},r=setTimeout(u,100);x&&(t=requestAnimationFrame(u))}function F(n){var t=r,u=n.__c;"function"==typeof u&&(n.__c=void 0,u()),r=t}function g(n){var t=r;n.__c=n.__(),r=t}function j(n,t){return!n||n.length!==t.length||t.some(function(t,u){return t!==n[u]})}function P(n,t){return"function"==typeof t?t(n):t}n.useCallback=function(n,t){return f=8,b(function(){return n},t)},n.useContext=function(n){var t=r.context[n.__c],i=y(u++,9);return i.c=n,t?(null==i.__&&(i.__=!0,t.sub(r)),t.props.value):n.__},n.useDebugValue=function(n,t){a.useDebugValue&&a.useDebugValue(t?t(n):n)},n.useEffect=function(n,t){var i=y(u++,3);!a.__s&&j(i.__H,t)&&(i.__=n,i.i=t,r.__H.__h.push(i))},n.useErrorBoundary=function(n){var t=y(u++,10),i=m();return t.__=n,r.componentDidCatch||(r.componentDidCatch=function(n,u){t.__&&t.__(n,u),i[1](n)}),[i[0],function(){i[1](void 0)}]},n.useId=function(){var n=y(u++,11);if(!n.__){for(var t=r.__v;null!==t&&!t.__m&&null!==t.__;)t=t.__;var i=t.__m||(t.__m=[0,0]);n.__="P"+i[0]+"-"+i[1]++}return n.__},n.useImperativeHandle=function(n,t,u){f=6,T(function(){return"function"==typeof n?(n(t()),function(){return n(null)}):n?(n.current=t(),function(){return n.current=null}):void 0},null==u?u:u.concat(n))},n.useLayoutEffect=T,n.useMemo=b,n.useReducer=_,n.useRef=function(n){return f=5,b(function(){return{current:n}},[])},n.useState=m});
    </script>
    <script>
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.htm=e()}(this,function(){var n=function(e,t,u,s){var r;t[0]=0;for(var p=1;p<t.length;p++){var h=t[p++],o=t[p]?(t[0]|=h?1:2,u[t[p++]]):t[++p];3===h?s[0]=o:4===h?s[1]=Object.assign(s[1]||{},o):5===h?(s[1]=s[1]||{})[t[++p]]=o:6===h?s[1][t[++p]]+=o+"":h?(r=e.apply(o,n(e,o,u,["",null])),s.push(r),o[0]?t[0]|=2:(t[p-2]=0,t[p]=r)):s.push(o)}return s},e=new Map;return function(t){var u=e.get(this);return u||(u=new Map,e.set(this,u)),(u=n(this,u.get(t)||(u.set(t,u=function(n){for(var e,t,u=1,s="",r="",p=[0],h=function(n){1===u&&(n||(s=s.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?p.push(0,n,s):3===u&&(n||s)?(p.push(3,n,s),u=2):2===u&&"..."===s&&n?p.push(4,n,0):2===u&&s&&!n?p.push(5,0,!0,s):u>=5&&((s||!n&&5===u)&&(p.push(u,0,s,t),u=6),n&&(p.push(u,n,0,t),u=6)),s=""},o=0;o<n.length;o++){o&&(1===u&&h(),h(o));for(var f=0;f<n[o].length;f++)e=n[o][f],1===u?"<"===e?(h(),p=[p],u=3):s+=e:4===u?"--"===s&&">"===e?(u=1,s=""):s=e+s[0]:r?e===r?r="":s+=e:'"'===e||"'"===e?r=e:">"===e?(h(),u=1):u&&("="===e?(u=5,t=s,s=""):"/"===e&&(u<5||">"===n[o][f+1])?(h(),3===u&&(p=p[0]),u=p,(p=p[0]).push(2,0,u),u=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(h(),u=2):s+=e),3===u&&"!--"===s&&(u=4,p=p[0])}return h(),p}(t)),u),arguments,[])).length>1?u:u[0]}});
    </script>

    <script>
        // ==========================================
        // Navigation System using Event Delegation
        // ==========================================

        // --------------------------------------------------
        // Preact + htm bootstrap (inlined vendor above)
        // --------------------------------------------------
        var __hasPreact = typeof preact !== 'undefined' && typeof htm !== 'undefined';
        var h = __hasPreact ? preact.h : null;
        var render = __hasPreact ? preact.render : null;
        var hooks = typeof preactHooks !== 'undefined' ? preactHooks : {};
        var useEffect = hooks.useEffect;
        var useMemo = hooks.useMemo;
        var useRef = hooks.useRef;
        var useState = hooks.useState;
        var html = __hasPreact ? htm.bind(h) : null;

        function CardAlertSlot(props) {
            // props: { alert?: { text, actionText, actionNav, icon?, onNav? }, empty?: boolean }
            if (!props || !props.alert) {
                return html`<div class="card-alert-slot"></div>`;
            }
            var a = props.alert;
            var fullText = (a.text || '').toString();
            var shownText = fullText.length > 60 ? (fullText.slice(0, 57) + '…') : fullText;
            return html`
                <div class="card-alert-slot" data-nav=${a.actionNav} style=${a.wrapperStyle || "cursor: pointer;"}>
                    <div class="card-alert-slot-inner flex items-center gap-2" style=${a.innerStyle || "background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.25);"}>
                        <span style="font-size: 11px;">${a.icon || "⚠️"}</span>
                        <p class="text-xs text-white flex-1" title=${fullText}>${shownText}</p>
                        <span class="text-primary text-xs" style="flex-shrink: 0;">${a.actionText || "View →"}</span>
                    </div>
                </div>
            `;
        }

        function StatGrid(props) {
            // props: { items: [{ value, label }] }
            var items = (props && props.items) ? props.items : [];
            return html`
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; background: var(--bg-elevated); border-radius: var(--radius-md); padding: 10px;">
                    ${items.map(function(it) {
                        return html`
                            <div class="text-center">
                                <p class="text-white font-semibold text-sm">${it.value}</p>
                                <p class="text-xs text-gray-500">${it.label}</p>
                            </div>
                        `;
                    })}
                </div>
            `;
        }

        function ConfigList(props) {
            // props: { rows: [{ label, value, valueClass? }] }
            var rows = (props && props.rows) ? props.rows : [];
            return html`
                <div style="display: flex; flex-direction: column; gap: 5px;">
                    ${rows.map(function(r) {
                        return html`
                            <div class="flex justify-between text-xs">
                                <span class="text-gray-500">${r.label}</span>
                                <span class=${r.valueClass || "text-gray-300"}>${r.value}</span>
                            </div>
                        `;
                    })}
                </div>
            `;
        }

        // --------------------------------------------------
        // CostBadge — reusable pill with color coding
        // --------------------------------------------------
        function formatUsd(amount) {
            var n = Number(amount);
            if (!isFinite(n)) return '$—';
            return '$' + n.toFixed(2);
        }

        function parseThresholds(attr) {
            if (!attr) return { lowMax: 25, medMax: 100 };
            var parts = String(attr).split(',').map(function(s) { return Number(s.trim()); }).filter(function(v) { return isFinite(v); });
            return { lowMax: parts[0] != null ? parts[0] : 25, medMax: parts[1] != null ? parts[1] : 100 };
        }

        function getCostLevel(cost, thresholds) {
            if (!isFinite(cost)) return 'medium';
            if (cost < thresholds.lowMax) return 'low';
            if (cost < thresholds.medMax) return 'medium';
            return 'high';
        }

        function initCostBadges(root) {
            var scope = root || document;
            var nodes = scope.querySelectorAll('[data-cost-badge]');
            for (var i = 0; i < nodes.length; i++) {
                var el = nodes[i];
                var cost = Number(el.getAttribute('data-cost-usd'));
                var thresholds = parseThresholds(el.getAttribute('data-cost-thresholds'));
                var level = getCostLevel(cost, thresholds);
                el.setAttribute('data-level', level);

                var amountEl = el.querySelector('.cost-badge__amount');
                if (amountEl) amountEl.textContent = formatUsd(cost);

                var tierEl = el.querySelector('.cost-badge__tier');
                if (tierEl) tierEl.textContent = level === 'low' ? 'Low' : (level === 'high' ? 'High' : 'Med');

                el.title = 'Estimated cost (1h): ' + formatUsd(cost);
                el.setAttribute('aria-label', el.title);
            }
        }

        // --------------------------------------------------
        // Deployment views — reusable component bundle
        // --------------------------------------------------
        function VersionBadge(props) {
            var v = (props && props.version) ? String(props.version) : '';
            if (!v) return null;
            var text = v[0] === 'v' ? v : ('v' + v);
            return html`<span class="version-badge" data-version-badge data-version=${v}>${text}</span>`;
        }

        function CostBadge(props) {
            var cost = (props && typeof props.costUsd === 'number') ? props.costUsd : null;
            if (cost == null) return null;
            var thresholds = (props && props.thresholds) ? String(props.thresholds) : '25,100';
            // initCostBadges() will set the correct tier + formatting
            return html`
                <span class="cost-badge" data-cost-badge data-cost-usd=${String(cost)} data-cost-thresholds=${thresholds}>
                    <span class="cost-badge__dot" aria-hidden="true"></span>
                    <span class="cost-badge__amount">$${cost}</span>
                    <span class="cost-badge__tier">Med</span>
                </span>
            `;
        }

        function TokenUsageRow(props) {
            // props: { label, input, output, total, costUsd, thresholds? }
            return html`
                <div class="w-full token-usage-block">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-500">${props.label || 'Token Usage (1h)'}</span>
                        <${CostBadge} costUsd=${props.costUsd} thresholds=${props.thresholds} />
                    </div>
                    <div class="token-usage-grid">
                        <div class="token-metric">
                            <span class="token-metric__label">Input tokens</span>
                            <span class="token-metric__value tabular-nums">${props.input || '—'}</span>
                        </div>
                        <div class="token-metric">
                            <span class="token-metric__label">Output tokens</span>
                            <span class="token-metric__value tabular-nums">${props.output || '—'}</span>
                        </div>
                        <div class="token-metric">
                            <span class="token-metric__label">Total tokens</span>
                            <span class="token-metric__value tabular-nums">${props.total || '—'}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function KeyValueCard(props) {
            // props: { title, rows: [{ label, value, valueClass?, type?, tokenUsage? }] }
            var rows = (props && props.rows) ? props.rows : [];
            return html`
                <div class="card p-4">
                    <h3 class="text-xs text-gray-500 uppercase font-semibold mb-3">${props.title || ''}</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        ${rows.map(function(r) {
                            if (r && r.type === 'tokenUsage') {
                                return html`
                                    <div class="flex justify-between text-sm">
                                        <${TokenUsageRow} ...${(r.tokenUsage || {})} />
                                    </div>
                                `;
                            }
                            return html`
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500">${r.label}</span>
                                    <span class=${r.valueClass || 'text-gray-300'}>${r.value}</span>
                                </div>
                            `;
                        })}
                    </div>
                </div>
            `;
        }

        function DeploymentDetailView(props) {
            // props: { backNav, title, subtitle, status: { dot, cls, text }, archTitle, graphId, cards: [ { title, rows } ] }
            var status = props.status || null;
            var cards = props.cards || [];
            var headerVariant = props.headerVariant || 'default'; // 'default' | 'heroCentered'
            var layout = props.layout || 'graphFirst'; // 'graphFirst' | 'cardsFirst'
            var notices = props.notices || [];

            var headerVNode = null;
            if (headerVariant === 'heroCentered') {
                headerVNode = html`
                    <h1 style="font-size: 32px; font-weight: 600; color: var(--text-primary); margin: 0 0 32px 0; line-height: 1.15; text-align: center;">
                        ${props.title || ''}
                    </h1>
                `;
            } else {
                headerVNode = html`
                    <div class="flex items-center gap-4 mb-6">
                        ${props.backNav ? html`<button class="btn-icon" data-nav=${props.backNav}>←</button>` : null}
                        <div class="flex-1">
                            <h1 class="text-xl font-semibold text-white">${props.title || ''}</h1>
                            ${props.subtitle ? html`<p class="text-sm text-gray-500 mt-0">${props.subtitle}</p>` : null}
                        </div>
                        ${status ? html`
                            <div class="flex items-center gap-2">
                                <span class=${"status-dot " + (status.dot || 'success')}></span>
                                <span class=${"text-sm " + (status.cls || '')}>${status.text || ''}</span>
                            </div>
                        ` : null}
                    </div>
                `;
            }

            var graphVNode = (props.graphId) ? html`
                <h2 class="text-xl font-semibold text-white mb-3">${props.archTitle || 'Architecture'}</h2>
                <div class="card p-6 mb-6">
                    <div id=${props.graphId}></div>
                </div>
            ` : null;

            var cardsVNode = (cards && cards.length) ? html`
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; ${headerVariant === 'heroCentered' ? 'margin-bottom: 24px;' : ''}">
                    ${cards.map(function(c) { return html`<${KeyValueCard} ...${c} />`; })}
                </div>
            ` : null;

            return html`
                <div>
                    ${headerVNode}
                    <${DeploymentNotices} items=${notices} />
                    ${layout === 'cardsFirst' ? cardsVNode : graphVNode}
                    ${layout === 'cardsFirst' ? graphVNode : cardsVNode}
                </div>
            `;
        }

        function mountDeploymentViews() {
            if (!__hasPreact) return;

            var deploymentConfigs = [
                {
                    rootId: 'deployment-cs-prod-root',
                    backNav: 'agent-detail-cs',
                    title: 'cs-bot-prod',
                    subtitle: null,
                    status: null,
                    headerVariant: 'heroCentered',
                    layout: 'cardsFirst',
                    archTitle: 'Architecture',
                    graphId: 'svc-graph-dep-cs-prod',
                    cards: [
                        {
                            title: 'Deployment Config',
                            rows: [
                                { label: 'Status', value: '● Healthy', valueClass: 'status-success' },
                                { label: 'Platform', value: html`<${PlatformBadge} name="OpenShift Cluster" size=${14} />`, valueClass: 'text-gray-300' },
                                {
                                    label: 'Agent',
                                    value: html`<span class="text-gray-300" style="display: inline-flex; align-items: center; gap: 8px;"><span class="text-gray-300">Customer Support Bot</span><${VersionBadge} version="2.1" /></span>`,
                                    valueClass: 'text-gray-300'
                                },
                                { label: 'Model', value: html`<a class="text-white link-inline" href="#" data-nav="model-gpt-4-turbo" title="View model resource in MLflow">gpt-4-turbo</a>`, valueClass: 'text-white' },
                                { label: 'Endpoint', value: html`<a class="text-gray-300 font-mono text-xs link-inline" href="https://api.openai.com/v1/assistants/cs-prod" target="_blank" rel="noreferrer">api.openai.com/v1/assistants/cs-prod</a>`, valueClass: 'text-gray-300 font-mono text-xs' },
                                { label: 'Last Deployed', value: '4h ago', valueClass: 'text-gray-300' }
                            ]
                        },
                        {
                            title: 'Runtime Telemetry',
                            rows: [
                                { label: 'Throughput (1h)', value: '516 req/min', valueClass: 'text-gray-300' },
                                { label: 'P99 Latency', value: '680ms', valueClass: 'status-success' },
                                { label: 'Error Rate', value: '0.3%', valueClass: 'status-success' },
                                {
                                    type: 'tokenUsage',
                                    tokenUsage: { label: 'Token Usage (1h)', input: '720k', output: '480k', total: '1.20M', costUsd: 18.24, thresholds: '25,100' }
                                },
                                { label: 'OTel Trace Collector', value: 'otel-collector.monitoring:4317', valueClass: 'text-gray-300 font-mono text-xs' }
                            ]
                        }
                    ]
                },
                {
                    rootId: 'deployment-cs-openai-root',
                    backNav: 'agent-detail-cs',
                    title: 'cs-bot-openai',
                    subtitle: null,
                    status: null,
                    headerVariant: 'heroCentered',
                    layout: 'cardsFirst',
                    archTitle: 'Architecture',
                    graphId: 'svc-graph-dep-cs-openai',
                    notices: [
                        {
                            tone: 'warning',
                            title: 'Feedback SLO breached',
                            detail: 'Thumbs-down rate 30.4% exceeded 20% threshold (last 1h)',
                            actionText: 'Review Analytics',
                            nav: 'deployment-alert-cs-openai-feedback'
                        }
                    ],
                    cards: [
                        {
                            title: 'Deployment Config',
                            rows: [
                                { label: 'Status', value: '● Degraded', valueClass: 'status-warning' },
                                { label: 'Platform', value: html`<${PlatformBadge} name="OpenAI" size=${14} />`, valueClass: 'text-gray-300' },
                                {
                                    label: 'Agent',
                                    value: html`<span class="text-gray-300" style="display: inline-flex; align-items: center; gap: 8px;"><span class="text-gray-300">Customer Support Bot</span><${VersionBadge} version="2.1" /></span>`,
                                    valueClass: 'text-gray-300'
                                },
                                { label: 'Model', value: html`<a class="text-white link-inline" href="#" data-nav="models" title="View model registry in MLflow">gpt-4o-mini</a>`, valueClass: 'text-white' },
                                { label: 'Endpoint', value: html`<a class="text-gray-300 font-mono text-xs link-inline" href="https://api.openai.com/v1/assistants/cs-openai" target="_blank" rel="noreferrer">api.openai.com/v1/assistants/cs-openai</a>`, valueClass: 'text-gray-300 font-mono text-xs' },
                                { label: 'Last Deployed', value: '—', valueClass: 'text-gray-300' }
                            ]
                        },
                        {
                            title: 'Runtime Telemetry',
                            rows: [
                                { label: 'Throughput (1h)', value: '118 req/min', valueClass: 'text-gray-300' },
                                { label: 'P99 Latency', value: '2,840ms', valueClass: 'status-warning' },
                                { label: 'Error Rate', value: '7.8%', valueClass: 'status-warning' },
                                {
                                    type: 'tokenUsage',
                                    tokenUsage: { label: 'Token Usage (1h)', input: '410k', output: '260k', total: '670k', costUsd: 6.84, thresholds: '25,100' }
                                },
                                { label: 'OTel Trace Collector', value: 'otel-collector.monitoring:4317', valueClass: 'text-gray-300 font-mono text-xs' }
                            ]
                        }
                    ]
                },
                {
                    rootId: 'deployment-cs-edge-root',
                    backNav: 'agent-detail-cs',
                    title: 'cs-bot-edge',
                    subtitle: null,
                    status: null,
                    headerVariant: 'heroCentered',
                    layout: 'cardsFirst',
                    archTitle: 'Architecture',
                    graphId: 'svc-graph-dep-cs-edge',
                    cards: [
                        {
                            title: 'Deployment Config',
                            rows: [
                                { label: 'Status', value: '● Running', valueClass: 'status-success' },
                                { label: 'Platform', value: html`<${PlatformBadge} name="Kubernetes" size=${14} />`, valueClass: 'text-gray-300' },
                                {
                                    label: 'Agent',
                                    value: html`<span class="text-gray-300" style="display: inline-flex; align-items: center; gap: 8px;"><span class="text-gray-300">Customer Support Bot</span><${VersionBadge} version="2.1" /></span>`,
                                    valueClass: 'text-gray-300'
                                },
                                { label: 'Model', value: html`<a class="text-white link-inline" href="#" data-nav="model-gpt-4-turbo" title="View model resource in MLflow">gpt-4-turbo</a>`, valueClass: 'text-white' },
                                { label: 'Endpoint', value: html`<span class="text-gray-300 font-mono text-xs">edge-gw.internal/cs-bot</span>`, valueClass: 'text-gray-300 font-mono text-xs' },
                                { label: 'Last Deployed', value: '18h ago', valueClass: 'text-gray-300' }
                            ]
                        },
                        {
                            title: 'Runtime Telemetry',
                            rows: [
                                { label: 'Throughput (1h)', value: '264 req/min', valueClass: 'text-gray-300' },
                                { label: 'P99 Latency', value: '740ms', valueClass: 'status-success' },
                                { label: 'Error Rate', value: '0.8%', valueClass: 'status-success' },
                                { label: 'OTel Trace Collector', value: 'otel-collector.monitoring:4317', valueClass: 'text-gray-300 font-mono text-xs' }
                            ]
                        }
                    ]
                },
                {
                    rootId: 'deployment-cs-bedrock-root',
                    backNav: 'agent-detail-cs',
                    title: 'cs-bot-bedrock',
                    subtitle: null,
                    status: null,
                    headerVariant: 'heroCentered',
                    layout: 'cardsFirst',
                    archTitle: 'Architecture',
                    graphId: 'svc-graph-dep-cs-bedrock',
                    cards: [
                        {
                            title: 'Deployment Config',
                            rows: [
                                { label: 'Status', value: '● Running', valueClass: 'status-success' },
                                { label: 'Platform', value: html`<${PlatformBadge} name="AWS" size=${14} />`, valueClass: 'text-gray-300' },
                                {
                                    label: 'Agent',
                                    value: html`<span class="text-gray-300" style="display: inline-flex; align-items: center; gap: 8px;"><span class="text-gray-300">Customer Support Bot</span><${VersionBadge} version="2.1" /></span>`,
                                    valueClass: 'text-gray-300'
                                },
                                { label: 'Model', value: html`<a class="text-white link-inline" href="#" data-nav="models" title="View model registry in MLflow">Claude 3.5 Sonnet</a>`, valueClass: 'text-white' },
                                { label: 'Endpoint', value: html`<span class="text-gray-300 font-mono text-xs">bedrock-runtime.us-east-1.amazonaws.com</span>`, valueClass: 'text-gray-300 font-mono text-xs' },
                                { label: 'Last Deployed', value: '2d ago', valueClass: 'text-gray-300' }
                            ]
                        },
                        {
                            title: 'Runtime Telemetry',
                            rows: [
                                { label: 'Throughput (1h)', value: '92 req/min', valueClass: 'text-gray-300' },
                                { label: 'P99 Latency', value: '1,120ms', valueClass: 'status-success' },
                                { label: 'Error Rate', value: '0.4%', valueClass: 'status-success' },
                                { label: 'OTel Trace Collector', value: 'otel-collector.monitoring:4317', valueClass: 'text-gray-300 font-mono text-xs' }
                            ]
                        }
                    ]
                },
                {
                    rootId: 'deployment-pa-prod-root',
                    backNav: 'agent-detail-pa',
                    title: 'pa-agent-prod',
                    subtitle: 'Product Advisor Agent · Production · OpenShift AI',
                    status: { dot: 'warning', cls: 'status-warning', text: 'Degraded' },
                    archTitle: 'Architecture',
                    graphId: 'svc-graph-dep-pa-prod',
                    cards: [
                        {
                            title: 'Deployment Config',
                            rows: [
                                { label: 'Namespace', value: 'ml-serving-prod', valueClass: 'text-gray-300 font-mono' },
                                { label: 'Replicas', value: '2 / 2 ready', valueClass: 'text-white' },
                                { label: 'Resources', value: '2 vCPU · 8Gi RAM', valueClass: 'text-gray-300' },
                                { label: 'Endpoint', value: html`<span class="text-gray-300 font-mono text-xs">ocp.cluster.local/serving/pa-prod</span>`, valueClass: 'text-gray-300 font-mono text-xs' },
                                { label: 'Last Deployed', value: '2h ago', valueClass: 'text-gray-300' }
                            ]
                        },
                        {
                            title: 'Runtime Telemetry',
                            rows: [
                                { label: 'Throughput (1h)', value: '342 req/min', valueClass: 'text-gray-300' },
                                { label: 'P99 Latency', value: '1,240ms', valueClass: 'status-warning' },
                                { label: 'Error Rate', value: '4.2%', valueClass: 'status-warning' },
                                { label: 'GPU Utilization', value: '72%', valueClass: 'text-gray-300' },
                                { label: 'OTel Trace Collector', value: 'otel-collector.monitoring:4317', valueClass: 'text-gray-300 font-mono text-xs' }
                            ]
                        }
                    ]
                },
                {
                    rootId: 'deployment-pks-prod-root',
                    backNav: 'db-detail-pks',
                    title: 'pks-prod',
                    subtitle: 'product-knowledge-store · Production · ChromaDB',
                    status: { dot: 'warning', cls: 'status-warning', text: 'Issues' },
                    archTitle: 'Data Flow Architecture',
                    graphId: 'svc-graph-dep-pks-prod',
                    cards: [
                        {
                            title: 'Instance Config',
                            rows: [
                                { label: 'Host', value: html`<span class="text-gray-300 font-mono text-xs">chroma-prod.internal:8000</span>`, valueClass: 'text-gray-300 font-mono text-xs' },
                                { label: 'Storage', value: 'Persistent · 12GB used', valueClass: 'text-gray-300' },
                                { label: 'Collection', value: html`<span class="text-white font-mono text-xs">product-knowledge</span>`, valueClass: 'text-white font-mono text-xs' },
                                { label: 'Dimensions', value: '1,536', valueClass: 'text-white' },
                                { label: 'Distance Metric', value: 'cosine', valueClass: 'text-gray-300' }
                            ]
                        },
                        {
                            title: 'Consumers',
                            rows: [
                                {
                                    label: 'Agent',
                                    value: html`<span class="text-gray-300" style="cursor: pointer;" data-nav="agent-detail-pa">Product Advisor Agent <span class="status-warning">● Degraded →</span></span>`,
                                    valueClass: 'text-gray-300'
                                }
                            ]
                        }
                    ]
                }
            ];

            for (var i = 0; i < deploymentConfigs.length; i++) {
                var cfg = deploymentConfigs[i];
                var root = document.getElementById(cfg.rootId);
                if (root) {
                    render(html`<${DeploymentDetailView} ...${cfg} />`, root);
                }
            }

            // Ensure cost badges inside deployment views are color-coded.
            initCostBadges();

            // Mount Usage view for cs-bot-prod
            var usageRoot = document.getElementById('deployment-cs-prod-usage-root');
            if (usageRoot) {
                render(html`<${DeploymentUsageView} backNav="deployment-cs-prod" title="cs-bot-prod" />`, usageRoot);
            }
        }

        // --------------------------------------------------
        // DeploymentUsageView — MLflow-style usage dashboard
        // Shows token usage, cost, latency, and request traces
        // --------------------------------------------------
        function DeploymentUsageView(props) {
            var _timeUnit = useState('Day');
            var timeUnit = _timeUnit[0];
            var setTimeUnit = _timeUnit[1];
            var _timeRange = useState('Last 7 days');
            var timeRange = _timeRange[0];
            var setTimeRange = _timeRange[1];
            var _refresh = useState(0);
            var refreshNonce = _refresh[0];
            var setRefreshNonce = _refresh[1];

            var timeUnitOptions = ['Minute', 'Hour', 'Day'];
            var timeRangeOptions = ['Last 1 hour', 'Last 24 hours', 'Last 7 days', 'Last 30 days'];

            function cycle(list, current) {
                var idx = list.indexOf(current);
                if (idx === -1) return list[0];
                return list[(idx + 1) % list.length];
            }

            function FilterButton(p) {
                return html`
                    <button
                        onClick=${p.onClick}
                        style="display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 10px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.10); color: var(--text-secondary); font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.15s ease;"
                        onmouseenter=${function(e){ e.currentTarget.style.borderColor='rgba(232,236,240,0.16)'; e.currentTarget.style.background='rgba(255,255,255,0.06)'; }}
                        onmouseleave=${function(e){ e.currentTarget.style.borderColor='rgba(255,255,255,0.10)'; e.currentTarget.style.background='rgba(255,255,255,0.04)'; }}
                    >
                        <span style="color: var(--text-muted); font-weight: 700;">${p.label}</span>
                        <span style="color: var(--text-primary); font-weight: 700;">${p.value}</span>
                        <span style="opacity: 0.6; font-size: 10px; margin-left: 2px;">▾</span>
                    </button>
                `;
            }

            function usageIcon(name) {
                // Match sidebar/service-graph icon style: stroke=currentColor, 24x24 viewBox.
                switch (name) {
                    case 'traces': // line chart
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M3 3v18h18"></path>
                            <path d="M7 14l3-3 3 2 5-6"></path>
                        </svg>`;
                    case 'latency': // clock
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="12" cy="12" r="9"></circle>
                            <path d="M12 7v6l4 2"></path>
                        </svg>`;
                    case 'errors': // octagon alert
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M7.86 2h8.28L22 7.86v8.28L16.14 22H7.86L2 16.14V7.86L7.86 2Z"></path>
                            <path d="M12 8v5"></path>
                            <path d="M12 16h.01"></path>
                        </svg>`;
                    case 'tokenUsage': // lightning (zap)
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M13 2 3 14h9l-1 8 10-12h-9l1-8Z"></path>
                        </svg>`;
                    case 'tokensPerTrace': // bar chart
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M3 3v18h18"></path>
                            <path d="M7 16v-6"></path>
                            <path d="M12 16V7"></path>
                            <path d="M17 16v-9"></path>
                        </svg>`;
                    default:
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="12" cy="12" r="9"></circle>
                        </svg>`;
                }
            }

            function PanelCard(p) {
                return html`
                    <div class="card" style=${"padding: 14px; min-height: " + (p.minHeight || 220) + "px; display: flex; flex-direction: column;" + (p.style || '')}>
                        <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 10px;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span class="sidebar-icon" aria-hidden="true" style="width: 18px; height: 18px; color: var(--text-muted);">
                                        ${usageIcon(p.icon)}
                                    </span>
                                    <span style="font-size: 13px; font-weight: 700; color: var(--text-primary);">${p.title}</span>
                                </div>
                                ${p.valueLine ? html`<div style="font-size: 12px; color: var(--text-muted);">${p.valueLine}</div>` : null}
                            </div>
                        </div>
                        <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 14px 6px;">
                            <div style="font-size: 12px; color: var(--text-muted);">No data available for the selected time range</div>
                        </div>
                    </div>
                `;
            }

            var tracesValue = '0';
            var errorsValue = '0 (overall error rate: 0.0%)';
            var tokenUsageValue = '0 (0 input, 0 output)';

            // Use refreshNonce so the UI visibly "updates" in prototypes
            void refreshNonce;

            return html`
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 18px; font-weight: 800; color: var(--text-primary); line-height: 1.1;">Usage</div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 8px;">
                            <${FilterButton}
                                label="Time Unit:"
                                value=${timeUnit}
                                onClick=${function(){ setTimeUnit(cycle(timeUnitOptions, timeUnit)); }}
                            />
                            <${FilterButton}
                                label="Time Range:"
                                value=${timeRange}
                                onClick=${function(){ setTimeRange(cycle(timeRangeOptions, timeRange)); }}
                            />
                            <button
                                title="Refresh"
                                onClick=${function(){ setRefreshNonce(refreshNonce + 1); }}
                                style="width: 34px; height: 34px; border-radius: 10px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.10); color: var(--text-secondary); cursor: pointer; font-weight: 900;"
                                onmouseenter=${function(e){ e.currentTarget.style.borderColor='rgba(34,114,180,0.30)'; e.currentTarget.style.background='rgba(34,114,180,0.10)'; e.currentTarget.style.color='var(--color-primary)'; }}
                                onmouseleave=${function(e){ e.currentTarget.style.borderColor='rgba(255,255,255,0.10)'; e.currentTarget.style.background='rgba(255,255,255,0.04)'; e.currentTarget.style.color='var(--text-secondary)'; }}
                            >⟳</button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div style="grid-column: 1 / -1;">
                            <${PanelCard} icon="traces" title="Traces" valueLine=${tracesValue} minHeight=${260} />
                        </div>
                        <${PanelCard} icon="latency" title="Latency" valueLine="0" minHeight=${220} />
                        <${PanelCard} icon="errors" title="Errors" valueLine=${errorsValue} minHeight=${220} />
                        <${PanelCard} icon="tokenUsage" title="Token Usage" valueLine=${tokenUsageValue} minHeight=${220} />
                        <${PanelCard} icon="tokensPerTrace" title="Tokens per Trace" valueLine="" minHeight=${220} />
                    </div>
                </div>
            `;
        }

        function mountAlertViews() {
            if (!__hasPreact) return;

            var root = document.getElementById('deployment-alert-cs-openai-feedback-root');
            if (!root) return;

            var slo = {
                name: 'Thumbs-down rate',
                windowText: 'Measured over the last 60 minutes for this deployment (cs-bot-openai).',
                current: '30.4%',
                threshold: '20%',
                thresholdPct: 20.0,
                // 12 x 5-minute buckets (approx)
                seriesPct: [2.1, 2.3, 2.5, 2.8, 3.0, 3.4, 3.8, 4.1, 4.7, 5.3, 5.9, 6.2],
                segments: [
                    { label: 'Topic: refunds / returns', valuePct: '9.8%', note: 'High negative feedback on refund-policy responses', tone: 'warning' },
                    { label: 'Tool usage: ticket_create', valuePct: '8.7%', note: 'Users downvote after ticket handoff', tone: 'warning' },
                    { label: 'Source: support-articles-store', valuePct: '6.9%', note: 'Older snapshots cited in responses', tone: 'warning' }
                ]
            };

            var traces = [
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-a3f2b1', query: '"My package arrived damaged — can I get a refund?"', latency: 2.4, model: 'gpt-4o-mini', timestamp: '3m ago', analytics: ['Thumbs Down', 'Bad Chunk'] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-e8c4d7', query: '"Why was my return rejected?"', latency: 2.1, model: 'gpt-4o-mini', timestamp: '7m ago', analytics: ['Thumbs Down', 'Bad Chunk'] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-91bf05', query: '"Can you cancel my subscription effective immediately?"', latency: 1.9, model: 'gpt-4o-mini', timestamp: '11m ago', analytics: ['Thumbs Down'] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-44de82', query: '"I was charged twice for the same order"', latency: 3.1, model: 'gpt-4o-mini', timestamp: '14m ago', analytics: ['Thumbs Down', 'Bad Chunk'] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-c0a739', query: '"Where is my refund? It has been 2 weeks"', latency: 2.6, model: 'gpt-4o-mini', timestamp: '18m ago', analytics: ['Thumbs Down'] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-7fe621', query: '"The bot gave me the wrong return address"', latency: 1.7, model: 'gpt-4o-mini', timestamp: '22m ago', analytics: ['Bad Chunk'] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-b3d8a4', query: '"Your FAQ page says free returns but the bot says otherwise"', latency: 2.8, model: 'gpt-4o-mini', timestamp: '26m ago', analytics: ['Thumbs Down', 'Bad Chunk'] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-5e19c6', query: '"How do I escalate to a human agent?"', latency: 1.4, model: 'gpt-4o-mini', timestamp: '31m ago', analytics: ['Thumbs Down'] },
                { feedback: 'up',   nav: 'trace-detail', traceId: 'tr-d24f08', query: '"What are your business hours?"', latency: 0.9, model: 'gpt-4o-mini', timestamp: '35m ago', analytics: [] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-fa7b33', query: '"I never received my order and tracking shows delivered"', latency: 3.4, model: 'gpt-4o-mini', timestamp: '39m ago', analytics: ['Thumbs Down', 'Bad Chunk'] },
                { feedback: 'up',   nav: 'trace-detail', traceId: 'tr-18e5c0', query: '"Do you ship internationally?"', latency: 0.8, model: 'gpt-4o-mini', timestamp: '42m ago', analytics: [] },
                { feedback: 'down', nav: 'trace-detail', traceId: 'tr-6ca2d9', query: '"The coupon code SAVE20 is not working"', latency: 2.2, model: 'gpt-4o-mini', timestamp: '47m ago', analytics: ['Bad Chunk'] }
            ];

            var alertConfig = {
                header: {
                    backNav: 'deployment-cs-openai',
                    title: 'cs-bot-openai — Analytics Alert',
                    statusLabel: 'Active',
                    statusTone: 'error',
                    subtitle: 'Triggered 12 minutes ago · cs-bot-openai · OpenAI',
                    actions: [
                        { label: 'Acknowledge', variant: 'ghost' },
                        { label: 'Mute', variant: 'secondary' }
                    ]
                },
                banner: {
                    tone: 'warning',
                    title: 'Feedback SLO breached',
                    description: html`This alert is triggered from live analytics on <span class="font-mono text-gray-300">cs-bot-openai</span> when the thumbs-down rate exceeds the configured threshold.`,
                    callouts: [
                        { tone: 'warning', icon: '📈', text: 'SLO: thumbs_down_rate > 20% (1h)' },
                        { tone: 'warning', icon: '⏱️', text: 'Window: last 60m' },
                        { tone: 'warning', icon: '🎯', text: 'Current: 30.4%' }
                    ]
                },
                slo: slo,
                chart: {
                    title: 'Analytics Overview',
                    series: [
                        { data: [8.2, 10.1, 12.5, 15.0, 17.8, 20.3, 22.1, 24.6, 26.3, 28.0, 29.5, 30.4], color: '#F59E0B', label: 'Thumbs Down', desc: 'User negative feedback rate', valuePct: '30.4%' },
                        { data: [2.1, 3.4, 5.0, 6.8, 8.5, 10.2, 12.0, 13.8, 15.6, 17.1, 18.2, 19.0], color: '#8B5CF6', label: 'Bad Chunk', desc: 'Chunk error / incompleteness rate', valuePct: '19%' }
                    ]
                },
                traces: {
                    title: 'Traces contributing to this alert',
                    rows: traces
                }
            };

            render(html`<${AlertDetailView} ...${alertConfig} />`, root);
        }

        // --------------------------------------------------
        // DataTable — reusable, auto-sizing table component
        // --------------------------------------------------
        function DataTable(props) {
            // props: {
            //   title: string,
            //   columns: [{ key, label, width?, align?, render? }],
            //   rows: [{ ...cellValues, nav?, rowStyle? }],
            //   searchPlaceholder?: string,
            //   pageSize?: number,
            //   footer?: string        // e.g. "Showing 1-6 of 12"
            // }
            var columns = props.columns || [];
            var allRows = props.rows || [];
            var searchPlaceholder = props.searchPlaceholder || 'Search...';
            var requestedPageSize = props.pageSize || 25;
            var autoPageSize = !!props.autoPageSize;
            var minRows = props.minRows || 6;
            var maxRows = props.maxRows || 1000;

            var _s = useState(''); var query = _s[0]; var setQuery = _s[1];
            var _p = useState(1); var page = _p[0]; var setPage = _p[1];
            var _sk = useState(null); var sortKey = _sk[0]; var setSortKey = _sk[1];
            var _sd = useState('asc'); var sortDir = _sd[0]; var setSortDir = _sd[1];
            var wrapRef = useRef(null);
            var headRef = useRef(null);
            var theadRef = useRef(null);
            var footRef = useRef(null);
            var rowMeasureRef = useRef(null);
            var _h = useState(0); var tableH = _h[0]; var setTableH = _h[1];
            var _ps = useState(requestedPageSize); var pageSize = _ps[0]; var setPageSize = _ps[1];

            function handleSort(key) {
                if (sortKey === key) {
                    setSortDir(sortDir === 'asc' ? 'desc' : 'asc');
                } else {
                    setSortKey(key);
                    setSortDir('asc');
                }
                setPage(1);
            }

            // Filter rows by search
            var filtered = useMemo(function() {
                if (!query) return allRows;
                var q = query.toLowerCase();
                return allRows.filter(function(r) {
                    return columns.some(function(c) {
                        var v = r[c.key];
                        return v != null && String(v).toLowerCase().indexOf(q) !== -1;
                    });
                });
            }, [query, allRows, columns]);

            // Sort filtered rows
            var sorted = useMemo(function() {
                if (!sortKey) return filtered;
                var col = columns.find(function(c) { return c.key === sortKey; });
                if (!col) return filtered;
                var sortVal = col.sortValue || function(r) { return r[sortKey] != null ? String(r[sortKey]).toLowerCase() : ''; };
                return filtered.slice().sort(function(a, b) {
                    var va = sortVal(a);
                    var vb = sortVal(b);
                    if (va < vb) return sortDir === 'asc' ? -1 : 1;
                    if (va > vb) return sortDir === 'asc' ? 1 : -1;
                    return 0;
                });
            }, [filtered, sortKey, sortDir, columns]);

            // Auto page size based on what fits in view (no scroll)
            useEffect(function() {
                if (!autoPageSize) {
                    setPageSize(requestedPageSize);
                    return;
                }
                // Need a measured height and at least one rendered row to get accurate sizing
                if (!tableH) return;

                var headH = headRef.current ? headRef.current.offsetHeight : 0;
                var theadH = theadRef.current ? theadRef.current.offsetHeight : 0;
                var footH = footRef.current ? footRef.current.offsetHeight : 0;
                var chrome = headH + theadH + footH;

                var rowH = rowMeasureRef.current ? rowMeasureRef.current.offsetHeight : 34;
                var availForRows = Math.max(0, tableH - chrome - 8);

                // Subtract 1 row as buffer to avoid clipping from borders/pixels
                var fit = Math.max(1, Math.floor(availForRows / rowH) - 1);
                var next = Math.max(minRows, Math.min(maxRows, fit));
                setPageSize(next);
            }, [autoPageSize, requestedPageSize, tableH, query, filtered.length]);

            // Pagination
            var totalPages = Math.max(1, Math.ceil(sorted.length / pageSize));
            if (page > totalPages) setPage(1);
            var start = (page - 1) * pageSize;
            var pageRows = sorted.slice(start, start + pageSize);

            // Dynamic height: fill remaining space
            useEffect(function() {
                function measure() {
                    if (!wrapRef.current) return;
                    var rect = wrapRef.current.getBoundingClientRect();
                    var avail = window.innerHeight - rect.top - 36;
                    if (avail > 200) setTableH(avail);
                }
                measure();
                window.addEventListener('resize', measure);
                return function() { window.removeEventListener('resize', measure); };
            }, []);

            var footerText = props.footer || ('Showing ' + (start + 1) + '-' + Math.min(start + pageSize, sorted.length) + ' of ' + sorted.length);

            return html`
                <div
                    ref=${wrapRef}
                    style=${'display: flex; flex-direction: column; background: transparent; border: none; box-shadow: none; border-radius: 0; overflow: hidden;' + (autoPageSize && tableH ? ' height: ' + tableH + 'px;' : ' height: 100%;')}
                >
                    <div class="p-4 divider" ref=${headRef}>
                        <div class="flex items-center justify-between gap-4">
                            <h3 class="font-medium text-white flex-shrink-0">${props.title || 'Table'}</h3>
                            <div style="display: flex; align-items: center; gap: 12px; margin-left: auto;">
                                <div class="search-box" style="width: 340px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    <input type="text" placeholder=${searchPlaceholder} value=${query} onInput=${function(e){ setQuery(e.target.value); setPage(1); }} />
                                </div>
                                ${props.headerActions || null}
                            </div>
                        </div>
                    </div>
                    <div style="flex: 1; overflow: hidden; min-height: 0;">
                        <table class="table-compact" style="width: 100%; table-layout: fixed;">
                            <colgroup>
                                ${columns.map(function(c) {
                                    return html`<col style=${c.width ? 'width:' + c.width + ';' : ''} />`;
                                })}
                            </colgroup>
                            <thead ref=${theadRef} style="position: sticky; top: 0; z-index: 1;">
                                <tr>
                                    ${columns.map(function(c) {
                                        var style = '';
                                        if (c.align) style += 'text-align:' + c.align + ';';
                                        style += 'background: var(--bg-page);';
                                        if (c.sortable) style += ' cursor: pointer; user-select: none;';
                                        var isSorted = sortKey === c.key;
                                        var arrow = isSorted ? (sortDir === 'asc' ? ' ↑' : ' ↓') : '';
                                        return html`<th
                                            style=${style}
                                            onClick=${c.sortable ? function(){ handleSort(c.key); } : null}
                                        >
                                            <span style=${'display: inline-flex; align-items: center; gap: 4px;' + (c.sortable ? ' transition: color 0.15s;' : '')}>
                                                ${c.label}
                                                ${c.sortable ? html`<span style=${'font-size: 11px; opacity: ' + (isSorted ? '1' : '0.3') + '; transition: opacity 0.15s;'}>${isSorted ? arrow : ' ↕'}</span>` : null}
                                            </span>
                                        </th>`;
                                    })}
                                </tr>
                            </thead>
                            <tbody>
                                ${pageRows.length > 0 ? html`
                                    <tr ref=${rowMeasureRef} style="visibility:hidden; height:0;">
                                        ${columns.map(function(){ return html`<td style="padding:0; border:none; height:0;"></td>`; })}
                                    </tr>
                                ` : null}
                                ${pageRows.map(function(row) {
                                    return html`
                                        <tr class=${row.nav ? 'card-clickable' : ''} style=${(row.nav ? 'cursor:pointer;' : '') + (row.rowStyle || '')} onClick=${row.nav ? function(e){ e.stopPropagation(); window.showView(row.nav); } : null}>
                                            ${columns.map(function(c) {
                                                var tdStyle = (c.align ? 'text-align:' + c.align + ';' : '') + 'overflow:hidden; text-overflow:ellipsis; white-space:nowrap;';
                                                if (c.render) return html`<td style=${tdStyle}>${c.render(row)}</td>`;
                                                return html`<td style=${tdStyle}>${row[c.key] != null ? row[c.key] : ''}</td>`;
                                            })}
                                        </tr>
                                    `;
                                })}
                                ${pageRows.length === 0 ? html`<tr><td colspan=${columns.length} class="text-center text-gray-500" style="padding: 40px 0;">No results found</td></tr>` : null}
                            </tbody>
                        </table>
                    </div>
                    <div class="table-footer flex items-center justify-between" ref=${footRef}>
                        <p class="text-sm text-gray-500">${footerText}</p>
                        ${totalPages > 1 ? html`
                            <div class="flex items-center gap-2">
                                <button class="pagination-btn" disabled=${page <= 1} onClick=${function(){ if(page > 1) setPage(page - 1); }}>Previous</button>
                                ${Array.from({length: totalPages}, function(_, i) {
                                    return html`<button class=${'pagination-btn' + (page === i + 1 ? ' active' : '')} onClick=${function(){ setPage(i + 1); }}>${i + 1}</button>`;
                                })}
                                <button class="pagination-btn" disabled=${page >= totalPages} onClick=${function(){ if(page < totalPages) setPage(page + 1); }}>Next</button>
                            </div>
                        ` : null}
                    </div>
                </div>
            `;
        }

        function ScoreBar(props) {
            // props: { label, valueText, percent, statusClass, barColor }
            return html`
                <div class="flex items-center justify-between">
                    <span class="text-xs text-gray-300">${props.label}</span>
                    <div class="flex items-center gap-2">
                        <div style="width: 80px; height: 5px; background: var(--bg-card); border-radius: 3px; overflow: hidden;">
                            <div style=${"width: " + props.percent + "%; height: 100%; background: " + props.barColor + ";"}></div>
                        </div>
                        <span class=${"text-xs font-medium " + (props.statusClass || "text-gray-300")}>${props.valueText}</span>
                    </div>
                </div>
            `;
        }

        // --------------------------------------------------
        // Cards (Reusable)
        // --------------------------------------------------
        function DatabaseCard(props) {
            var borderColor = props.borderColor ? ("border-color: " + props.borderColor + ";") : "";
            return html`
                <div
                    class="card card-clickable"
                    data-nav=${props.nav}
                    style=${borderColor + " display: flex; flex-direction: column; gap: 12px; padding: 20px;"}
                >
                    <div class="flex items-start justify-between">
                        <div class="flex items-center gap-3">
                            <div style=${"width: 36px; height: 36px; background: " + props.iconBg + "; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"}>
                                <span style="font-size: 16px;">▤</span>
                            </div>
                            <div>
                                <h3 class="text-white font-semibold text-sm">${props.name}</h3>
                                <p class="text-xs text-gray-400 font-mono">${props.engine + " · " + props.region}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2" style="flex-shrink: 0;">
                            <span class=${"status-dot " + props.statusDot}></span>
                            <span class=${"text-xs " + props.statusTextClass}>${props.statusText}</span>
                        </div>
                    </div>

                    <${CardAlertSlot} alert=${props.alert || null} />

                    <${StatGrid} items=${props.stats} />
                    <${ConfigList} rows=${props.configRows} />
                </div>
            `;
        }

        function AgentCard(props) {
            var borderColor = props.borderColor ? ("border-color: " + props.borderColor + ";") : "";
            return html`
                <div
                    class="card card-clickable"
                    data-nav=${props.nav}
                    style=${borderColor + " display: flex; flex-direction: column; gap: 12px; padding: 20px;"}
                >
                    <div class="flex items-start justify-between">
                        <div class="flex items-center gap-3">
                            <div style=${"width: 36px; height: 36px; background: " + props.iconBg + "; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"}>
                                <span style="font-size: 16px;">${props.icon}</span>
                            </div>
                            <div>
                                <h3 class="text-white font-semibold text-sm">${props.name}</h3>
                                <p class="text-xs text-gray-400">${props.version}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2" style="flex-shrink: 0;">
                            <span class=${"status-dot " + props.statusDot}></span>
                            <span class=${"text-xs " + props.statusTextClass}>${props.statusText}</span>
                        </div>
                    </div>

                    <${CardAlertSlot} alert=${props.alert || null} />

                    <div class="flex items-center gap-2">
                        <span class="score-badge" style=${props.platformBadgeStyle}>${props.platformBadgeText}</span>
                        <span class="text-xs text-gray-500">${props.platformMeta}</span>
                    </div>

                    <div style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: 10px;">
                        <p class="text-xs text-gray-500 uppercase font-semibold" style="margin-bottom: 8px;">Usage (Last 24h)</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                            ${props.usageStats.map(function(s) {
                                return html`
                                    <div class="text-center">
                                        <p class="text-white font-semibold text-sm">${s.value}</p>
                                        <p class="text-xs text-gray-500">${s.label}</p>
                                    </div>
                                `;
                            })}
                        </div>
                    </div>

                    <div style="background: var(--bg-elevated); border-radius: var(--radius-md); padding: 10px;">
                        <div class="flex items-center justify-between" style="margin-bottom: 8px;">
                            <span class="text-xs text-gray-500 uppercase font-semibold">MLflow Judge Scores</span>
                            <span class="text-xs text-gray-400">${props.scoresUpdated}</span>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            ${props.scores.map(function(sc) {
                                return html`<${ScoreBar} ...${sc} />`;
                            })}
                        </div>
                    </div>
                </div>
            `;
        }

        // --------------------------------------------------
        // A2AAgentCard — Comprehensive A2A-style agent overview card
        // Shows: identity, skills, model, tools, guardrails, knowledge bases, A2A protocol config
        // --------------------------------------------------
        // --------------------------------------------------
        // PillBadge — reusable small tone badge
        // props: { text, kind? }
        // kind:
        // - 'tool' (MCP/RAG-style)
        // - 'neutral' (default)
        // --------------------------------------------------
        function PillBadge(props) {
            var text = (props && props.text != null) ? String(props.text) : '';
            var kind = props && props.kind ? String(props.kind) : '';
            var upper = text.toUpperCase();

            // Tool label tones reuse existing tool badge palette (consistent across UI)
            if (kind === 'tool' || upper === 'MCP' || upper === 'RAG') {
                var cls = 'tool-badge__label' + (upper === 'RAG' ? ' tool-badge__label--rag' : '');
                return html`<span class=${cls}>${upper}</span>`;
            }

            // Neutral fallback
            return html`
                <span style="font-size: 10px; color: var(--text-muted); background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); padding: 1px 8px; border-radius: 999px; font-weight: 800; letter-spacing: 0.04em; text-transform: uppercase; white-space: nowrap;">
                    ${upper || '—'}
                </span>
            `;
        }

        // --------------------------------------------------
        // MiniEntityCard — compact clickable card (agent/gateway)
        // props: { kind, name, subtitle, meta, favicon, nav, removable, onRemove }
        // --------------------------------------------------
        function MiniEntityCard(props) {
            var kind = props && props.kind ? String(props.kind) : 'agent';
            var name = props && props.name ? String(props.name) : '';
            var subtitle = props && props.subtitle ? String(props.subtitle) : '';
            var meta = props && props.meta ? String(props.meta) : '';
            var favicon = props && props.favicon ? String(props.favicon) : '';
            var nav = props && props.nav ? String(props.nav) : '';
            var removable = !!(props && props.removable);
            var onRemove = props && props.onRemove ? props.onRemove : function() {};

            var isLink = !!nav;
            var Root = isLink ? 'a' : 'div';
            var initials = (name || '').split(' ').filter(Boolean).slice(0, 2).map(function(p){ return p[0]; }).join('').toUpperCase();
            var avatarBg = kind === 'gateway' ? 'rgba(59,130,246,0.12)' : 'rgba(168,85,247,0.12)';
            var avatarBorder = kind === 'gateway' ? 'rgba(59,130,246,0.28)' : 'rgba(168,85,247,0.28)';
            var avatarColor = kind === 'gateway' ? '#60a5fa' : '#d8b4fe';

            return html`
                <${Root}
                    href=${isLink ? '#' : undefined}
                    onClick=${isLink ? function(e){ e.preventDefault(); window.showView(nav); } : undefined}
                    style="display: flex; align-items: flex-start; gap: 10px; padding: 8px 10px; border-radius: 12px; background: rgba(55,68,79,0.55); border: 1px solid rgba(232,236,240,0.10); cursor: ${isLink ? 'pointer' : 'default'}; transition: all 0.15s ease; text-decoration: none; width: 100%; max-width: 640px;"
                    onmouseenter=${function(e){ e.currentTarget.style.background='rgba(55,68,79,0.72)'; e.currentTarget.style.borderColor='rgba(232,236,240,0.16)'; }}
                    onmouseleave=${function(e){ e.currentTarget.style.background='rgba(55,68,79,0.55)'; e.currentTarget.style.borderColor='rgba(232,236,240,0.10)'; }}
                >
                    ${favicon ? html`<img src=${favicon} alt="" style="width: 18px; height: 18px; border-radius: 4px; flex-shrink: 0; margin-top: 1px;" />`
                        : html`
                            <div style=${"width: 18px; height: 18px; border-radius: 6px; flex-shrink: 0; margin-top: 1px; display: inline-flex; align-items: center; justify-content: center; background: " + avatarBg + "; border: 1px solid " + avatarBorder + "; color: " + avatarColor + "; font-size: 10px; font-weight: 900; letter-spacing: 0.04em;"}>
                                ${initials || '—'}
                            </div>
                        `
                    }
                    <div style="min-width: 0; flex: 1; display: flex; flex-direction: column; gap: 2px;">
                        <div style="display: flex; align-items: center; gap: 8px; min-width: 0;">
                            <span style="font-size: 12px; font-weight: 700; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${name}</span>
                            ${meta ? html`<span style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 700; opacity: 0.85; white-space: nowrap;">${meta}</span>` : null}
                        </div>
                        ${subtitle ? html`<div style="font-size: 11px; color: var(--text-muted); line-height: 1.35; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${subtitle}</div>` : null}
                    </div>
                    ${removable ? html`
                        <button
                            onClick=${function(e){ e.preventDefault(); e.stopPropagation(); onRemove(); }}
                            title="Remove"
                            style="width: 22px; height: 22px; border-radius: 8px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); color: var(--text-muted); cursor: pointer; font-size: 14px; line-height: 1; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0;"
                            onmouseenter=${function(e){ e.currentTarget.style.background='rgba(244,63,94,0.12)'; e.currentTarget.style.borderColor='rgba(244,63,94,0.25)'; e.currentTarget.style.color='#fb7185'; }}
                            onmouseleave=${function(e){ e.currentTarget.style.background='rgba(255,255,255,0.06)'; e.currentTarget.style.borderColor='rgba(255,255,255,0.10)'; e.currentTarget.style.color='var(--text-muted)'; }}
                        >×</button>
                    ` : null}
                <//>
            `;
        }

        // RegistryPicker — reusable searchable add-from-registry popover
        // props:
        // - triggerLabel, title, placeholder
        // - items: array
        // - getKey(item): string
        // - getSearchText(item): string
        // - isExcluded(item): boolean (e.g., already selected)
        // - getLeft(item): VNode
        // - getTitle(item): string
        // - getSubtitle(item): string
        // - getMeta(item): string
        // - onAdd(item): void
        // --------------------------------------------------
        function RegistryPicker(props) {
            var items = props.items || [];
            var getKey = props.getKey || function(it) { return it && it.name ? String(it.name) : ''; };
            var getSearchText = props.getSearchText || function(it) { return getKey(it); };
            var isExcluded = props.isExcluded || function() { return false; };
            var getLeft = props.getLeft || function() { return null; };
            var getTitle = props.getTitle || function(it) { return getKey(it); };
            var getSubtitle = props.getSubtitle || function() { return ''; };
            var getMeta = props.getMeta || function() { return ''; };
            var onAdd = props.onAdd || function() {};
            var showMeta = props.showMeta !== false;
            var renderMeta = props.renderMeta || function(meta) {
                if (!meta) return null;
                var upper = String(meta).toUpperCase();
                var kind = (upper === 'MCP' || upper === 'RAG') ? 'tool' : 'neutral';
                return html`<${PillBadge} text=${upper} kind=${kind} />`;
            };

            var triggerLabel = props.triggerLabel || '+ Add';
            var title = props.title || 'Registry';
            var placeholder = props.placeholder || 'Search...';

            var _open = useState(false);
            var open = _open[0];
            var setOpen = _open[1];

            var _q = useState('');
            var query = _q[0];
            var setQuery = _q[1];

            var panelRef = useRef(null);
            var inputRef = useRef(null);

            // Focus input when opening
            useEffect(function() {
                if (!open) return;
                setQuery('');
                setTimeout(function() {
                    if (inputRef && inputRef.current) inputRef.current.focus();
                }, 0);
            }, [open]);

            // Close on outside click
            useEffect(function() {
                if (!open) return;
                function onDocMouseDown(e) {
                    var el = panelRef && panelRef.current;
                    if (!el) return;
                    if (el.contains(e.target)) return;
                    setOpen(false);
                }
                document.addEventListener('mousedown', onDocMouseDown);
                return function() { document.removeEventListener('mousedown', onDocMouseDown); };
            }, [open]);

            var q = (query || '').toLowerCase().trim();
            var filtered = items.filter(function(it) {
                if (isExcluded(it)) return false;
                if (!q) return true;
                var hay = String(getSearchText(it) || '').toLowerCase();
                return hay.indexOf(q) !== -1;
            });

            return html`
                <div style="position: relative; display: inline-block;">
                    <button
                        onClick=${function(){ setOpen(!open); }}
                        style=${'font-size: 12px; color: var(--text-muted); background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); border-radius: 8px; padding: 6px 10px; cursor: pointer; font-weight: 700; transition: all 0.15s ease;'}
                        onmouseenter=${function(e){ e.currentTarget.style.borderColor='rgba(34,114,180,0.30)'; e.currentTarget.style.background='rgba(34,114,180,0.10)'; e.currentTarget.style.color='var(--color-primary)'; }}
                        onmouseleave=${function(e){ e.currentTarget.style.borderColor='rgba(255,255,255,0.10)'; e.currentTarget.style.background='rgba(255,255,255,0.06)'; e.currentTarget.style.color='var(--text-muted)'; }}
                    >${triggerLabel}</button>

                    ${open ? html`
                        <div ref=${panelRef} style="position: absolute; left: 0; top: calc(100% + 8px); width: min(520px, 72vw); border: 1px solid rgba(255,255,255,0.10); border-radius: 12px; background: rgba(20, 24, 32, 0.98); backdrop-filter: blur(10px); padding: 12px; z-index: 40; box-shadow: 0 18px 48px rgba(0,0,0,0.55);">
                            <div style="display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px;">
                                <div style="font-size: 11px; color: var(--text-muted); font-weight: 800; text-transform: uppercase; letter-spacing: 0.06em;">${title}</div>
                                <button
                                    onClick=${function(){ setOpen(false); }}
                                    style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 14px; opacity: 0.75;"
                                    onmouseenter=${function(e){ e.currentTarget.style.opacity='1'; }}
                                    onmouseleave=${function(e){ e.currentTarget.style.opacity='0.75'; }}
                                >✕</button>
                            </div>

                            <div style="position: relative;">
                                <input
                                    ref=${inputRef}
                                    type="text"
                                    placeholder=${placeholder}
                                    value=${query}
                                    onInput=${function(e){ setQuery(e.target.value); }}
                                    onKeyDown=${function(e){ if (e.key === 'Escape') { setOpen(false); } }}
                                    style="width: 100%; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 10px; padding: 9px 12px; color: var(--text-primary); font-size: 12px; outline: none;"
                                />
                            </div>

                            <div style="margin-top: 10px; border: 1px solid rgba(255,255,255,0.10); border-radius: 12px; overflow: hidden; max-height: 260px; overflow-y: auto;">
                                ${filtered.length ? filtered.map(function(it) {
                                    var left = getLeft(it);
                                    var t = getTitle(it);
                                    var sub = getSubtitle(it);
                                    var meta = getMeta(it);
                                    return html`
                                        <div
                                            style="padding: 10px 12px; cursor: pointer; display: flex; align-items: flex-start; gap: 10px; transition: background 0.1s ease;"
                                            onmouseenter=${function(e){ e.currentTarget.style.background='rgba(255,255,255,0.06)'; }}
                                            onmouseleave=${function(e){ e.currentTarget.style.background=''; }}
                                            onmousedown=${function(e){ e.preventDefault(); onAdd(it); setOpen(false); }}
                                        >
                                            ${left ? html`<div style="margin-top: 1px; flex-shrink: 0;">${left}</div>` : null}
                                            <div style="min-width: 0; flex: 1;">
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <div style="font-size: 12px; font-weight: 800; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${t}</div>
                                                    ${(showMeta && meta) ? renderMeta(meta) : null}
                                                </div>
                                                ${sub ? html`<div style="font-size: 11px; color: var(--text-muted); line-height: 1.35; margin-top: 2px;">${sub}</div>` : null}
                                            </div>
                                            <div style="font-size: 10px; color: var(--text-muted); opacity: 0.85; white-space: nowrap; margin-top: 2px;">Add</div>
                                        </div>
                                    `;
                                }) : html`
                                    <div style="padding: 12px; font-size: 12px; color: var(--text-muted);">No matching results</div>
                                `}
                            </div>
                        </div>
                    ` : null}
                </div>
            `;
        }

        function A2AAgentCard(props) {
            var _mode = useState(props.discoveryMode || 'public');
            var discoveryMode = _mode[0];
            var setDiscoveryMode = _mode[1];

            var _entries = useState(props.discoveryEntries || []);
            var discoveryEntries = _entries[0];
            var setDiscoveryEntries = _entries[1];

            var _newEntry = useState('');
            var newEntryValue = _newEntry[0];
            var setNewEntry = _newEntry[1];

            var _showSuggestions = useState(false);
            var showSuggestions = _showSuggestions[0];
            var setShowSuggestions = _showSuggestions[1];

            // Keep suggestions stable while editing; close only on outside click / explicit actions.
            var discoveryPanelRef = useRef(null);

            var knownAgents = props.knownAgents || [
                'Email Drafting Assistant',
                'Product Advisor Agent',
                'Knowledge Base Q&A',
                'Document Summarizer',
                'Compliance Checker'
            ];

            // Minimal agent registry for summaries + nav (used by A2A Discovery mini cards)
            var knownAgentsRegistry = props.knownAgentsRegistry || [
                {
                    name: 'Customer Support Bot',
                    nav: 'agent-detail-cs',
                    summary: 'Customer support agent powered by retrieval-augmented generation. Provides live chat support and semantic search over the support knowledge base to resolve queries with grounded, citation-backed responses.'
                },
                {
                    name: 'Product Advisor Agent',
                    nav: 'agent-detail-pa',
                    summary: 'Guides customers to the right products using preferences, catalog constraints, and policy-aware recommendations, with tool-assisted lookups and citations.'
                },
                {
                    name: 'Email Drafting Assistant',
                    nav: 'agents',
                    summary: 'Drafts high-quality customer emails with tone control, template adherence, and compliance-safe phrasing. Can summarize context and propose next-step actions.'
                },
                {
                    name: 'Document Summarizer',
                    nav: 'agents',
                    summary: 'Summarizes long documents into structured highlights, decisions, and action items, preserving key citations and sections.'
                },
                {
                    name: 'Knowledge Base Q&A',
                    nav: 'agents',
                    summary: 'Answers questions from internal knowledge bases using RAG retrieval and citation-backed responses, optimized for high precision.'
                },
                {
                    name: 'Compliance Checker',
                    nav: 'agents',
                    summary: 'Checks drafts and responses against policy constraints (PII, legal disclaimers, regulated topics) and flags risky outputs.'
                }
            ];

            function resolveAgentRegistry(name) {
                var n = String(name || '').toLowerCase();
                var hit = (knownAgentsRegistry || []).find(function(a) { return a && String(a.name || '').toLowerCase() === n; });
                if (hit) return hit;
                // Loose matching
                var loose = (knownAgentsRegistry || []).find(function(a) { return a && n.indexOf(String(a.name || '').toLowerCase()) !== -1; });
                if (loose) return loose;
                return { name: name, nav: 'agents', summary: 'Agent available for discovery and interaction.' };
            }

            var knownGateways = props.knownGateways || [
                { name: 'API Gateway (us-east-1)', id: 'gw-us-east-1', env: 'mlflow', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=mlflow.org' },
                { name: 'API Gateway (eu-west-1)', id: 'gw-eu-west-1', env: 'mlflow', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=mlflow.org' },
                { name: 'Partner Gateway', id: 'gw-partner', env: 'openshift', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=openshift.com' }
            ];

            // Source tab: 'agents' or 'gateways'
            var _sourceTab = useState('agents');
            var sourceTab = _sourceTab[0];
            var setSourceTab = _sourceTab[1];

            function addDiscoveryEntry(value, type, meta) {
                var trimmed = (value || '').trim();
                if (!trimmed) return;
                var exists = discoveryEntries.some(function(e) { return e.value === trimmed; });
                if (exists) return;
                var entryType = (type === 'gateway') ? 'gateway' : 'agent';
                var extra = (meta && typeof meta === 'object') ? meta : null;
                var entry = { value: trimmed, type: entryType };
                if (extra) {
                    if (extra.id) entry.id = extra.id;
                    if (extra.env) entry.env = extra.env;
                    if (extra.favicon) entry.favicon = extra.favicon;
                }
                setDiscoveryEntries(discoveryEntries.concat([entry]));
                setNewEntry('');
                setShowSuggestions(false);
            }

            function removeDiscoveryEntry(idx) {
                setDiscoveryEntries(discoveryEntries.filter(function(_, i) { return i !== idx; }));
            }

            // Auto-switch away from public when entries are added
            useEffect(function() {
                if (discoveryEntries.length > 0 && discoveryMode === 'public') {
                    setDiscoveryMode('whitelist');
                }
            }, [discoveryEntries.length, discoveryMode]);

            // Click-outside handler to close suggestions (and optionally the dropdown) without fighting input focus.
            useEffect(function() {
                if (!showSuggestions) return;
                function onDocMouseDown(e) {
                    var el = discoveryPanelRef && discoveryPanelRef.current;
                    if (!el) return;
                    if (el.contains(e.target)) return;
                    setShowSuggestions(false);
                }
                document.addEventListener('mousedown', onDocMouseDown);
                return function() { document.removeEventListener('mousedown', onDocMouseDown); };
            }, [showSuggestions]);

            var _editing = useState(false);
            var isEditing = _editing[0];
            var setIsEditing = _editing[1];

            // Collapsible section state (all open by default)
            var _collapsed = useState({});
            var collapsed = _collapsed[0];
            var setCollapsed = _collapsed[1];
            function toggleSection(key) {
                var next = {};
                for (var k in collapsed) next[k] = collapsed[k];
                next[key] = !collapsed[key];
                setCollapsed(next);
            }

            // Editable field states
            var _url = useState(props.serviceUrl || 'https://agents.acme-corp.com/.well-known/agent-card.json');
            var agentUrl = _url[0]; var setAgentUrl = _url[1];

            var _desc = useState(props.cardDescription || '');
            var agentDesc = _desc[0]; var setAgentDesc = _desc[1];

            var _inputModes = useState((props.inputModes || ['text/plain', 'application/json']).join(', '));
            var inputModes = _inputModes[0]; var setInputModes = _inputModes[1];

            var _outputModes = useState((props.outputModes || ['text/plain', 'application/json']).join(', '));
            var outputModes = _outputModes[0]; var setOutputModes = _outputModes[1];

            var repoPath = props.sourceRepo ? (props.sourceRepo.path + (props.sourceRepo.branch ? ':' + props.sourceRepo.branch : '')) : '';
            var repoUrl = props.sourceRepo ? (props.sourceRepo.url || '#') : '#';
            var containerUri = props.containerImage ? (props.containerImage.uri || '') : '';

            // Style tokens
            var cardBg = 'transparent';
            var cardBorder = 'rgba(255,255,255,0.12)';
            var sectionDivider = 'border-top: 1px solid rgba(255,255,255,0.06); padding-top: 16px; margin-top: 16px;';
            var labelStyle = 'font-size: 11px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; white-space: nowrap;';
            var sectionTitleStyle = 'font-size: 12px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin: 0; display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;';
            var monoStyle = 'font-size: 12px; color: var(--text-secondary); font-family: var(--font-mono, monospace);';
            var inputStyle = 'background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 6px; padding: 4px 8px; color: var(--text-primary); font-size: 12px; font-family: var(--font-mono, monospace); width: 100%; outline: none;';
            var badgeEnabled = 'font-size: 11px; padding: 3px 10px; border-radius: 999px; background: rgba(16,185,129,0.12); color: #10b981; border: 1px solid rgba(16,185,129,0.25); font-weight: 600;';
            var badgeDisabled = 'font-size: 11px; padding: 3px 10px; border-radius: 999px; background: rgba(255,255,255,0.06); color: var(--text-muted); border: 1px solid rgba(255,255,255,0.1); font-weight: 500;';
            var countBadge = 'font-size: 10px; color: var(--text-muted); background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); border-radius: 999px; padding: 1px 8px; font-weight: 500; text-transform: none; letter-spacing: 0;';

            // Data
            var _skills = useState(props.skills || []);
            var skills = _skills[0];
            var setSkills = _skills[1];

            var _tools = useState(props.tools || []);
            var tools = _tools[0];
            var setTools = _tools[1];

            var _guardrails = useState(props.guardrails || []);
            var guardrails = _guardrails[0];
            var setGuardrails = _guardrails[1];

            var model = props.model || null;
            var _cap = useState(props.capabilities || { streaming: true, pushNotifications: true, stateTransitionHistory: false });
            var capabilities = _cap[0];
            var setCapabilities = _cap[1];

            var baseAuth = props.authentication || { schemes: ['Bearer'], protocols: ['OAuth 2.0', 'OIDC'] };
            var knownAuthTypes = props.knownAuthTypes || [
                'Bearer Token',
                'API Key',
                'OAuth 2.0',
                'OIDC',
                'mTLS',
                'HMAC Signed',
                'None'
            ];

            function uniq(list) {
                var out = [];
                (list || []).forEach(function(x) {
                    if (!x) return;
                    if (out.indexOf(x) !== -1) return;
                    out.push(x);
                });
                return out;
            }

            function normalizeAuthType(t) {
                var s = String(t || '').trim();
                if (!s) return '';
                if (s.toLowerCase() === 'bearer') return 'Bearer Token';
                if (s.toLowerCase() === 'api-key' || s.toLowerCase() === 'apikey') return 'API Key';
                return s;
            }

            var _authTypes = useState(uniq([]
                .concat((baseAuth.schemes || []).map(normalizeAuthType))
                .concat((baseAuth.protocols || []).map(normalizeAuthType))
            ).filter(Boolean));
            var authTypes = _authTypes[0];
            var setAuthTypes = _authTypes[1];

            function toggleAuthType(type) {
                var t = normalizeAuthType(type);
                if (!t) return;
                setAuthTypes(function(prev) {
                    var list = prev || [];
                    var exists = list.indexOf(t) !== -1;
                    // 'None' is mutually exclusive
                    if (t === 'None') return ['None'];
                    var next = exists ? list.filter(function(x){ return x !== t; }) : list.concat([t]);
                    next = next.filter(function(x){ return x !== 'None'; });
                    return uniq(next);
                });
            }

            function removeAuthType(type) {
                var t = normalizeAuthType(type);
                setAuthTypes(function(prev) {
                    var list = prev || [];
                    return list.filter(function(x){ return x !== t; });
                });
            }

            function toggleCapability(key) {
                setCapabilities(function(prev) {
                    var p = prev || {};
                    var next = {};
                    for (var k in p) next[k] = p[k];
                    next[key] = !p[key];
                    return next;
                });
            }

            var _providerOrg = useState((props.provider && props.provider.organization) ? props.provider.organization : '');
            var providerOrg = _providerOrg[0];
            var setProviderOrg = _providerOrg[1];
            var _providerTeam = useState((props.provider && props.provider.team) ? props.provider.team : '');
            var providerTeam = _providerTeam[0];
            var setProviderTeam = _providerTeam[1];

            // Filtered suggestions based on source tab
            var filteredAgentSuggestions = knownAgents.filter(function(a) {
                var alreadyAdded = discoveryEntries.some(function(e) { return e.value === a; });
                if (alreadyAdded) return false;
                if (newEntryValue.trim().length > 0) {
                    return a.toLowerCase().indexOf(newEntryValue.toLowerCase()) !== -1;
                }
                return true;
            });
            var filteredGatewaySuggestions = knownGateways.filter(function(g) {
                var alreadyAdded = discoveryEntries.some(function(e) { return e.value === g.name; });
                if (alreadyAdded) return false;
                if (newEntryValue.trim().length > 0) {
                    return g.name.toLowerCase().indexOf(newEntryValue.toLowerCase()) !== -1;
                }
                return true;
            });

            // Skill card color palette (cycles)
            var skillColors = [
                { bg: 'rgba(59,130,246,0.10)', border: 'rgba(59,130,246,0.25)', text: '#60a5fa' },
                { bg: 'rgba(16,185,129,0.10)', border: 'rgba(16,185,129,0.25)', text: '#10b981' },
                { bg: 'rgba(168,85,247,0.10)', border: 'rgba(168,85,247,0.25)', text: '#a855f7' },
                { bg: 'rgba(251,191,36,0.10)', border: 'rgba(251,191,36,0.25)', text: '#fbbf24' },
                { bg: 'rgba(244,63,94,0.10)', border: 'rgba(244,63,94,0.25)', text: '#f43e5e' },
                { bg: 'rgba(34,211,238,0.10)', border: 'rgba(34,211,238,0.25)', text: '#22d3ee' }
            ];

            // Registry: Skills / Tools / Guardrails (local demo registry)
            var knownSkills = props.knownSkills || [
                { name: 'Ticket Triage', icon: '🧾', description: 'Classify issues, route to queues, and apply SLA priority labels.', tags: ['zendesk', 'sla'], examples: ['triage: \"Login issue\" → P1 auth queue'] },
                { name: 'Order Lookup', icon: '📦', description: 'Fetch order status, shipping ETAs, and delivery exceptions.', tags: ['commerce'], examples: ['lookup order 104922'] },
                { name: 'Refund & Returns', icon: '↩️', description: 'Validate eligibility, initiate refunds, and generate return labels.', tags: ['policy'], examples: ['start return for order 104922'] },
                { name: 'Escalation Handler', icon: '🧑‍💼', description: 'Escalate to a human agent with context and recommended next steps.', tags: ['handoff'], examples: ['escalate: billing dispute'] },
                { name: 'FAQ Answering', icon: '📚', description: 'Answer common questions using RAG sources with citations.', tags: ['rag'], examples: ['do you ship internationally?'] }
            ];

            function addSkillFromRegistry(skill) {
                if (!skill || !skill.name) return;
                setSkills(function(prev) {
                    var list = prev || [];
                    var exists = list.some(function(x) { return x && x.name === skill.name; });
                    if (exists) return list;
                    return list.concat([skill]);
                });
            }

            function removeSkillByName(name) {
                setSkills(function(prev) {
                    var list = prev || [];
                    return list.filter(function(x) { return x && x.name !== name; });
                });
            }

            var knownTools = props.knownTools || [
                { name: 'MCP Slack v3', label: 'MCP', nav: 'tools', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=slack.com' },
                { name: 'MCP GitHub v2', label: 'MCP', nav: 'tools', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=github.com' },
                { name: 'MCP Notion v1', label: 'MCP', nav: 'tools', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=notion.so' },
                { name: 'MCP PagerDuty v1', label: 'MCP', nav: 'tools', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=pagerduty.com' },
                { name: 'product-knowledge-store', label: 'RAG', nav: 'db-detail-pks', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=trychroma.com' },
                { name: 'support-articles', label: 'RAG', nav: 'db-detail-sup', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=milvus.io' }
            ];

            function addToolFromRegistry(tool) {
                if (!tool || !tool.name) return;
                setTools(function(prev) {
                    var list = prev || [];
                    var exists = list.some(function(x) { return x && x.name === tool.name; });
                    if (exists) return list;
                    return list.concat([tool]);
                });
            }

            function removeToolByName(name) {
                setTools(function(prev) {
                    var list = prev || [];
                    return list.filter(function(x) { return x && x.name !== name; });
                });
            }

            var knownGuardrails = props.knownGuardrails || [
                { name: 'PII Redaction', severity: 'critical', provider: 'Guardrails AI', env: 'prod', description: 'Detect and redact PII (SSN, CCN, email, phone) before responses.', nav: 'guardrails' },
                { name: 'Jailbreak Shield', severity: 'critical', provider: 'LlamaGuard', env: 'prod', description: 'Block prompt-injection/jailbreak attempts and unsafe policy bypasses.', nav: 'guardrails' },
                { name: 'Toxicity Filter', severity: 'high', provider: 'OpenAI', env: 'prod', description: 'Reject hateful, harassing, or explicit content in both input and output.', nav: 'guardrails' },
                { name: 'PHI Classifier', severity: 'high', provider: 'NVIDIA', env: 'staging', description: 'Detect health information to enforce stricter redaction and logging rules.', nav: 'guardrails' },
                { name: 'Policy Compliance', severity: 'medium', provider: 'Acme', env: 'prod', description: 'Enforce internal policy rules around refunds, pricing, and legal disclaimers.', nav: 'guardrails' }
            ];

            function addGuardrailFromRegistry(guardrail) {
                if (!guardrail || !guardrail.name) return;
                setGuardrails(function(prev) {
                    var list = prev || [];
                    var exists = list.some(function(x) { return x && x.name === guardrail.name; });
                    if (exists) return list;
                    return list.concat([guardrail]);
                });
            }

            function removeGuardrailByName(name) {
                setGuardrails(function(prev) {
                    var list = prev || [];
                    return list.filter(function(x) { return x && x.name !== name; });
                });
            }

            // Section header helper
            function SectionHeader(p) {
                var isOpen = !collapsed[p.id];
                return html`
                    <div style=${sectionDivider}>
                        <div style=${sectionTitleStyle} onClick=${function(){ toggleSection(p.id); }}>
                            <span style=${'transition: transform 0.2s ease; display: inline-block; font-size: 10px; transform: rotate(' + (isOpen ? '90deg' : '0deg') + ');'}>▶</span>
                            <span>${p.label}</span>
                            ${p.count != null ? html`<span style=${countBadge}>${p.count}</span>` : null}
                        </div>
                        ${isOpen ? html`<div style="margin-top: 10px;">${p.children}</div>` : null}
                    </div>
                `;
            }

            return html`
                <div style=${'background: ' + cardBg + '; border: 1px solid ' + cardBorder + '; border-radius: var(--radius-lg); padding: 20px 24px; position: relative;'}>

                    <!-- ===== Card Header ===== -->
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--text-primary); flex-shrink: 0;">
                                <rect x="2" y="3" width="20" height="18" rx="3"/>
                                <path d="M8 7h8M8 11h5M8 15h3"/>
                            </svg>
                            <span style="font-size: 13px; font-weight: 700; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.08em;">Agent Card</span>
                            <span style="font-size: 10px; color: var(--text-muted); background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-radius: 999px; padding: 1px 8px; font-family: var(--font-mono, monospace);">A2A v1.0</span>
                        </div>
                        <button
                            onClick=${function(){ setIsEditing(!isEditing); }}
                            style=${'font-size: 12px; color: ' + (isEditing ? 'var(--color-primary)' : 'var(--text-muted)') + '; background: ' + (isEditing ? 'rgba(34,114,180,0.15)' : 'rgba(255,255,255,0.06)') + '; border: 1px solid ' + (isEditing ? 'rgba(34,114,180,0.3)' : 'rgba(255,255,255,0.1)') + '; border-radius: 6px; padding: 4px 12px; cursor: pointer; font-weight: 600; transition: all 0.15s ease;'}
                        >
                            ${isEditing ? '✓ Done' : '✎ Edit'}
                        </button>
                    </div>

                    <!-- ===== Identity & Infrastructure ===== -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px 24px;">
                        <!-- Provider -->
                        <div>
                            <div style=${labelStyle}>Provider</div>
                            ${isEditing ? html`
                                <div style="display: flex; gap: 8px; margin-top: 3px;">
                                    <input type="text" value=${providerOrg} onInput=${function(e){ setProviderOrg(e.target.value); }} placeholder="Organization" style=${inputStyle + ' flex: 1;'} />
                                    <input type="text" value=${providerTeam} onInput=${function(e){ setProviderTeam(e.target.value); }} placeholder="Team (optional)" style=${inputStyle + ' flex: 1;'} />
                                </div>
                            ` : html`
                                <div style="font-size: 13px; color: var(--text-primary); font-weight: 500; margin-top: 3px;">
                                    ${providerOrg || '—'}${providerTeam ? html` · <span style="color: var(--text-secondary); font-weight: 400;">${providerTeam}</span>` : ''}
                                </div>
                            `}
                        </div>

                        <!-- Version + Created -->
                        <div>
                            <div style=${labelStyle}>Version</div>
                            <div style="margin-top: 3px; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 999px; padding: 2px 10px; font-family: var(--font-mono, monospace); font-weight: 600;">${props.version}</span>
                                ${props.created ? html`<span style="font-size: 12px; color: var(--text-muted);">Created ${props.created}</span>` : null}
                            </div>
                        </div>

                        <!-- Source Repository -->
                        ${props.sourceRepo ? html`
                            <div>
                                <div style=${labelStyle}>Source Repository</div>
                                <div style="margin-top: 3px; display: flex; align-items: center; gap: 6px;">
                                    <img src="https://www.google.com/s2/favicons?sz=64&domain=github.com" alt="" style="width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0;" />
                                    <a href=${repoUrl} style=${monoStyle + ' text-decoration: none;'} onmouseenter=${function(e){ e.target.style.textDecoration='underline'; }} onmouseleave=${function(e){ e.target.style.textDecoration='none'; }}>${repoPath}</a>
                                </div>
                            </div>
                        ` : null}

                        <!-- Container Image -->
                        ${props.containerImage ? html`
                            <div>
                                <div style=${labelStyle}>Container Image</div>
                                <div style="margin-top: 3px; display: flex; align-items: center; gap: 6px;">
                                    <img src="https://www.google.com/s2/favicons?sz=64&domain=github.com" alt="" style="width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0;" />
                                    <a href=${props.containerRegistryUrl || '#'} style=${monoStyle + ' text-decoration: none;'} onmouseenter=${function(e){ e.target.style.textDecoration='underline'; }} onmouseleave=${function(e){ e.target.style.textDecoration='none'; }}>${containerUri}</a>
                                </div>
                            </div>
                        ` : null}

                        <!-- Service URL (full-width) -->
                        <div style="grid-column: 1 / -1;">
                            <div style=${labelStyle}>Service URL</div>
                            ${isEditing
                                ? html`<input type="text" value=${agentUrl} onInput=${function(e){ setAgentUrl(e.target.value); }} style=${inputStyle + ' margin-top: 3px;'} />`
                                : html`
                                    <div style="margin-top: 3px; display: flex; align-items: center; gap: 6px;">
                                        <span style="font-size: 12px; opacity: 0.75;">🔗</span>
                                        <a href=${agentUrl || '#'} style=${monoStyle + ' text-decoration: none;'} onmouseenter=${function(e){ e.target.style.textDecoration='underline'; }} onmouseleave=${function(e){ e.target.style.textDecoration='none'; }}>${agentUrl || '—'}</a>
                                    </div>
                                `
                            }
                        </div>

                        <!-- Description (full-width) -->
                        <div style="grid-column: 1 / -1;">
                            <div style=${labelStyle}>Description</div>
                            ${isEditing
                                ? html`<textarea rows="2" value=${agentDesc} onInput=${function(e){ setAgentDesc(e.target.value); }} style=${'background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 6px; padding: 4px 8px; color: var(--text-primary); font-size: 13px; font-family: inherit; width: 100%; outline: none; resize: vertical; min-height: 40px;'} />`
                                : html`<div style=${'font-size: 13px; color: var(--text-secondary); margin-top: 3px; line-height: 1.5;'}>${agentDesc}</div>`
                            }
                        </div>

                    </div>

                    <!-- ===== Golden Deployment ===== -->
                    ${model ? html`
                        <${SectionHeader} id="golden" label="Golden Deployment">
                            <div style="font-size: 11px; color: var(--text-muted); line-height: 1.5; margin-bottom: 10px;">
                                Recommended deployment configuration derived from the highest-scoring evaluation run. These settings produced the best combined quality, safety, and latency results across all test suites.
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: stretch;">
                                <div style="display: flex; align-items: center; gap: 10px; padding: 10px 16px; border-radius: 10px; background: rgba(55,68,79,0.55); border: 1px solid rgba(232,236,240,0.10);">
                                    <span style="font-size: 18px;">🧠</span>
                                    <div>
                                        <div style="font-size: 13px; font-weight: 600; color: var(--text-primary);">${model.name}</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">${model.provider}${model.contextWindow ? ' · ' + model.contextWindow + ' context' : ''}</div>
                                    </div>
                                </div>
                                ${model.prompt ? html`
                                    <div
                                        style="display: flex; align-items: center; gap: 10px; padding: 10px 16px; border-radius: 10px; background: rgba(55,68,79,0.55); border: 1px solid rgba(232,236,240,0.10); cursor: pointer; transition: all 0.15s ease;"
                                        data-nav=${model.prompt.nav || ''}
                                        onClick=${function(e){ if (model.prompt.nav) { e.preventDefault(); window.showView(model.prompt.nav); } }}
                                        onmouseenter=${function(e){ e.currentTarget.style.background='rgba(55,68,79,0.72)'; e.currentTarget.style.borderColor='rgba(232,236,240,0.16)'; }}
                                        onmouseleave=${function(e){ e.currentTarget.style.background='rgba(55,68,79,0.55)'; e.currentTarget.style.borderColor='rgba(232,236,240,0.10)'; }}
                                    >
                                        <span style="font-size: 16px;">📝</span>
                                        <div style="flex: 1; min-width: 0;">
                                            <div style="font-size: 12px; font-weight: 600; color: var(--text-primary);">${model.prompt.name}</div>
                                            <div style="font-size: 11px; color: var(--text-muted);">System Prompt</div>
                                        </div>
                                        <span style="font-size: 10px; color: #a855f7; background: rgba(168,85,247,0.15); border: 1px solid rgba(168,85,247,0.25); border-radius: 999px; padding: 1px 8px; font-family: var(--font-mono, monospace); font-weight: 600; white-space: nowrap;">${model.prompt.version}</span>
                                    </div>
                                ` : null}
                                ${model.temperature != null ? html`
                                    <div style="display: flex; align-items: center; gap: 6px; padding: 8px 14px; border-radius: 10px; background: rgba(55,68,79,0.55); border: 1px solid rgba(232,236,240,0.10);">
                                        <span style="font-size: 11px; color: var(--text-muted);">Temperature</span>
                                        <span style="font-size: 13px; color: var(--text-primary); font-family: var(--font-mono, monospace); font-weight: 600;">${model.temperature}</span>
                                    </div>
                                ` : null}
                                ${model.maxTokens ? html`
                                    <div style="display: flex; align-items: center; gap: 6px; padding: 8px 14px; border-radius: 10px; background: rgba(55,68,79,0.55); border: 1px solid rgba(232,236,240,0.10);">
                                        <span style="font-size: 11px; color: var(--text-muted);">Max Tokens</span>
                                        <span style="font-size: 13px; color: var(--text-primary); font-family: var(--font-mono, monospace); font-weight: 600;">${model.maxTokens}</span>
                                    </div>
                                ` : null}
                            </div>
                        <//>
                    ` : null}

                    <!-- ===== Skills ===== -->
                    ${(skills.length > 0 || isEditing) ? html`
                        <${SectionHeader} id="skills" label="Skills" count=${skills.length}>
                            ${skills.length ? html`
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 8px;">
                                    ${skills.map(function(skill, i) {
                                        return html`
                                            <div style="padding: 10px 14px; border-radius: 10px; background: rgba(55,68,79,0.55); border: 1px solid rgba(232,236,240,0.10); display: flex; flex-direction: column; gap: 4px; position: relative;">
                                                ${isEditing ? html`
                                                    <button
                                                        onClick=${function(){ removeSkillByName(skill.name); }}
                                                        title="Remove"
                                                        style="position: absolute; top: 8px; right: 8px; width: 22px; height: 22px; border-radius: 6px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); color: var(--text-muted); cursor: pointer; font-size: 14px; line-height: 1; display: inline-flex; align-items: center; justify-content: center;"
                                                        onmouseenter=${function(e){ e.currentTarget.style.background='rgba(244,63,94,0.12)'; e.currentTarget.style.borderColor='rgba(244,63,94,0.25)'; e.currentTarget.style.color='#fb7185'; }}
                                                        onmouseleave=${function(e){ e.currentTarget.style.background='rgba(255,255,255,0.06)'; e.currentTarget.style.borderColor='rgba(255,255,255,0.10)'; e.currentTarget.style.color='var(--text-muted)'; }}
                                                    >×</button>
                                                ` : null}
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <span style="font-size: 16px;">${skill.icon || '⚡'}</span>
                                                    <span style="font-size: 13px; font-weight: 600; color: var(--text-primary);">${skill.name}</span>
                                                </div>
                                                <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.4;">${skill.description}</div>
                                                ${skill.tags && skill.tags.length ? html`
                                                    <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-top: 2px;">
                                                        ${skill.tags.map(function(tag) {
                                                            return html`<span style="font-size: 9px; padding: 1px 6px; border-radius: 999px; background: rgba(255,255,255,0.06); color: var(--text-muted); border: 1px solid rgba(255,255,255,0.08); font-weight: 500;">${tag}</span>`;
                                                        })}
                                                    </div>
                                                ` : null}
                                                ${skill.examples && skill.examples.length ? html`
                                                    <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px; font-style: italic;">e.g. "${skill.examples[0]}"</div>
                                                ` : null}
                                            </div>
                                        `;
                                    })}
                                </div>
                            ` : html`
                                <div style="font-size: 12px; color: var(--text-muted);">No skills configured.</div>
                            `}

                            ${isEditing ? html`
                                <div style="margin-top: 12px;">
                                    <${RegistryPicker}
                                        triggerLabel="+ Add Skill"
                                        title="Skill Registry"
                                        placeholder="Search skills..."
                                        items=${knownSkills}
                                        getKey=${function(s){ return s && s.name ? String(s.name) : ''; }}
                                        getSearchText=${function(s){ return (s && s.name ? s.name : '') + ' ' + (s && s.description ? s.description : '') + ' ' + ((s && s.tags) ? s.tags.join(' ') : ''); }}
                                        isExcluded=${function(s){ return skills.some(function(x){ return x && x.name === (s && s.name); }); }}
                                        getLeft=${function(s){ return html`<span style="font-size: 14px; opacity: 0.85;">${(s && s.icon) ? s.icon : '⚡'}</span>`; }}
                                        getTitle=${function(s){ return s && s.name ? s.name : ''; }}
                                        getSubtitle=${function(s){ return s && s.description ? s.description : ''; }}
                                        onAdd=${function(s){ addSkillFromRegistry(s); }}
                                    />
                                </div>
                            ` : null}
                        <//>
                    ` : null}

                    <!-- ===== Tools & Integrations ===== -->
                    ${(tools.length > 0 || isEditing) ? html`
                        <${SectionHeader} id="tools" label="Tools & Integrations" count=${tools.length}>
                            ${tools.length ? html`
                                <div style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
                                    ${tools.map(function(tool) {
                                        return html`
                                            <span style="position: relative; display: inline-flex; align-items: center;">
                                                <${ToolBadge} tool=${tool} />
                                                ${isEditing ? html`
                                                    <button
                                                        onClick=${function(e){ e.preventDefault(); e.stopPropagation(); removeToolByName(tool.name); }}
                                                        title="Remove"
                                                        style="position: absolute; top: -7px; right: -7px; width: 18px; height: 18px; border-radius: 999px; background: rgba(244,63,94,0.14); border: 1px solid rgba(244,63,94,0.28); color: #fb7185; cursor: pointer; font-size: 12px; line-height: 1; display: inline-flex; align-items: center; justify-content: center;"
                                                    >×</button>
                                                ` : null}
                                            </span>
                                        `;
                                    })}
                                </div>
                            ` : html`
                                <div style="font-size: 12px; color: var(--text-muted);">No tools configured.</div>
                            `}

                            ${isEditing ? html`
                                <div style="margin-top: 12px;">
                                    <${RegistryPicker}
                                        triggerLabel="+ Add Tool"
                                        title="Tool Registry"
                                        placeholder="Search tools..."
                                        items=${knownTools}
                                        getKey=${function(t){ return t && t.name ? String(t.name) : ''; }}
                                        getSearchText=${function(t){ return (t && t.name ? t.name : '') + ' ' + (t && t.label ? t.label : ''); }}
                                        isExcluded=${function(t){ return tools.some(function(x){ return x && x.name === (t && t.name); }); }}
                                        getLeft=${function(t){ return (t && t.favicon) ? html`<img src=${t.favicon} alt="" style="width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0;" />` : html`<span style="font-size: 12px; opacity: 0.75;">🔌</span>`; }}
                                        getTitle=${function(t){ return t && t.name ? t.name : ''; }}
                                        getMeta=${function(t){ return t && t.label ? t.label : ''; }}
                                        onAdd=${function(t){ addToolFromRegistry(t); }}
                                    />
                                </div>
                            ` : null}
                        <//>
                    ` : null}

                    <!-- ===== Guardrails ===== -->
                    ${(guardrails.length > 0 || isEditing) ? html`
                        <${SectionHeader} id="guardrails" label="Guardrails" count=${guardrails.length}>
                            ${guardrails.length ? html`
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 8px;">
                                    ${guardrails.map(function(g) {
                                        return html`
                                            <span style="position: relative;">
                                                <${GuardrailBadge} guardrail=${g} />
                                                ${isEditing ? html`
                                                    <button
                                                        onClick=${function(e){ e.preventDefault(); e.stopPropagation(); removeGuardrailByName(g.name); }}
                                                        title="Remove"
                                                        style="position: absolute; top: -7px; right: -7px; width: 18px; height: 18px; border-radius: 999px; background: rgba(244,63,94,0.14); border: 1px solid rgba(244,63,94,0.28); color: #fb7185; cursor: pointer; font-size: 12px; line-height: 1; display: inline-flex; align-items: center; justify-content: center;"
                                                    >×</button>
                                                ` : null}
                                            </span>
                                        `;
                                    })}
                                </div>
                            ` : html`
                                <div style="font-size: 12px; color: var(--text-muted);">No guardrails configured.</div>
                            `}

                            ${isEditing ? html`
                                <div style="margin-top: 12px;">
                                    <${RegistryPicker}
                                        triggerLabel="+ Add Guardrail"
                                        title="Guardrail Registry"
                                        placeholder="Search guardrails..."
                                        items=${knownGuardrails}
                                        getKey=${function(g){ return g && g.name ? String(g.name) : ''; }}
                                        getSearchText=${function(g){ return (g && g.name ? g.name : '') + ' ' + (g && g.description ? g.description : '') + ' ' + (g && g.severity ? g.severity : ''); }}
                                        isExcluded=${function(g){ return guardrails.some(function(x){ return x && x.name === (g && g.name); }); }}
                                        getLeft=${function(g){ return html`<span style="font-size: 12px; opacity: 0.75;">🛡️</span>`; }}
                                        getTitle=${function(g){ return g && g.name ? g.name : ''; }}
                                        getSubtitle=${function(g){ return g && g.description ? g.description : ''; }}
                                        getMeta=${function(g){ return g && g.severity ? String(g.severity) : ''; }}
                                        showMeta=${false}
                                        onAdd=${function(g){ addGuardrailFromRegistry(g); }}
                                    />
                                </div>
                            ` : null}
                        <//>
                    ` : null}

                    <!-- ===== A2A Protocol Configuration ===== -->
                    <${SectionHeader} id="a2a" label="A2A Protocol">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px 24px;">
                            <!-- Capabilities -->
                            <div>
                                <div style=${labelStyle}>Capabilities</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 5px;">
                                    ${isEditing ? html`
                                        <button onClick=${function(){ toggleCapability('streaming'); }} style=${(capabilities.streaming ? badgeEnabled : badgeDisabled) + ' cursor: pointer;'}>${capabilities.streaming ? '✓' : '—'} Streaming</button>
                                        <button onClick=${function(){ toggleCapability('pushNotifications'); }} style=${(capabilities.pushNotifications ? badgeEnabled : badgeDisabled) + ' cursor: pointer;'}>${capabilities.pushNotifications ? '✓' : '—'} Push Notifications</button>
                                        <button onClick=${function(){ toggleCapability('stateTransitionHistory'); }} style=${(capabilities.stateTransitionHistory ? badgeEnabled : badgeDisabled) + ' cursor: pointer;'}>${capabilities.stateTransitionHistory ? '✓' : '—'} State History</button>
                                    ` : html`
                                        <span style=${capabilities.streaming ? badgeEnabled : badgeDisabled}>${capabilities.streaming ? '✓' : '—'} Streaming</span>
                                        <span style=${capabilities.pushNotifications ? badgeEnabled : badgeDisabled}>${capabilities.pushNotifications ? '✓' : '—'} Push Notifications</span>
                                        <span style=${capabilities.stateTransitionHistory ? badgeEnabled : badgeDisabled}>${capabilities.stateTransitionHistory ? '✓' : '—'} State History</span>
                                    `}
                                </div>
                            </div>

                            <!-- Authentication -->
                            <div>
                                <div style=${labelStyle}>Authentication</div>
                                ${isEditing ? html`
                                    <div style="margin-top: 5px; display: flex; flex-direction: column; gap: 10px;">
                                        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                            ${authTypes.length ? authTypes.map(function(t) {
                                                return html`
                                                    <span style="display: inline-flex; align-items: center; gap: 6px; font-size: 11px; padding: 3px 10px; border-radius: 999px; background: rgba(251,191,36,0.12); color: #fbbf24; border: 1px solid rgba(251,191,36,0.25); font-weight: 700;">
                                                        <span>${t}</span>
                                                        <button
                                                            onClick=${function(){ removeAuthType(t); }}
                                                            style="background: none; border: none; color: inherit; cursor: pointer; font-size: 13px; padding: 0 1px; opacity: 0.7; line-height: 1;"
                                                            onmouseenter=${function(e){ e.currentTarget.style.opacity='1'; }}
                                                            onmouseleave=${function(e){ e.currentTarget.style.opacity='0.7'; }}
                                                        >×</button>
                                                    </span>
                                                `;
                                            }) : html`<span style="font-size: 12px; color: var(--text-muted);">No auth configured.</span>`}
                                        </div>

                                        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                            ${knownAuthTypes.map(function(t) {
                                                var active = authTypes.indexOf(t) !== -1;
                                                var btnStyle = active
                                                    ? 'font-size: 11px; padding: 4px 10px; border-radius: 999px; background: rgba(34,114,180,0.18); color: var(--color-primary); border: 1px solid rgba(34,114,180,0.35); font-weight: 700; cursor: pointer;'
                                                    : 'font-size: 11px; padding: 4px 10px; border-radius: 999px; background: rgba(255,255,255,0.04); color: var(--text-muted); border: 1px solid rgba(255,255,255,0.10); font-weight: 600; cursor: pointer;';
                                                return html`<button onClick=${function(){ toggleAuthType(t); }} style=${btnStyle}>${active ? '✓ ' : '+ '}${t}</button>`;
                                            })}
                                        </div>

                                        <div style="font-size: 11px; color: var(--text-muted); line-height: 1.4;">
                                            Select one or more authentication types. “None” disables authentication.
                                        </div>
                                    </div>
                                ` : html`
                                    <div style="display: flex; align-items: center; gap: 6px; margin-top: 5px; flex-wrap: wrap;">
                                        ${(authTypes && authTypes.length ? authTypes : ['—']).map(function(s) {
                                            return html`<span style="font-size: 11px; padding: 3px 10px; border-radius: 999px; background: rgba(251,191,36,0.12); color: #fbbf24; border: 1px solid rgba(251,191,36,0.25); font-weight: 600;">${s}</span>`;
                                        })}
                                    </div>
                                `}
                            </div>

                            <!-- Input Modes -->
                            <div>
                                <div style=${labelStyle}>Input Modes</div>
                                ${isEditing
                                    ? html`<input type="text" value=${inputModes} onInput=${function(e){ setInputModes(e.target.value); }} style=${inputStyle + ' margin-top: 3px;'} />`
                                    : html`<div style=${monoStyle + ' margin-top: 3px;'}>${inputModes}</div>`
                                }
                            </div>

                            <!-- Output Modes -->
                            <div>
                                <div style=${labelStyle}>Output Modes</div>
                                ${isEditing
                                    ? html`<input type="text" value=${outputModes} onInput=${function(e){ setOutputModes(e.target.value); }} style=${inputStyle + ' margin-top: 3px;'} />`
                                    : html`<div style=${monoStyle + ' margin-top: 3px;'}>${outputModes}</div>`
                                }
                            </div>

                            <!-- A2A Discovery (full-width) -->
                            <div style="grid-column: 1 / -1;">
                                <div style="font-size: 12px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin: 0 0 8px 0;">A2A Discovery</div>

                                <!-- Read-only view: current state summary -->
                                ${!isEditing ? html`
                                    <div>
                                        <!-- Mode badge -->
                                        <div style=${labelStyle}>
                                            ${discoveryEntries.length === 0
                                                ? html`<span style="color: #10b981;">🌐 Public</span><span style="margin-left: 8px; text-transform: none; letter-spacing: 0; font-weight: 500; color: var(--text-muted);">Open to all agents and gateways</span>`
                                                : html`
                                                    <span style=${'color: ' + (discoveryMode === 'blacklist' ? '#fb7185' : '#10b981') + ';'}>
                                                        ${discoveryMode === 'blacklist' ? '🚫 Blacklist' : '🔒 Whitelist'}
                                                    </span>
                                                    <span style="margin-left: 8px; text-transform: none; letter-spacing: 0; font-weight: 500; color: var(--text-muted);">
                                                        ${discoveryEntries.length} ${discoveryEntries.length === 1 ? 'entry' : 'entries'}
                                                    </span>
                                                `
                                            }
                                        </div>

                                        <!-- Entries (read-only) -->
                                        ${discoveryEntries.length > 0 ? html`
                                            <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 8px; align-items: flex-start;">
                                                ${discoveryEntries.map(function(entry) {
                                                    var isAgent = entry.type !== 'gateway';
                                                    var info = isAgent ? resolveAgentRegistry(entry.value) : null;
                                                    return html`
                                                        <${MiniEntityCard}
                                                            kind=${isAgent ? 'agent' : 'gateway'}
                                                            name=${entry.value}
                                                            subtitle=${isAgent ? (info.summary || '') : ((entry.env === 'openshift') ? 'Partner gateway (OpenShift)' : 'Internal gateway (MLflow)')}
                                                            meta=${isAgent ? 'Agent' : 'Gateway'}
                                                            favicon=${!isAgent ? (entry.favicon || '') : ''}
                                                            nav=${isAgent ? (info.nav || 'agents') : ''}
                                                        />
                                                    `;
                                                })}
                                            </div>
                                        ` : null}
                                    </div>
                                ` : html`
                                    <!-- Edit panel -->
                                    <div ref=${discoveryPanelRef} style="border: 1px solid rgba(255,255,255,0.10); border-radius: 10px; background: rgba(255,255,255,0.02); overflow: visible;">

                                        <!-- Public / Whitelist / Blacklist tabs -->
                                        <div style="display: flex; border-bottom: 1px solid rgba(255,255,255,0.08);">
                                            <button
                                                onClick=${function(){ setDiscoveryMode('public'); setDiscoveryEntries([]); }}
                                                style=${'flex: 1; padding: 10px 16px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.15s ease; border: none; border-bottom: 2px solid ' + (discoveryMode === 'public' ? '#10b981' : 'transparent') + '; background: ' + (discoveryMode === 'public' ? 'rgba(16,185,129,0.08)' : 'transparent') + '; color: ' + (discoveryMode === 'public' ? '#10b981' : 'var(--text-muted)') + ';'}
                                            >🌐 Public</button>
                                            <button
                                                onClick=${function(){ setDiscoveryMode('whitelist'); }}
                                                style=${'flex: 1; padding: 10px 16px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.15s ease; border: none; border-left: 1px solid rgba(255,255,255,0.08); border-bottom: 2px solid ' + (discoveryMode === 'whitelist' ? '#10b981' : 'transparent') + '; background: ' + (discoveryMode === 'whitelist' ? 'rgba(16,185,129,0.08)' : 'transparent') + '; color: ' + (discoveryMode === 'whitelist' ? '#10b981' : 'var(--text-muted)') + ';'}
                                            >🔒 Whitelist</button>
                                            <button
                                                onClick=${function(){ setDiscoveryMode('blacklist'); }}
                                                style=${'flex: 1; padding: 10px 16px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.15s ease; border: none; border-left: 1px solid rgba(255,255,255,0.08); border-bottom: 2px solid ' + (discoveryMode === 'blacklist' ? '#f43e5e' : 'transparent') + '; background: ' + (discoveryMode === 'blacklist' ? 'rgba(244,63,94,0.08)' : 'transparent') + '; color: ' + (discoveryMode === 'blacklist' ? '#f43e5e' : 'var(--text-muted)') + ';'}
                                            >🚫 Blacklist</button>
                                        </div>

                                        <div style="padding: 14px;">
                                            ${discoveryMode === 'public' ? html`
                                                <div style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 10px; background: rgba(16,185,129,0.08); border: 1px solid rgba(16,185,129,0.20);">
                                                    <span style="font-size: 16px;">🌐</span>
                                                    <div style="flex: 1;">
                                                        <div style="font-size: 12px; font-weight: 700; color: #10b981;">Public</div>
                                                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">Open to all agents and gateways — discoverable by anyone</div>
                                                    </div>
                                                </div>
                                            ` : html`
                                            <!-- Current entries with remove buttons -->
                                            ${discoveryEntries.length > 0 ? html`
                                                <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; align-items: flex-start;">
                                                    ${discoveryEntries.map(function(entry, idx) {
                                                        var isAgent = entry.type !== 'gateway';
                                                        var info = isAgent ? resolveAgentRegistry(entry.value) : null;
                                                        return html`
                                                            <${MiniEntityCard}
                                                                kind=${isAgent ? 'agent' : 'gateway'}
                                                                name=${entry.value}
                                                                subtitle=${isAgent ? (info.summary || '') : ((entry.env === 'openshift') ? 'Partner gateway (OpenShift)' : 'Internal gateway (MLflow)')}
                                                                meta=${isAgent ? 'Agent' : 'Gateway'}
                                                                favicon=${!isAgent ? (entry.favicon || '') : ''}
                                                                nav=${isAgent ? (info.nav || 'agents') : ''}
                                                                removable=${true}
                                                                onRemove=${function(){ removeDiscoveryEntry(idx); }}
                                                            />
                                                        `;
                                                    })}
                                                </div>
                                            ` : null}

                                            <!-- Source tabs: Agents / Gateways -->
                                            <div style="display: flex; gap: 0; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.10); border-radius: 6px; overflow: hidden;">
                                                <button
                                                    onClick=${function(){ setSourceTab('agents'); setNewEntry(''); }}
                                                    style=${'flex: 1; padding: 6px 12px; font-size: 11px; font-weight: 600; cursor: pointer; border: none; transition: all 0.15s ease; background: ' + (sourceTab === 'agents' ? 'rgba(59,130,246,0.15)' : 'transparent') + '; color: ' + (sourceTab === 'agents' ? '#60a5fa' : 'var(--text-muted)') + ';'}
                                                >🤖 Agents</button>
                                                <button
                                                    onClick=${function(){ setSourceTab('gateways'); setNewEntry(''); }}
                                                    style=${'flex: 1; padding: 6px 12px; font-size: 11px; font-weight: 600; cursor: pointer; border: none; border-left: 1px solid rgba(255,255,255,0.10); transition: all 0.15s ease; background: ' + (sourceTab === 'gateways' ? 'rgba(59,130,246,0.15)' : 'transparent') + '; color: ' + (sourceTab === 'gateways' ? '#60a5fa' : 'var(--text-muted)') + ';'}
                                                >🌐 Gateways</button>
                                            </div>

                                            <!-- Search input -->
                                            <div style="position: relative;">
                                                <input
                                                    type="text"
                                                    placeholder=${'Search ' + (sourceTab === 'agents' ? 'agents' : 'gateways') + '...'}
                                                    value=${newEntryValue}
                                                    onInput=${function(e){ setNewEntry(e.target.value); setShowSuggestions(true); }}
                                                    onFocus=${function(){ setShowSuggestions(true); }}
                                                    onKeyDown=${function(e){
                                                        if (e.key === 'Escape') { setShowSuggestions(false); return; }
                                                        if (e.key === 'Enter' && newEntryValue.trim()) { addDiscoveryEntry(newEntryValue, sourceTab === 'gateways' ? 'gateway' : 'agent'); }
                                                    }}
                                                    style="width: 100%; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 6px; padding: 8px 12px; color: var(--text-primary); font-size: 12px; outline: none;"
                                                />

                                                <!-- Suggestions dropdown -->
                                                ${showSuggestions ? html`
                                                    ${sourceTab === 'agents' && filteredAgentSuggestions.length > 0 ? html`
                                                        <div style="position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: var(--bg-card, #1a1a2e); border: 1px solid rgba(255,255,255,0.12); border-radius: 8px; overflow: hidden; z-index: 80; box-shadow: 0 8px 24px rgba(0,0,0,0.4); max-height: 180px; overflow-y: auto;">
                                                            ${filteredAgentSuggestions.map(function(agent) {
                                                                return html`
                                                                    <div
                                                                        style="padding: 8px 12px; font-size: 12px; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.1s ease;"
                                                                        onmouseenter=${function(e){ e.currentTarget.style.background='rgba(255,255,255,0.06)'; }}
                                                                        onmouseleave=${function(e){ e.currentTarget.style.background=''; }}
                                                                        onmousedown=${function(e){ e.preventDefault(); addDiscoveryEntry(agent, 'agent'); }}
                                                                    >
                                                                        <span style="font-size: 11px; opacity: 0.6;">🤖</span>
                                                                        <span style="font-weight: 500; color: var(--text-primary);">${agent}</span>
                                                                        <span style="font-size: 10px; color: var(--text-muted); margin-left: auto;">Agent</span>
                                                                    </div>
                                                                `;
                                                            })}
                                                        </div>
                                                    ` : null}
                                                    ${sourceTab === 'gateways' && filteredGatewaySuggestions.length > 0 ? html`
                                                        <div style="position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: var(--bg-card, #1a1a2e); border: 1px solid rgba(255,255,255,0.12); border-radius: 8px; overflow: hidden; z-index: 80; box-shadow: 0 8px 24px rgba(0,0,0,0.4); max-height: 180px; overflow-y: auto;">
                                                            ${filteredGatewaySuggestions.map(function(gw) {
                                                                return html`
                                                                    <div
                                                                        style="padding: 8px 12px; font-size: 12px; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.1s ease;"
                                                                        onmouseenter=${function(e){ e.currentTarget.style.background='rgba(255,255,255,0.06)'; }}
                                                                        onmouseleave=${function(e){ e.currentTarget.style.background=''; }}
                                                                        onmousedown=${function(e){ e.preventDefault(); addDiscoveryEntry(gw.name, 'gateway', { id: gw.id, env: gw.env, favicon: gw.favicon }); }}
                                                                    >
                                                                        ${gw.favicon ? html`<img src=${gw.favicon} alt="" style="width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0; opacity: 0.9;" />` : html`<span style="font-size: 11px; opacity: 0.6;">🌐</span>`}
                                                                        <span style="font-weight: 500; color: var(--text-primary);">${gw.name}</span>
                                                                        <span style="font-size: 10px; color: var(--text-muted); font-family: var(--font-mono, monospace); margin-left: auto;">${gw.id}</span>
                                                                    </div>
                                                                `;
                                                            })}
                                                        </div>
                                                    ` : null}
                                                ` : null}
                                            </div>

                                            <!-- Helper text -->
                                            <div style="font-size: 11px; color: var(--text-muted); margin-top: 10px; line-height: 1.4;">
                                                ${discoveryMode === 'whitelist'
                                                    ? '🔒 Only the listed agents and gateways can discover and interact with this agent.'
                                                    : '🚫 All agents and gateways can discover this agent except those listed above.'
                                                }
                                            </div>
                                            `}
                                        </div>
                                    </div>
                                `}
                            </div>
                        </div>
                    <//>

                </div>
            `;
        }

        // --------------------------------------------------
        // Agent Detail View (Preact component)
        // --------------------------------------------------
        function AgentDetailView(props) {
            var statusMap = {
                healthy:  { dot: 'success', cls: 'status-success', label: 'Healthy' },
                warning:  { dot: 'warning', cls: 'status-warning', label: 'Warning' },
                error:    { dot: 'error',   cls: 'status-error',   label: 'Error' },
                none:     { dot: '',        cls: 'status-none',    label: 'Not Deployed' }
            };
            var st = statusMap[props.status] || statusMap.none;

            // --------------------------------------------------
            // Inline metadata (compact, centered)
            // --------------------------------------------------
            var repoFavDomain = props.sourceRepo ? (props.sourceRepo.provider === 'gitlab' ? 'gitlab.com' : 'github.com') : null;
            var registryFavDomain = props.containerImage ? (props.containerImage.registry === 'quay' ? 'quay.io' : props.containerImage.registry === 'ghcr' ? 'github.com' : 'docker.com') : null;
            var versionBadgeStyle = "font-size: 12px; color: var(--color-primary); background: rgba(34,114,180,0.12); border: 1px solid rgba(34,114,180,0.25); border-radius: 999px; padding: 2px 10px; font-family: var(--font-mono, monospace); font-weight: 600; line-height: 1.2;";
            var metaText = "font-size: 13px; color: var(--text-secondary); font-weight: 500;";
            var metaMono = "font-size: 12px; color: var(--text-secondary); font-family: var(--font-mono, monospace);";
            var icon16 = "width: 16px; height: 16px; border-radius: 3px; flex-shrink: 0;";
            var _dq = useState(''); var deploymentsQuery = _dq[0]; var setDeploymentsQuery = _dq[1];
            var _dp = useState(1); var deploymentsPage = _dp[0]; var setDeploymentsPage = _dp[1];
            var deploymentsPageSize = 4;
            var _eq = useState(''); var evalsQuery = _eq[0]; var setEvalsQuery = _eq[1];
            var _ep = useState(1); var evalsPage = _ep[0]; var setEvalsPage = _ep[1];
            var evalsPageSize = 4;

            // Deployments filtering + pagination (search by name or environment)
            var allDeployments = props.deploymentRows || [];
            var deploymentsQ = (deploymentsQuery || '').toLowerCase().trim();
            var filteredDeployments = !deploymentsQ ? allDeployments : allDeployments.filter(function(d) {
                var hay = [
                    d.name,
                    d.envName,
                    d.env
                ].filter(Boolean).join(' ').toLowerCase();
                return hay.indexOf(deploymentsQ) !== -1;
            });
            var deploymentsTotalPages = Math.max(1, Math.ceil(filteredDeployments.length / deploymentsPageSize));
            useEffect(function() {
                if (deploymentsPage > deploymentsTotalPages) setDeploymentsPage(1);
            }, [deploymentsPage, deploymentsTotalPages, deploymentsQ, allDeployments.length]);
            var deploymentsSafePage = Math.min(deploymentsPage, deploymentsTotalPages);
            var deploymentsStart = (deploymentsSafePage - 1) * deploymentsPageSize;
            var deploymentsPageRows = filteredDeployments.slice(deploymentsStart, deploymentsStart + deploymentsPageSize);
            var deploymentsFooterText = filteredDeployments.length
                ? ('Showing ' + (deploymentsStart + 1) + '-' + Math.min(deploymentsStart + deploymentsPageSize, filteredDeployments.length) + ' of ' + filteredDeployments.length)
                : 'No deployments';

            // Evaluations (evaluation runs)
            var allEvalRuns = props.evaluationRuns || [];
            var evalsQ = (evalsQuery || '').toLowerCase().trim();
            var filteredEvalRuns = !evalsQ ? allEvalRuns : allEvalRuns.filter(function(r) {
                var hay = [
                    r.runName,
                    r.suite,
                    r.dataset,
                    (r.models || []).map(function(m){ return m && m.name; }).filter(Boolean).join(' '),
                    (r.tools || []).map(function(t){ return t && t.name; }).filter(Boolean).join(' '),
                    (r.databases || []).map(function(d){ return d && d.name; }).filter(Boolean).join(' ')
                ].filter(Boolean).join(' ').toLowerCase();
                return hay.indexOf(evalsQ) !== -1;
            });
            var sortedEvalRuns = filteredEvalRuns.slice().sort(function(a, b) {
                var at = (a && a.ts) ? Number(a.ts) : 0;
                var bt = (b && b.ts) ? Number(b.ts) : 0;
                return bt - at;
            });
            var evalsTotalPages = Math.max(1, Math.ceil(sortedEvalRuns.length / evalsPageSize));
            useEffect(function() {
                if (evalsPage > evalsTotalPages) setEvalsPage(1);
            }, [evalsPage, evalsTotalPages, evalsQ, allEvalRuns.length]);
            var evalsSafePage = Math.min(evalsPage, evalsTotalPages);
            var evalsStart = (evalsSafePage - 1) * evalsPageSize;
            var evalsPageRows = sortedEvalRuns.slice(evalsStart, evalsStart + evalsPageSize);
            var evalsFooterText = sortedEvalRuns.length
                ? ('Showing ' + (evalsStart + 1) + '-' + Math.min(evalsStart + evalsPageSize, sortedEvalRuns.length) + ' of ' + sortedEvalRuns.length)
                : 'No evaluation runs';

            function evalScoreStatus(run) {
                // Rough pre-deploy signal derived from quality/safety/latency when present.
                // Output maps to MLflow-ish status colors.
                var q = (run && typeof run.quality === 'number') ? run.quality : null;
                var s = (run && typeof run.safety === 'number') ? run.safety : null;
                var l = (run && typeof run.latencyMs === 'number') ? run.latencyMs : null;

                var pass = true;
                var warn = false;

                if (q != null) {
                    if (q >= 0.80) { /* ok */ }
                    else if (q >= 0.65) { warn = true; }
                    else { pass = false; }
                }
                if (s != null) {
                    if (s >= 0.85) { /* ok */ }
                    else if (s >= 0.70) { warn = true; }
                    else { pass = false; }
                }
                if (l != null) {
                    if (l <= 800) { /* ok */ }
                    else if (l <= 1200) { warn = true; }
                    else { pass = false; }
                }

                if (!pass) return { cls: 'status-error', label: 'Failing' };
                if (warn) return { cls: 'status-warning', label: 'Warning' };
                return { cls: 'status-success', label: 'Passing' };
            }

            function getContainerRegistryUrl(registry, uri) {
                if (!registry || !uri) return null;
                var image = String(uri);
                // Strip common prefixes
                if (registry === 'ghcr' && image.indexOf('ghcr.io/') === 0) image = image.slice('ghcr.io/'.length);
                if (registry === 'dockerio' && image.indexOf('docker.io/') === 0) image = image.slice('docker.io/'.length);
                if (registry === 'quay' && image.indexOf('quay.io/') === 0) image = image.slice('quay.io/'.length);

                // Remove tag/digest from path for registry UI URLs
                var noTag = image.split(':')[0];
                var parts = noTag.split('/');

                if (registry === 'ghcr') {
                    // GHCR UI best-effort:
                    // https://github.com/orgs/<org>/packages/container/package/<name%2Fsubname>
                    if (parts.length >= 2) {
                        var org = parts[0];
                        var pkgName = parts.slice(1).join('%2F');
                        return 'https://github.com/orgs/' + org + '/packages/container/package/' + pkgName;
                    }
                }
                if (registry === 'dockerio') {
                    // Docker Hub: https://hub.docker.com/r/<namespace>/<repo>
                    return 'https://hub.docker.com/r/' + noTag;
                }
                if (registry === 'quay') {
                    // Quay: https://quay.io/repository/<namespace>/<repo>
                    return 'https://quay.io/repository/' + noTag;
                }
                return null;
            }

            var containerRegistryUrl = props.containerImage ? getContainerRegistryUrl(props.containerImage.registry, props.containerImage.uri) : null;

            return html`
                <div style="display: flex; flex-direction: column; gap: 24px;">
                    <!-- Page header -->
                    <div style="text-align: center;">
                        <h1 style="font-size: 32px; font-weight: 600; color: var(--text-primary); margin: 0; line-height: 1.15;">${props.name}</h1>
                    </div>


                    <!-- Agent Card (A2A-style) — comprehensive overview -->
                    <${A2AAgentCard}
                        name=${props.name}
                        version=${props.version}
                        status=${props.status}
                        sourceRepo=${props.sourceRepo}
                        containerImage=${props.containerImage}
                        containerRegistryUrl=${containerRegistryUrl}
                        framework=${props.framework}
                        owner=${props.owner}
                        created=${props.created}
                        serviceUrl=${props.serviceUrl}
                        cardDescription=${props.cardDescription}
                        provider=${props.provider}
                        skills=${props.skills}
                        tools=${props.tools}
                        guardrails=${props.guardrails}
                        model=${props.model}
                        capabilities=${props.capabilities}
                        authentication=${props.authentication}
                    />

                    <!-- Evaluations and Deployments moved to separate views -->
                </div>
            `;
        }

        // --------------------------------------------------
        // Reusable: Eval score status helper
        // --------------------------------------------------
        function evalScoreStatus(run) {
            var q = (run && typeof run.quality === 'number') ? run.quality : null;
            var s = (run && typeof run.safety === 'number') ? run.safety : null;
            var l = (run && typeof run.latencyMs === 'number') ? run.latencyMs : null;
            var pass = true; var warn = false;
            if (q != null) { if (q >= 0.80) {} else if (q >= 0.65) { warn = true; } else { pass = false; } }
            if (s != null) { if (s >= 0.85) {} else if (s >= 0.70) { warn = true; } else { pass = false; } }
            if (l != null) { if (l <= 800) {} else if (l <= 1200) { warn = true; } else { pass = false; } }
            if (!pass) return { cls: 'status-error', label: 'Failing' };
            if (warn) return { cls: 'status-warning', label: 'Warning' };
            return { cls: 'status-success', label: 'Passing' };
        }

        // --------------------------------------------------
        // Reusable: AgentDeploymentsView
        // --------------------------------------------------
        function AgentDeploymentsView(props) {
            var _dq = useState(''); var query = _dq[0]; var setQuery = _dq[1];
            var _dp = useState(1); var page = _dp[0]; var setPage = _dp[1];
            var pageSize = props.pageSize || 10;
            var allRows = props.rows || [];
            var q = (query || '').toLowerCase().trim();
            var filtered = !q ? allRows : allRows.filter(function(d) {
                return [d.name, d.envName, d.env].filter(Boolean).join(' ').toLowerCase().indexOf(q) !== -1;
            });
            var totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
            useEffect(function() { if (page > totalPages) setPage(1); }, [page, totalPages, q]);
            var safePage = Math.min(page, totalPages);
            var start = (safePage - 1) * pageSize;
            var pageRows = filtered.slice(start, start + pageSize);
            var footerText = filtered.length ? ('Showing ' + (start + 1) + '-' + Math.min(start + pageSize, filtered.length) + ' of ' + filtered.length) : 'No deployments';

            return html`
                <div style="display: flex; flex-direction: column; gap: 24px;">
                    ${props.name ? html`
                        <div style="text-align: center;">
                            <h1 style="font-size: 32px; font-weight: 600; color: var(--text-primary); margin: 0; line-height: 1.15;">${props.name}</h1>
                        </div>
                    ` : null}
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
                        <h2 style="font-size: 14px; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; margin: 0;">Deployments</h2>
                        <div class="search-box" style="width: 260px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                            <input type="text" placeholder="Search deployments..." value=${query} onInput=${function(e){ setQuery(e.target.value); setPage(1); }} />
                        </div>
                    </div>
                    <div style="background: var(--bg-page); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; background: var(--bg-page);">
                            <thead>
                                <tr style="border-bottom: 1px solid var(--border-subtle);">
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Name</th>
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Environment</th>
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Status</th>
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Replicas</th>
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Last Deployed</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${pageRows.length ? pageRows.map(function(d) {
                                    var platformDomains = { openshift: 'redhat.com', kubernetes: 'kubernetes.io', openai: 'openai.com', bedrock: 'aws.amazon.com' };
                                    var domain = platformDomains[d.platform] || 'example.com';
                                    var platformIcon = 'https://www.google.com/s2/favicons?sz=32&domain=' + domain;
                                    var statusCls = { running: 'status-success', stopped: 'status-error', degraded: 'status-warning' };
                                    return html`
                                        <tr class=${d.nav ? 'card-clickable' : ''} style=${"border-bottom: 1px solid var(--border-subtle); " + (d.nav ? "cursor: pointer;" : "")} onClick=${d.nav ? function(){ window.showView(d.nav); } : null} onmouseenter=${function(e){ e.currentTarget.style.background='var(--bg-hover)'; }} onmouseleave=${function(e){ e.currentTarget.style.background=''; }}>
                                            <td style="padding: 12px 16px; font-size: 13px; color: var(--text-primary); font-weight: 500;">${d.name}</td>
                                            <td style="padding: 12px 16px;"><div style="display: inline-flex; align-items: center; gap: 8px;"><img src=${platformIcon} alt=${d.platform || 'platform'} style="width: 16px; height: 16px; border-radius: 3px; flex-shrink: 0;" /><span style="font-size: 13px; color: var(--text-secondary); font-weight: 500;">${d.envName || d.env || ''}</span></div></td>
                                            <td style="padding: 12px 16px; font-size: 13px;"><span class=${statusCls[d.statusKey] || 'status-none'}>● ${d.statusLabel}</span></td>
                                            <td style="padding: 12px 16px; font-size: 13px; color: var(--text-primary);">${d.replicas}</td>
                                            <td style="padding: 12px 16px; font-size: 13px; color: var(--text-secondary);">${d.lastDeployed}</td>
                                        </tr>
                                    `;
                                }) : html`<tr><td colspan="5" style="padding: 28px 16px; font-size: 13px; color: var(--text-muted); text-align: center;">No results found</td></tr>`}
                            </tbody>
                        </table>
                        <div class="table-footer flex items-center justify-between" style="padding: 10px 16px;">
                            <p class="text-sm text-gray-500">${footerText}</p>
                            <div class="flex items-center gap-2">
                                <button class="pagination-btn" disabled=${safePage <= 1} onClick=${function(){ if (safePage > 1) setPage(safePage - 1); }}>Previous</button>
                                <button class="pagination-btn" disabled=${safePage >= totalPages} onClick=${function(){ if (safePage < totalPages) setPage(safePage + 1); }}>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --------------------------------------------------
        // Reusable: AgentEvaluationsView
        // --------------------------------------------------
        function AgentEvaluationsView(props) {
            var _eq = useState(''); var query = _eq[0]; var setQuery = _eq[1];
            var _ep = useState(1); var page = _ep[0]; var setPage = _ep[1];
            var pageSize = props.pageSize || 10;
            var allRuns = props.runs || [];
            var q = (query || '').toLowerCase().trim();
            var filtered = !q ? allRuns : allRuns.filter(function(r) {
                return [r.runName, r.suite, r.dataset, (r.models || []).map(function(m){ return m && m.name; }).join(' '), (r.tools || []).map(function(t){ return t && t.name; }).join(' '), (r.databases || []).map(function(d){ return d && d.name; }).join(' ')].filter(Boolean).join(' ').toLowerCase().indexOf(q) !== -1;
            });
            var sorted = filtered.slice().sort(function(a, b) { return ((b && b.ts) ? Number(b.ts) : 0) - ((a && a.ts) ? Number(a.ts) : 0); });
            var totalPages = Math.max(1, Math.ceil(sorted.length / pageSize));
            useEffect(function() { if (page > totalPages) setPage(1); }, [page, totalPages, q]);
            var safePage = Math.min(page, totalPages);
            var start = (safePage - 1) * pageSize;
            var pageRows = sorted.slice(start, start + pageSize);
            var footerText = sorted.length ? ('Showing ' + (start + 1) + '-' + Math.min(start + pageSize, sorted.length) + ' of ' + sorted.length) : 'No evaluation runs';

            return html`
                <div style="display: flex; flex-direction: column; gap: 24px;">
                    ${props.name ? html`
                        <div style="text-align: center;">
                            <h1 style="font-size: 32px; font-weight: 600; color: var(--text-primary); margin: 0; line-height: 1.15;">${props.name}</h1>
                        </div>
                    ` : null}
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
                        <h2 style="font-size: 14px; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; margin: 0;">Evaluations</h2>
                        <div class="search-box" style="width: 260px;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                            <input type="text" placeholder="Search evaluation runs..." value=${query} onInput=${function(e){ setQuery(e.target.value); setPage(1); }} />
                        </div>
                    </div>
                    <div style="background: var(--bg-page); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; background: var(--bg-page);">
                            <thead>
                                <tr style="border-bottom: 1px solid var(--border-subtle);">
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Run</th>
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Score</th>
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">Cost</th>
                                    <th style="padding: 10px 16px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page);">When</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${pageRows.length ? pageRows.map(function(r) {
                                    var score = evalScoreStatus(r);
                                    var costText = (typeof r.costUsd === 'number') ? (r.costUsd === 0 ? '$0.00' : ('$' + r.costUsd.toFixed(3))) : '—';
                                    var costCls = 'cost-success';
                                    if (typeof r.costUsd === 'number') { if (r.costUsd <= 0.25) costCls = 'cost-success'; else if (r.costUsd <= 0.50) costCls = 'cost-warning'; else costCls = 'cost-error'; } else { costCls = 'cost-none'; }
                                    return html`
                                        <tr style="border-bottom: 1px solid var(--border-subtle); cursor: pointer;" onmouseenter=${function(e){ e.currentTarget.style.background='var(--bg-hover)'; }} onmouseleave=${function(e){ e.currentTarget.style.background=''; }}>
                                            <td style="padding: 12px 16px; font-size: 13px; color: var(--text-primary); font-weight: 500;">
                                                <div style="display: flex; flex-direction: column; gap: 2px;">
                                                    <span>${r.runName}</span>
                                                    <div style="font-size: 12px; color: var(--text-secondary); display: flex; flex-wrap: wrap; gap: 10px;">
                                                        ${(r.models && r.models.length) ? html`<span><span style="color: var(--text-muted);">Model</span>${': '}${(r.models || []).map(function(m, idx){ return html`<${ModelBadge} model=${m} />${idx < r.models.length - 1 ? ' ' : ''}`; })}</span>` : null}
                                                        ${(r.tools && r.tools.length) ? html`<span><span style="color: var(--text-muted);">Tools</span>${': '}${(r.tools || []).map(function(t, idx){ return html`<${ToolBadge} tool=${t} />${idx < r.tools.length - 1 ? ' ' : ''}`; })}</span>` : null}
                                                        ${(r.databases && r.databases.length) ? html`<span><span style="color: var(--text-muted);">Databases</span>${': '}${(r.databases || []).map(function(d, idx){ var nav = (d && d.nav) ? d.nav : 'databases'; return html`<span><a href="#" style="color: var(--text-secondary); text-decoration: none;" onmouseenter=${function(e){ e.target.style.textDecoration='underline'; }} onmouseleave=${function(e){ e.target.style.textDecoration='none'; }} onClick=${function(e){ e.preventDefault(); window.showView(nav); }}>${d.name}</a>${idx < r.databases.length - 1 ? ', ' : ''}</span>`; })}</span>` : null}
                                                    </div>
                                                </div>
                                            </td>
                                            <td style="padding: 12px 16px; font-size: 13px;"><span class=${score.cls} style="font-family: var(--font-mono, monospace);">● ${score.label}</span></td>
                                            <td style="padding: 12px 16px; font-size: 13px;"><span class=${costCls} style="font-family: var(--font-mono, monospace);">${costText}</span></td>
                                            <td style="padding: 12px 16px; font-size: 13px; color: var(--text-secondary);">${r.when || '—'}</td>
                                        </tr>
                                    `;
                                }) : html`<tr><td colspan="4" style="padding: 28px 16px; font-size: 13px; color: var(--text-muted); text-align: center;">No results found</td></tr>`}
                            </tbody>
                        </table>
                        <div class="table-footer flex items-center justify-between" style="padding: 10px 16px;">
                            <p class="text-sm text-gray-500">${footerText}</p>
                            <div class="flex items-center gap-2">
                                <button class="pagination-btn" disabled=${safePage <= 1} onClick=${function(){ if (safePage > 1) setPage(safePage - 1); }}>Previous</button>
                                <button class="pagination-btn" disabled=${safePage >= totalPages} onClick=${function(){ if (safePage < totalPages) setPage(safePage + 1); }}>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --------------------------------------------------
        // Reusable: AgentAnalyticsView (Jobs Dashboard)
        // --------------------------------------------------
        function AgentAnalyticsView(props) {
            var _q = useState(''); var query = _q[0]; var setQuery = _q[1];
            var allJobs = props.jobs || [];
            var q = (query || '').toLowerCase().trim();
            var filtered = !q ? allJobs : allJobs.filter(function(j) {
                return [j.name, j.type, j.platform, j.schedule, j.description].filter(Boolean).join(' ').toLowerCase().indexOf(q) !== -1;
            });

            // Compute summary stats from jobs data
            var activeCount = allJobs.filter(function(j) { return j.enabled !== false; }).length;
            var totalRuns24h = allJobs.reduce(function(sum, j) { return sum + (j.runs24h || 0); }, 0);
            var passedRuns24h = allJobs.reduce(function(sum, j) { return sum + (j.passed24h || 0); }, 0);
            var failedRuns24h = allJobs.reduce(function(sum, j) { return sum + (j.failed24h || 0); }, 0);
            var successRate = totalRuns24h > 0 ? Math.round((passedRuns24h / totalRuns24h) * 100) : 0;

            var typeBadgeColors = {
                'LLM Judge': { bg: 'rgba(168,85,247,0.12)', border: 'rgba(168,85,247,0.30)', color: '#c084fc' },
                'Analysis':  { bg: 'rgba(59,130,246,0.12)', border: 'rgba(59,130,246,0.30)', color: '#60a5fa' },
                'Pipeline':  { bg: 'rgba(251,191,36,0.12)', border: 'rgba(251,191,36,0.30)', color: '#fbbf24' },
                'Monitor':   { bg: 'rgba(16,185,129,0.12)', border: 'rgba(16,185,129,0.30)', color: '#34d399' }
            };

            var platformFavicons = {
                'MLflow': 'https://www.google.com/s2/favicons?sz=32&domain=mlflow.org',
                'OpenShift': 'https://www.google.com/s2/favicons?sz=32&domain=openshift.com',
                'Airflow': 'https://www.google.com/s2/favicons?sz=32&domain=airflow.apache.org',
                'Datadog': 'https://www.google.com/s2/favicons?sz=32&domain=datadoghq.com'
            };

            var lastRunStatusStyles = {
                'passed':  { cls: 'status-success', dot: '#10b981' },
                'failed':  { cls: 'status-error',   dot: '#ef4444' },
                'running': { cls: 'status-warning',  dot: '#f59e0b' },
                'skipped': { cls: '',                dot: '#6b7280' }
            };

            var thStyle = 'padding: 10px 10px; text-align: left; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; background: var(--bg-page); white-space: nowrap;';
            var tdStyle = 'padding: 10px 10px; font-size: 13px;';

            return html`
                <div style="display: flex; flex-direction: column; gap: 24px;">
                    ${props.name ? html`
                        <div style="text-align: center;">
                            <h1 style="font-size: 32px; font-weight: 600; color: var(--text-primary); margin: 0; line-height: 1.15;">${props.name}</h1>
                        </div>
                    ` : null}

                    <!-- Section header -->
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
                        <h2 style="font-size: 14px; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; margin: 0;">Jobs</h2>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="search-box" style="width: 220px;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                                <input type="text" placeholder="Search jobs..." value=${query} onInput=${function(e){ setQuery(e.target.value); }} />
                            </div>
                            <button style="padding: 6px 14px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; background: rgba(34,114,180,0.15); border: 1px solid rgba(34,114,180,0.3); color: var(--color-primary); transition: all 0.15s ease; white-space: nowrap;" onmouseenter=${function(e){ e.target.style.background='rgba(34,114,180,0.25)'; }} onmouseleave=${function(e){ e.target.style.background='rgba(34,114,180,0.15)'; }}>+ New Job</button>
                        </div>
                    </div>

                    <!-- Summary stats -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        <div style="background: var(--bg-page); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 16px;">
                            <p style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 4px 0;">Active Jobs</p>
                            <p style="font-size: 22px; font-weight: 600; color: var(--text-primary); margin: 0;">${activeCount}</p>
                        </div>
                        <div style="background: var(--bg-page); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 16px;">
                            <p style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 4px 0;">Runs (24h)</p>
                            <p style="font-size: 22px; font-weight: 600; color: var(--text-primary); margin: 0;">${totalRuns24h}</p>
                        </div>
                        <div style="background: var(--bg-page); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 16px;">
                            <p style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 4px 0;">Success Rate</p>
                            <p style="font-size: 22px; font-weight: 600; margin: 0;" class=${successRate >= 80 ? 'status-success' : successRate >= 50 ? 'status-warning' : 'status-error'}>${successRate}%</p>
                        </div>
                        <div style="background: var(--bg-page); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 16px;">
                            <p style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 4px 0;">Failed (24h)</p>
                            <p style="font-size: 22px; font-weight: 600; margin: 0;" class=${failedRuns24h > 0 ? 'status-error' : ''}>${failedRuns24h}</p>
                        </div>
                    </div>

                    <!-- Jobs table -->
                    <div style="background: var(--bg-page); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; background: var(--bg-page); table-layout: fixed;">
                            <colgroup>
                                <col style="width: 36%;" />
                                <col style="width: 12%;" />
                                <col style="width: 12%;" />
                                <col style="width: 16%;" />
                                <col style="width: 14%;" />
                                <col style="width: 10%;" />
                            </colgroup>
                            <thead>
                                <tr style="border-bottom: 1px solid var(--border-subtle);">
                                    <th style=${thStyle}>Job</th>
                                    <th style=${thStyle}>Type</th>
                                    <th style=${thStyle}>Platform</th>
                                    <th style=${thStyle}>Schedule</th>
                                    <th style=${thStyle}>Last Run</th>
                                    <th style=${thStyle}>Next Run</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${filtered.length ? filtered.map(function(j) {
                                    var tc = typeBadgeColors[j.type] || { bg: 'rgba(255,255,255,0.06)', border: 'rgba(255,255,255,0.12)', color: 'var(--text-muted)' };
                                    var pfav = platformFavicons[j.platform] || '';
                                    var lr = lastRunStatusStyles[j.lastRunStatus] || lastRunStatusStyles['skipped'];

                                    return html`
                                        <tr style="border-bottom: 1px solid var(--border-subtle);" onmouseenter=${function(e){ e.currentTarget.style.background='var(--bg-hover)'; }} onmouseleave=${function(e){ e.currentTarget.style.background=''; }}>
                                            <td style=${tdStyle + ' overflow: hidden;'}>
                                                <div style="display: flex; flex-direction: column; gap: 1px; min-width: 0;">
                                                    <span style="color: var(--text-primary); font-weight: 500; font-family: var(--font-mono, monospace); font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${j.name}</span>
                                                    <span style="color: var(--text-muted); font-size: 11px; line-height: 1.3; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${j.description || ''}</span>
                                                </div>
                                            </td>
                                            <td style=${tdStyle}>
                                                <span style=${'font-size: 10px; padding: 2px 8px; border-radius: 999px; font-weight: 600; background: ' + tc.bg + '; border: 1px solid ' + tc.border + '; color: ' + tc.color + '; white-space: nowrap;'}>${j.type}</span>
                                            </td>
                                            <td style=${tdStyle}>
                                                <div style="display: inline-flex; align-items: center; gap: 5px;">
                                                    ${pfav ? html`<img src=${pfav} alt="" style="width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0;" />` : null}
                                                    <span style="font-size: 11px; color: var(--text-secondary); font-weight: 500; white-space: nowrap;">${j.platform}</span>
                                                </div>
                                            </td>
                                            <td style=${tdStyle + ' overflow: hidden;'}>
                                                <span style="font-size: 11px; color: var(--text-secondary); font-family: var(--font-mono, monospace); white-space: nowrap;">${j.schedule}</span>
                                            </td>
                                            <td style=${tdStyle + ' overflow: hidden;'}>
                                                <div style="display: flex; align-items: center; gap: 5px; min-width: 0;">
                                                    <span style=${'width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; background: ' + lr.dot + ';'}></span>
                                                    <span style="font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" class=${lr.cls}>${j.lastRunLabel || '—'}</span>
                                                </div>
                                            </td>
                                            <td style=${tdStyle + ' overflow: hidden;'}>
                                                <span style="font-size: 11px; color: var(--text-muted); white-space: nowrap;">${j.nextRun || '—'}</span>
                                            </td>
                                        </tr>
                                    `;
                                }) : html`<tr><td colspan="6" style="padding: 28px 16px; font-size: 13px; color: var(--text-muted); text-align: center;">No jobs found</td></tr>`}
                            </tbody>
                        </table>
                        <div class="table-footer flex items-center justify-between" style="padding: 10px 16px;">
                            <p class="text-sm text-gray-500">${filtered.length ? ('Showing ' + filtered.length + ' of ' + allJobs.length + ' jobs') : 'No jobs'}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function mountCards() {
            if (!__hasPreact) return;

            // Databases
            var dbRoot = document.getElementById('db-cards-root');
            if (dbRoot) {
                var databases = [
                    {
                        nav: 'db-detail-pks',
                        borderColor: 'var(--color-warning)',
                        iconBg: 'linear-gradient(135deg, #7C3AED 0%, #5B21B6 100%)',
                        name: 'product-knowledge-store',
                        engine: 'ChromaDB',
                        region: 'us-east-1',
                        statusDot: 'warning',
                        statusTextClass: 'status-warning',
                        statusText: 'Issues',
                        alert: {
                            text: 'malformed chunk error in 12 traces',
                            actionText: 'Inspect →',
                            actionNav: 'chunks'
                        },
                        stats: [
                            { value: '8,901', label: 'Chunks' },
                            { value: '1,536', label: 'Dimensions' },
                            { value: '47', label: 'Source Docs' }
                        ],
                        configRows: [
                            { label: 'Embedding Model', value: 'text-embedding-3-large', valueClass: 'text-gray-300 font-mono' },
                            { label: 'Chunk Strategy', value: '512 tokens / 64 overlap' },
                            { label: 'Last Ingestion', value: '2h ago · faq-pipeline-v3' },
                            { label: 'Avg Downstream Score', value: '0.62', valueClass: 'status-warning font-medium' }
                        ],
                        actions: []
                    },
                    {
                        nav: 'db-detail-sas',
                        iconBg: 'linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)',
                        name: 'support-articles-store',
                        engine: 'Milvus',
                        region: 'us-west-2',
                        statusDot: 'success',
                        statusTextClass: 'status-success',
                        statusText: 'Healthy',
                        alert: null,
                        stats: [
                            { value: '3,214', label: 'Chunks' },
                            { value: '768', label: 'Dimensions' },
                            { value: '128', label: 'Source Docs' }
                        ],
                        configRows: [
                            { label: 'Embedding Model', value: 'text-embedding-ada-002', valueClass: 'text-gray-300 font-mono' },
                            { label: 'Chunk Strategy', value: '256 tokens / 32 overlap' },
                            { label: 'Last Ingestion', value: '6h ago · support-ingest-v2' },
                            { label: 'Avg Downstream Score', value: '0.88', valueClass: 'status-success font-medium' }
                        ],
                        actions: []
                    }
                ];

                render(html`${databases.map(function(d){ return html`<${DatabaseCard} ...${d} />`; })}`, dbRoot);
            }

            // --------------------------------------------------
            // Agents DataTable (reusable component)
            // --------------------------------------------------
            var agentsTableRoot = document.getElementById('agents-table-root');
            if (agentsTableRoot) {
                var statusOrder = { 'Error': 0, 'Warning': 1, 'Healthy': 2, 'Not Deployed': 3 };
                var agentTableColumns = [
                    { key: 'name', label: 'Name', sortable: true, render: function(r) {
                        return html`<span class="text-white font-medium">${r.name}</span>`;
                    }},
                    { key: 'latestVersion', label: 'Latest Version', render: function(r) {
                        return html`<span class="font-mono text-gray-400">${r.latestVersion}</span>`;
                    }},
                    { key: 'status', label: 'Status', sortable: true, sortValue: function(r) {
                        return statusOrder[r.status] != null ? statusOrder[r.status] : 99;
                    }, render: function(r) {
                        return html`<span class=${r.statusClass}>● ${r.status}</span>`;
                    }}
                ];

                var agentTableRows = [
                    { name: 'Customer Support Bot', nav: 'agent-detail-cs', latestVersion: 'v2.1', status: 'Healthy', statusClass: 'status-success' },
                    { name: 'Email Drafting Assistant', nav: 'agent-detail-cs', latestVersion: 'v3.2', status: 'Error', statusClass: 'status-error' },
                    { name: 'Product Advisor Agent', nav: 'agent-detail-pa', latestVersion: 'v1.3', status: 'Warning', statusClass: 'status-warning' },
                    { name: 'Knowledge Base Q&A', nav: 'agent-detail-pa', latestVersion: 'v1.0', status: 'Not Deployed', statusClass: 'status-none' }
                ];

                render(html`<${DataTable}
                    title="All Agents"
                    searchPlaceholder="Search agents..."
                    columns=${agentTableColumns}
                    rows=${agentTableRows}
                    autoPageSize=${true}
                    maxRows=${16}
                    headerActions=${html`<button class="btn btn-primary" style="white-space: nowrap;">+ New Agent</button>`}
                />`, agentsTableRoot);
            }

            // --------------------------------------------------
            // Agent Detail: Customer Support Bot
            // --------------------------------------------------
            var csDetailRoot = document.getElementById('agent-detail-cs-root');
            if (csDetailRoot) {
                render(html`<${AgentDetailView}
                    name="Customer Support Bot"
                    slug="customer-support-bot"
                    description="Handles inbound customer queries across chat, email, and voice channels. Uses retrieval-augmented generation over the support knowledge base to provide accurate, contextual responses."
                    status="healthy"
                    version="v2.1"
                    deployments=${2}
                    framework="openai"
                    created="Jan 14, 2026"
                    owner="ML Platform Team"
                    serviceUrl="https://agents.acme-corp.com/.well-known/agent-card.json"
                    cardDescription="Customer support agent powered by retrieval-augmented generation. Provides live chat support and semantic search over the support knowledge base to resolve queries with grounded, citation-backed responses."
                    provider=${{ organization: 'Acme Corp', team: 'ML Platform Team', url: 'https://acme-corp.com' }}
                    sourceRepo=${{
                        provider: 'github',
                        url: 'https://github.com/acme-corp/customer-support-bot',
                        path: 'acme-corp/customer-support-bot',
                        branch: 'main'
                    }}
                    containerImage=${{
                        registry: 'ghcr',
                        registryLabel: 'GitHub Container Registry',
                        uri: 'ghcr.io/acme-corp/cs-bot:v2.1',
                        tag: 'v2.1',
                        digest: 'sha256:a1b2c3d4...e5f6'
                    }}
                    model=${{
                        name: 'gpt-4-turbo',
                        provider: 'OpenAI',
                        contextWindow: '128K',
                        prompt: { name: 'support-system-prompt', version: 'v4.2', nav: 'prompts' },
                        temperature: 0.3,
                        maxTokens: '4,096'
                    }}
                    capabilities=${{ streaming: true, pushNotifications: true, stateTransitionHistory: false }}
                    authentication=${{ schemes: ['Bearer'], protocols: ['OAuth 2.0', 'OIDC'] }}
                    discoveryMode="whitelist"
                    discoveryEntries=${[
                        { value: 'Email Drafting Assistant', type: 'agent' },
                        { value: 'API Gateway (us-east-1)', type: 'gateway' }
                    ]}
                    skills=${[
                        {
                            id: 'live-chat',
                            name: 'Live Chat Support',
                            icon: '💬',
                            description: 'Real-time conversational support via web chat and in-app messaging. Streams responses token-by-token for a natural feel.',
                            tags: ['chat', 'real-time', 'streaming'],
                            examples: ['I need help resetting my password', 'My order hasn\'t arrived yet']
                        },
                        {
                            id: 'kb-search',
                            name: 'Knowledge Base Search',
                            icon: '🔍',
                            description: 'RAG-powered semantic search over support docs, FAQs, and product manuals. Returns grounded answers with source citations.',
                            tags: ['RAG', 'search', 'retrieval'],
                            examples: ['What is the return policy for electronics?']
                        }
                    ]}
                    tools=${[
                        { name: 'Slack v3', nav: 'tools', label: 'MCP' },
                        { name: 'GitHub v2', nav: 'tools', label: 'MCP' },
                        { name: 'Notion v1', nav: 'tools', label: 'MCP' },
                        { name: 'support-articles-store', nav: 'db-detail-sas', label: 'RAG', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=milvus.io' },
                        { name: 'product-knowledge-store', nav: 'db-detail-pks', label: 'RAG', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=trychroma.com' }
                    ]}
                    guardrails=${[
                        { name: 'Content Filter v2', severity: 'critical', nav: 'guardrails', provider: 'OpenAI', env: 'openai-moderation-api', description: 'PII detection & redaction via OpenAI Moderation endpoint' },
                        { name: 'Jailbreak Shield', severity: 'critical', nav: 'guardrails', provider: 'NVIDIA NeMo', env: 'nemo-guardrails-k8s', description: 'Prompt injection & jailbreak detection via NeMo Guardrails' },
                        { name: 'Topic Boundary', severity: 'high', nav: 'guardrails', provider: 'Guardrails AI', env: 'guardrails-ai-cloud', description: 'Off-topic request rejection — support domain only' }
                    ]}
                    sharedWith=${[
                        { name: 'ML Platform Team' },
                        { name: 'Customer Experience' },
                        { name: 'Elena Rodriguez' }
                    ]}
                />`, csDetailRoot);
            }

            // --------------------------------------------------
            // Agent Detail: Product Advisor Agent (Preact)
            // --------------------------------------------------
            var paDetailRoot = document.getElementById('agent-detail-pa-root');
            if (paDetailRoot) {
                render(html`<${AgentDetailView}
                    name="Product Advisor Agent"
                    slug="product-advisor-agent"
                    description="Provides personalized product recommendations and comparisons. Uses retrieval over the product catalog and customer history to deliver accurate, context-aware advice."
                    status="warning"
                    version="v1.3"
                    deployments=${1}
                    framework="openshift"
                    created="Dec 8, 2025"
                    owner="Product Team"
                    serviceUrl="https://agents.acme-corp.com/.well-known/product-advisor-card.json"
                    cardDescription="Product recommendation agent powered by RAG over the product catalog. Handles product comparisons, feature lookups, and personalized suggestions based on customer purchase history and preferences."
                    provider=${{ organization: 'Acme Corp', team: 'Product Team', url: 'https://acme-corp.com' }}
                    sourceRepo=${{
                        provider: 'gitlab',
                        url: 'https://gitlab.com/acme-corp/product-advisor-agent',
                        path: 'acme-corp/product-advisor-agent',
                        branch: 'main'
                    }}
                    containerImage=${{
                        registry: 'quay',
                        registryLabel: 'Quay Container Registry',
                        uri: 'quay.io/acme-corp/pa-agent:v1.3',
                        tag: 'v1.3',
                        digest: 'sha256:f7e8d9c0...b1a2'
                    }}
                    model=${{
                        name: 'Llama 3.1 70B',
                        provider: 'vLLM (self-hosted)',
                        contextWindow: '128K',
                        prompt: { name: 'product-advisor-prompt', version: 'v2.1', nav: 'prompts' },
                        temperature: 0.4,
                        maxTokens: '4,096'
                    }}
                    capabilities=${{ streaming: true, pushNotifications: false, stateTransitionHistory: true }}
                    authentication=${{ schemes: ['Bearer'], protocols: ['OAuth 2.0'] }}
                    skills=${[
                        {
                            id: 'product-search',
                            name: 'Product Search',
                            icon: '🔎',
                            description: 'Semantic search over product catalog with filtering by category, price range, and availability.',
                            tags: ['search', 'catalog', 'RAG'],
                            examples: ['Find me a laptop under $1000 for video editing']
                        },
                        {
                            id: 'product-compare',
                            name: 'Product Comparison',
                            icon: '⚖️',
                            description: 'Side-by-side comparison of products across specs, pricing, reviews, and availability.',
                            tags: ['comparison', 'analysis'],
                            examples: ['Compare the Pro and Ultra models']
                        },
                        {
                            id: 'recommendation',
                            name: 'Personalized Recommendations',
                            icon: '🎯',
                            description: 'Context-aware product suggestions based on customer history, preferences, and browsing patterns.',
                            tags: ['recommendation', 'personalization'],
                            examples: ['What accessories go well with my recent purchase?']
                        }
                    ]}
                    tools=${[
                        { name: 'Product Catalog API', nav: 'tools', label: 'API' },
                        { name: 'Customer Profile Service', nav: 'tools', label: 'API' },
                        { name: 'Notion v1', nav: 'tools', label: 'MCP' },
                        { name: 'product-knowledge-store', nav: 'db-detail-pks', label: 'RAG', favicon: 'https://www.google.com/s2/favicons?sz=64&domain=trychroma.com' }
                    ]}
                    guardrails=${[
                        { name: 'Content Filter v2', severity: 'critical', nav: 'guardrails', provider: 'OpenAI', env: 'openai-moderation-api', description: 'PII detection & redaction via OpenAI Moderation endpoint' },
                        { name: 'Product Safety v1', severity: 'high', nav: 'guardrails', provider: 'Guardrails AI', env: 'guardrails-ai-cloud', description: 'Validates recommendations comply with safety regulations' }
                    ]}
                    evaluationRuns=${[]}
                    sharedWith=${[
                        { name: 'Product Team' },
                        { name: 'Growth Engineering' }
                    ]}
                    deploymentRows=${[
                        { name: 'pa-agent-prod', nav: 'deployment-pa-prod', platform: 'openshift', envName: 'openshift-us-east-1', statusKey: 'degraded', statusLabel: 'Degraded', replicas: 2, lastDeployed: '2h ago' },
                        { name: 'pa-agent-dev', platform: 'openshift', envName: 'openshift-us-east-1 (dev)', statusKey: 'running', statusLabel: 'Running', replicas: 1, lastDeployed: '3d ago' }
                    ]}
                />`, paDetailRoot);
            }

            // --------------------------------------------------
            // Agent Deployments View
            // --------------------------------------------------
            var agentDeploymentsRoot = document.getElementById('agent-deployments-root');
            if (agentDeploymentsRoot) {
                render(html`<${AgentDeploymentsView} name="Customer Support Bot" rows=${[
                    { name: 'cs-bot-prod', nav: 'deployment-cs-prod', platform: 'openshift', envName: 'openshift-us-east-1', statusKey: 'running', statusLabel: 'Running', replicas: 3, lastDeployed: '4h ago' },
                    { name: 'cs-bot-openai', nav: 'deployment-cs-openai', platform: 'openai', envName: 'OpenAI', statusKey: 'degraded', statusLabel: 'Degraded', replicas: 0, lastDeployed: '—' }
                ]} />`, agentDeploymentsRoot);
            }

            // --------------------------------------------------
            // Agent Evaluations View
            // --------------------------------------------------
            var agentEvalsRoot = document.getElementById('agent-evaluations-root');
            if (agentEvalsRoot) {
                render(html`<${AgentEvaluationsView} name="Customer Support Bot" runs=${[
                    { ts: 1738833120000, runName: 'predeploy_regression_golden_answers_v5__llama3_70b_vllm__2026-02-06', suite: 'Regression', dataset: 'golden-answers-v5', quality: 0.83, safety: 0.91, latencyMs: 420, costUsd: 0, when: '2h ago', models: [{ name: 'vLLM: Llama 3.1 70B', nav: 'models' }], tools: [{ name: 'Slack v3', nav: 'tools' }, { name: 'GitHub v2', nav: 'tools' }, { name: 'Notion v1', nav: 'tools' }], databases: [{ name: 'support-articles-store', nav: 'db-detail-sas' }, { name: 'product-knowledge-store', nav: 'db-detail-pks' }] },
                    { ts: 1738747800000, runName: 'predeploy_tool_call_correctness__zendesk_ticketing__gpt-4o-mini__2026-02-05', suite: 'ToolCallCorrectness', dataset: 'zendesk-flows-v2', quality: 0.78, safety: 0.89, latencyMs: 310, costUsd: 0.18, when: '1d ago', models: [{ name: 'openai: gpt-4o-mini', nav: 'models' }], tools: [{ name: 'Slack v3', nav: 'tools' }], databases: [{ name: 'support-articles-store', nav: 'db-detail-sas' }] },
                    { ts: 1738678260000, runName: 'predeploy_rag_grounding__kb_citations__mistral_small_24b_self_hosted__2026-02-04', suite: 'RAGGrounding', dataset: 'support-kb-qa-v1', quality: 0.69, safety: 0.84, latencyMs: 540, costUsd: 0, when: '2d ago', models: [{ name: 'Ollama: Mistral Small 24B', nav: 'models' }], tools: [{ name: 'Notion v1', nav: 'tools' }], databases: [{ name: 'support-articles-store', nav: 'db-detail-sas' }] },
                    { ts: 1738584300000, runName: 'predeploy_safety_jailbreak__safety_probes_v2__bedrock_claude_3_5__2026-02-03', suite: 'Jailbreak', dataset: 'safety-probes-v2', quality: 0.64, safety: 0.66, latencyMs: 980, costUsd: 0.52, when: '3d ago', models: [{ name: 'vercel: Claude 3.5 Sonnet', nav: 'models' }], tools: [{ name: 'Notion v1', nav: 'tools' }], databases: [{ name: 'support-articles-store', nav: 'db-detail-sas' }] },
                    { ts: 1738416240000, runName: 'predeploy_policy_edge_cases__refund_policy_v1__gpt-4.1__2026-02-01', suite: 'PolicyEdgeCases', dataset: 'refund-policy-v1', quality: 0.67, safety: 0.81, latencyMs: 660, costUsd: 0.61, when: '5d ago', models: [{ name: 'openai: gpt-4.1', nav: 'models' }], tools: [{ name: 'refund.policy_lookup', nav: 'tools' }], databases: [{ name: 'product-knowledge-store', nav: 'db-detail-pks' }] }
                ]} />`, agentEvalsRoot);
            }

            // --------------------------------------------------
            // Agent Analytics View
            // --------------------------------------------------
            var agentAnalyticsRoot = document.getElementById('agent-analytics-root');
            if (agentAnalyticsRoot) {
                render(html`<${AgentAnalyticsView}
                    name="Customer Support Bot"
                    jobs=${[
                        {
                            name: 'faithfulness-audit',
                            description: 'LLM-as-a-Judge scoring every response for hallucination & citation fidelity',
                            type: 'LLM Judge',
                            platform: 'MLflow',
                            schedule: 'Every 6h',
                            lastRunStatus: 'passed',
                            lastRunLabel: 'Passed · 2h ago',
                            nextRun: 'in 4h',
                            runs24h: 4,
                            passed24h: 4,
                            failed24h: 0,
                            enabled: true
                        },
                        {
                            name: 'cost-quality-pareto',
                            description: 'Plots cost vs quality across model variants to surface Pareto-optimal configs',
                            type: 'Analysis',
                            platform: 'OpenShift',
                            schedule: 'Daily 02:00 UTC',
                            lastRunStatus: 'passed',
                            lastRunLabel: 'Passed · 14h ago',
                            nextRun: 'in 10h',
                            runs24h: 1,
                            passed24h: 1,
                            failed24h: 0,
                            enabled: true
                        },
                        {
                            name: 'chunk-staleness-scanner',
                            description: 'Detects outdated or drifted chunks in RAG vector stores via source-hash comparison',
                            type: 'Pipeline',
                            platform: 'OpenShift',
                            schedule: 'Daily 04:00 UTC',
                            lastRunStatus: 'failed',
                            lastRunLabel: 'Failed · 10h ago',
                            nextRun: 'in 18h',
                            runs24h: 1,
                            passed24h: 0,
                            failed24h: 1,
                            enabled: true
                        },
                        {
                            name: 'trace-clustering',
                            description: 'Clusters user-agent traces to discover conversation archetypes & failure patterns',
                            type: 'Pipeline',
                            platform: 'OpenShift',
                            schedule: 'Weekly Mon 06:00',
                            lastRunStatus: 'passed',
                            lastRunLabel: 'Passed · 3d ago',
                            nextRun: 'Mon 06:00',
                            runs24h: 0,
                            passed24h: 0,
                            failed24h: 0,
                            enabled: true
                        },
                        {
                            name: 'satisfaction-regression',
                            description: 'Monitors CSAT/thumbs-up trends and alerts on statistically significant regressions',
                            type: 'Monitor',
                            platform: 'MLflow',
                            schedule: 'Every 12h',
                            lastRunStatus: 'passed',
                            lastRunLabel: 'Passed · 6h ago',
                            nextRun: 'in 6h',
                            runs24h: 2,
                            passed24h: 2,
                            failed24h: 0,
                            enabled: true
                        }
                    ]}
                />`, agentAnalyticsRoot);
            }
        }

        // --------------------------------------------------
        // Service graphs (Reusable)
        // --------------------------------------------------
        function SvcGraph(props) {
            var ref = useRef(null);
            var viewportRef = useRef(null);
            var _scale = useState(1);
            var scale = _scale[0];
            var setScale = _scale[1];
            var _pan = useState({ x: 0, y: 0 });
            var pan = _pan[0];
            var setPan = _pan[1];
            var dragRef = useRef({ active: false, startX: 0, startY: 0, baseX: 0, baseY: 0, pid: null });

            function clampPan(nextX, nextY, nextScale) {
                var viewport = viewportRef.current;
                var graph = ref.current;
                if (!viewport || !graph) return { x: nextX, y: nextY };
                var vw = viewport.clientWidth || 0;
                var vh = viewport.clientHeight || 0;
                var cw = (graph.scrollWidth || graph.clientWidth || 0) * nextScale;
                var ch = (graph.scrollHeight || graph.clientHeight || 0) * nextScale;

                var x = nextX, y = nextY;
                if (cw <= vw) x = Math.round((vw - cw) / 2);
                else x = Math.min(0, Math.max(vw - cw, x));
                if (ch <= vh) y = Math.round((vh - ch) / 2);
                else y = Math.min(0, Math.max(vh - ch, y));
                return { x: x, y: y };
            }

            function setZoom(nextScale) {
                var s = Math.max(0.6, Math.min(2.2, nextScale));
                setScale(s);
                setPan(function(p) {
                    var pp = p || { x: 0, y: 0 };
                    return clampPan(pp.x, pp.y, s);
                });
            }

            function resetView() {
                setScale(1);
                setPan({ x: 0, y: 0 });
            }

            function onPointerDown(e) {
                // Left click / primary pointer only
                if (e.button != null && e.button !== 0) return;
                // Don't start drag when clicking nodes (preserve nav clicks)
                if (e.target && e.target.closest && e.target.closest('.svc-node')) return;
                if (!viewportRef.current) return;
                try { viewportRef.current.setPointerCapture(e.pointerId); } catch (_) {}
                dragRef.current = {
                    active: true,
                    startX: e.clientX,
                    startY: e.clientY,
                    baseX: pan.x,
                    baseY: pan.y,
                    pid: e.pointerId
                };
                viewportRef.current.classList.add('dragging');
                e.preventDefault();
            }

            function onPointerMove(e) {
                var st = dragRef.current;
                if (!st || !st.active) return;
                var dx = e.clientX - st.startX;
                var dy = e.clientY - st.startY;
                var next = clampPan(st.baseX + dx, st.baseY + dy, scale);
                setPan(next);
            }

            function endDrag() {
                var viewport = viewportRef.current;
                if (viewport) viewport.classList.remove('dragging');
                dragRef.current.active = false;
                dragRef.current.pid = null;
            }

            function onPointerUp(e) { endDrag(); }
            function onPointerCancel(e) { endDrag(); }

            useEffect(function() {
                function redraw() {
                    if (!ref.current) return;
                    // Only draw if visible (hidden views return 0-sized rects)
                    if (ref.current.offsetWidth === 0 || ref.current.offsetHeight === 0) return;
                    drawEdges(ref.current);
                }
                window.addEventListener('svc-graph-redraw', redraw);
                window.addEventListener('resize', redraw);
                setTimeout(redraw, 0);
                return function() {
                    window.removeEventListener('svc-graph-redraw', redraw);
                    window.removeEventListener('resize', redraw);
                };
            }, []);

            // Persist pan/zoom state on element for drawEdges() to invert transforms.
            useEffect(function() {
                if (!ref.current) return;
                ref.current.dataset.panX = String(pan.x || 0);
                ref.current.dataset.panY = String(pan.y || 0);
                ref.current.dataset.panScale = String(scale || 1);
                setTimeout(function() { window.dispatchEvent(new Event('svc-graph-redraw')); }, 0);
            }, [pan.x, pan.y, scale]);

            return html`
                <div
                    class="svc-graph-scroll"
                    ref=${viewportRef}
                    onPointerDown=${onPointerDown}
                    onPointerMove=${onPointerMove}
                    onPointerUp=${onPointerUp}
                    onPointerCancel=${onPointerCancel}
                >
                    <div class="svc-graph-controls">
                        <button title="Zoom out" onClick=${function(e){ e.preventDefault(); e.stopPropagation(); setZoom(scale / 1.15); }}>−</button>
                        <span class="svc-graph-zoom">${Math.round(scale * 100)}%</span>
                        <button title="Zoom in" onClick=${function(e){ e.preventDefault(); e.stopPropagation(); setZoom(scale * 1.15); }}>+</button>
                        <button title="Reset" onClick=${function(e){ e.preventDefault(); e.stopPropagation(); resetView(); }}>⟲</button>
                    </div>
                    <div
                        class="svc-graph"
                        ref=${ref}
                        style=${"transform: translate(" + (pan.x || 0) + "px," + (pan.y || 0) + "px) scale(" + (scale || 1) + "); transform-origin: 0 0;"}
                    >
                        <svg class="svc-edges"></svg>
                        ${props.children}
                    </div>
                </div>
            `;
        }

        function SvcRow(props) {
            return html`<div class="svc-row" style=${props.style || ''}>${props.children}</div>`;
        }

        // Auto-resolve favicon from well-known platform names
        var _platformFavicons = {
            'openai': 'https://www.google.com/s2/favicons?sz=64&domain=openai.com',
            'openshift': 'https://www.google.com/s2/favicons?sz=64&domain=openshift.com',
            'openshift cluster': 'https://www.google.com/s2/favicons?sz=64&domain=openshift.com',
            'red hat openshift ai': 'https://www.google.com/s2/favicons?sz=64&domain=openshift.com',
            'pinecone': 'https://www.google.com/s2/favicons?sz=64&domain=pinecone.io',
            'aws': 'https://www.google.com/s2/favicons?sz=64&domain=aws.amazon.com',
            'kubernetes': 'https://www.google.com/s2/favicons?sz=64&domain=kubernetes.io',
            'github': 'https://www.google.com/s2/favicons?sz=64&domain=github.com',
            'vercel': 'https://www.google.com/s2/favicons?sz=64&domain=vercel.com',
            'milvus': 'https://www.google.com/s2/favicons?sz=64&domain=milvus.io',
            'chromadb': 'https://www.google.com/s2/favicons?sz=64&domain=trychroma.com'
        };

        // Reusable inline platform badge: favicon + name
        function PlatformBadge(props) {
            var name = props.name || '';
            var fav = props.favicon || _platformFavicons[name.toLowerCase()] || null;
            var size = props.size || 14;
            return html`
                <span style=${"display: inline-flex; align-items: center; gap: 6px;" + (props.style || '')}>
                    ${fav ? html`<img src=${fav} alt="" style=${"width:" + size + "px; height:" + size + "px; border-radius: 3px; flex-shrink: 0;"} />` : null}
                    <span>${name}</span>
                </span>
            `;
        }

        // Reusable tool badge: favicon + "MCP" + tool name
        var _toolFavicons = {
            'slack': 'https://www.google.com/s2/favicons?sz=64&domain=slack.com',
            'github': 'https://www.google.com/s2/favicons?sz=64&domain=github.com',
            'notion': 'https://www.google.com/s2/favicons?sz=64&domain=notion.so',
            'zendesk': 'https://www.google.com/s2/favicons?sz=64&domain=zendesk.com',
            'milvus': 'https://www.google.com/s2/favicons?sz=64&domain=milvus.io',
            'chroma': 'https://www.google.com/s2/favicons?sz=64&domain=trychroma.com',
            'pinecone': 'https://www.google.com/s2/favicons?sz=64&domain=pinecone.io',
            'weaviate': 'https://www.google.com/s2/favicons?sz=64&domain=weaviate.io',
            'stripe': 'https://www.google.com/s2/favicons?sz=64&domain=stripe.com',
            'pagerduty': 'https://www.google.com/s2/favicons?sz=64&domain=pagerduty.com'
        };

        function ToolBadge(props) {
            var t = (props && props.tool) ? props.tool : null;
            var name = t && t.name ? String(t.name) : '';
            var nav = (t && t.nav) ? t.nav : 'tools';
            var label = (t && t.label) ? String(t.label) : 'MCP';

            // Infer favicon by tool name (simple heuristic)
            var lower = name.toLowerCase();
            var key = lower.indexOf('slack') !== -1 ? 'slack'
                : lower.indexOf('github') !== -1 ? 'github'
                : lower.indexOf('notion') !== -1 ? 'notion'
                : lower.indexOf('zendesk') !== -1 ? 'zendesk'
                : lower.indexOf('milvus') !== -1 ? 'milvus'
                : lower.indexOf('chroma') !== -1 ? 'chroma'
                : lower.indexOf('pinecone') !== -1 ? 'pinecone'
                : lower.indexOf('weaviate') !== -1 ? 'weaviate'
                : lower.indexOf('stripe') !== -1 ? 'stripe'
                : lower.indexOf('pagerduty') !== -1 ? 'pagerduty'
                : '';
            var fav = (t && t.favicon) ? t.favicon : (key ? _toolFavicons[key] : null);

            return html`
                <a
                    href="#"
                    class="tool-badge"
                    title=${name}
                    onClick=${function(e){ e.preventDefault(); window.showView(nav); }}
                >
                    ${fav ? html`<img class="tool-badge__icon" src=${fav} alt="" />` : null}
                    <${PillBadge} text=${label} kind="tool" />
                    <span>${name}</span>
                </a>
            `;
        }

        // --------------------------------------------------
        // GuardrailBadge — clickable badge with favicon, severity, hosting env
        // props: { guardrail: { name, severity, nav, provider, env, description } }
        // --------------------------------------------------
        var _guardrailFavicons = {
            'openai':     'https://www.google.com/s2/favicons?sz=64&domain=openai.com',
            'nvidia':     'https://www.google.com/s2/favicons?sz=64&domain=nvidia.com',
            'llamaguard': 'https://www.google.com/s2/favicons?sz=64&domain=meta.com',
            'meta':       'https://www.google.com/s2/favicons?sz=64&domain=meta.com',
            'aws':        'https://www.google.com/s2/favicons?sz=64&domain=aws.amazon.com',
            'bedrock':    'https://www.google.com/s2/favicons?sz=64&domain=aws.amazon.com',
            'guardrails ai': 'https://www.google.com/s2/favicons?sz=64&domain=guardrailsai.com',
            'azure':      'https://www.google.com/s2/favicons?sz=64&domain=azure.microsoft.com',
            'google':     'https://www.google.com/s2/favicons?sz=64&domain=cloud.google.com',
            'anthropic':  'https://www.google.com/s2/favicons?sz=64&domain=anthropic.com',
            'acme':       'https://www.google.com/s2/favicons?sz=64&domain=acme.com'
        };

        function GuardrailBadge(props) {
            var g = (props && props.guardrail) ? props.guardrail : null;
            var name = g && g.name ? String(g.name) : '';
            var nav = (g && g.nav) ? g.nav : 'guardrails';
            var severity = (g && g.severity) ? String(g.severity).toLowerCase() : '';
            var showSeverity = !!(props && props.showSeverity === true);
            var provider = (g && g.provider) ? String(g.provider) : '';
            var env = (g && g.env) ? String(g.env) : '';
            var description = (g && g.description) ? String(g.description) : '';
            var severityCls = severity === 'critical' ? 'guardrail-badge__label--critical'
                : severity === 'high' ? 'guardrail-badge__label--high'
                : severity === 'medium' ? 'guardrail-badge__label--medium'
                : 'guardrail-badge__label--low';

            // Resolve favicon from provider
            var lower = provider.toLowerCase();
            var favKey = Object.keys(_guardrailFavicons).find(function(k) { return lower.indexOf(k) !== -1; });
            var fav = favKey ? _guardrailFavicons[favKey] : null;

            return html`
                <a
                    href="#"
                    class="guardrail-badge"
                    style="flex-direction: column; align-items: stretch; gap: 4px; padding: 8px 12px; border-radius: 10px;"
                    title=${name + (severity ? ' (' + severity + ')' : '') + (description ? ' — ' + description : '')}
                    onClick=${function(e){ e.preventDefault(); window.showView(nav); }}
                >
                    <div style="display: flex; align-items: center; gap: 8px;">
                        ${fav ? html`<img src=${fav} alt="" style="width: 16px; height: 16px; border-radius: 3px; flex-shrink: 0;" />` : html`<span style="font-size: 14px; flex-shrink: 0;">🛡️</span>`}
                        <span style="font-weight: 600; color: var(--text-primary); font-size: 12px; flex: 1;">${name}</span>
                        ${(showSeverity && severity) ? html`<span class=${'guardrail-badge__label ' + severityCls}>${severity}</span>` : null}
                    </div>
                    ${(provider || env) ? html`
                        <div style="display: flex; align-items: center; gap: 6px; padding-left: 24px;">
                            ${provider ? html`<span style="font-size: 10px; color: var(--text-muted); font-weight: 500;">${provider}</span>` : null}
                            ${provider && env ? html`<span style="font-size: 10px; color: var(--text-muted); opacity: 0.5;">·</span>` : null}
                            ${env ? html`<span style="font-size: 10px; color: var(--text-muted); font-family: var(--font-mono, monospace);">${env}</span>` : null}
                        </div>
                    ` : null}
                    ${description ? html`
                        <div style="font-size: 10px; color: var(--text-muted); line-height: 1.4; padding-left: 24px;">${description}</div>
                    ` : null}
                </a>
            `;
        }

        // --------------------------------------------------
        // AlertHeader — reusable alert page header
        // props: { backNav, title, statusLabel, statusTone, subtitle, actions: [{ label, variant }] }
        // --------------------------------------------------
        function AlertHeader(props) {
            var tone = props.statusTone || 'error';
            var actions = props.actions || [{ label: 'Acknowledge', variant: 'ghost' }, { label: 'Mute', variant: 'secondary' }];
            return html`
                <div class="flex items-center gap-4 mb-6">
                    ${props.backNav ? html`<button class="btn-icon" data-nav=${props.backNav}>←</button>` : null}
                    <div class="flex-1">
                        <div class="flex items-center gap-3">
                            <h1 class="text-xl font-semibold text-white">${props.title || ''}</h1>
                            ${props.statusLabel ? html`<span class=${"score-badge " + tone}>${props.statusLabel}</span>` : null}
                        </div>
                        ${props.subtitle ? html`<p class="text-sm text-gray-500 mt-1">${props.subtitle}</p>` : null}
                    </div>
                    ${actions.length ? html`
                        <div class="flex items-center gap-2">
                            ${actions.map(function(a) {
                                return html`<button class=${"btn btn-" + (a.variant || 'ghost')}>${a.label}</button>`;
                            })}
                        </div>
                    ` : null}
                </div>
            `;
        }

        // --------------------------------------------------
        // AlertBanner — reusable alert summary banner
        // props: { icon, tone, title, description, callouts: [{ tone, icon, text }] }
        // --------------------------------------------------
        function AlertBanner(props) {
            var tone = props.tone || 'warning';
            var borderColor = tone === 'error' ? 'var(--color-error)' : (tone === 'success' ? 'var(--color-success)' : 'var(--color-warning)');
            var callouts = props.callouts || [];
            return html`
                <div class="card mb-6" style=${"border-left: 3px solid " + borderColor + "; padding: 14px 18px;"}>
                    <div class="flex items-start gap-3">
                        ${props.icon ? html`<span style="font-size: 16px; line-height: 1; margin-top: 1px;">${props.icon}</span>` : null}
                        <div class="flex-1">
                            <h3 class="text-white font-semibold" style="font-size: 14px; margin-bottom: 4px;">${props.title || ''}</h3>
                            ${props.description ? html`<p class="text-sm text-gray-400" style="margin-bottom: 12px;">${props.description}</p>` : null}
                            ${callouts.length ? html`
                                <div class="flex items-center gap-3" style="flex-wrap: wrap;">
                                    ${callouts.map(function(c) {
                                        return html`<${InlineCallout} tone=${c.tone || tone} icon=${c.icon || ''} text=${c.text || ''} />`;
                                    })}
                                </div>
                            ` : null}
                        </div>
                    </div>
                </div>
            `;
        }

        // --------------------------------------------------
        // TimeSeriesChart — reusable SVG line chart
        // props: { title, series: [{ data: number[], color, label, desc?, valuePct }], nPoints?, width?, height? }
        // --------------------------------------------------
        function TimeSeriesChart(props) {
            var allSeries = props.series || [];
            var nPoints = props.nPoints || 12;
            var W = props.width || 440;
            var H = props.height || 180;
            var padL = 32;
            var padR = 8;
            var padT = 12;
            var padB = 28;
            var chartW = W - padL - padR;
            var chartH = H - padT - padB;

            var globalMax = 0;
            for (var s = 0; s < allSeries.length; s++)
                for (var j = 0; j < allSeries[s].data.length; j++)
                    globalMax = Math.max(globalMax, allSeries[s].data[j]);
            globalMax = Math.max(1, Math.ceil(globalMax));

            function xPos(i) { return padL + (i / (nPoints - 1)) * chartW; }
            function yPos(v) { return padT + chartH - (v / globalMax) * chartH; }

            var gridLines = [];
            var yTicks = [0, Math.round(globalMax / 2), globalMax];
            for (var g = 0; g < yTicks.length; g++) {
                gridLines.push({ y: yPos(yTicks[g]), label: yTicks[g] + '%' });
            }

            var xLabels = [];
            for (var t = 0; t < nPoints; t++) {
                var mins = (nPoints - 1 - t) * 5;
                if (t === 0 || t === Math.floor(nPoints / 2) || t === nPoints - 1) {
                    xLabels.push({ x: xPos(t), label: mins === 0 ? 'now' : ('-' + mins + 'm') });
                }
            }

            var paths = [];
            for (var si = 0; si < allSeries.length; si++) {
                var d = 'M';
                for (var pi = 0; pi < allSeries[si].data.length; pi++) {
                    d += (pi > 0 ? ' L' : '') + ' ' + xPos(pi).toFixed(1) + ' ' + yPos(allSeries[si].data[pi]).toFixed(1);
                }
                paths.push({ d: d, color: allSeries[si].color });
            }

            var dots = [];
            for (var di = 0; di < allSeries.length; di++) {
                var last = allSeries[di].data[nPoints - 1];
                dots.push({ cx: xPos(nPoints - 1), cy: yPos(last), color: allSeries[di].color });
            }

            return html`
                <div class="card p-4">
                    ${props.title ? html`<h3 class="text-xs text-gray-500 uppercase font-semibold" style="margin-bottom: 16px;">${props.title}</h3>` : null}
                    <div>
                        <svg viewBox=${"0 0 " + W + " " + H} style="width: 100%; height: auto; display: block;" xmlns="http://www.w3.org/2000/svg">
                            ${gridLines.map(function(gl) {
                                return html`
                                    <line x1=${padL} y1=${gl.y} x2=${W - padR} y2=${gl.y} stroke="rgba(255,255,255,0.06)" stroke-width="1" />
                                    <text x=${padL - 6} y=${gl.y + 3} text-anchor="end" fill="rgba(255,255,255,0.3)" font-size="9" font-family="var(--font-mono, monospace)">${gl.label}</text>
                                `;
                            })}
                            ${xLabels.map(function(xl) {
                                return html`<text x=${xl.x} y=${H - 6} text-anchor="middle" fill="rgba(255,255,255,0.3)" font-size="9" font-family="var(--font-mono, monospace)">${xl.label}</text>`;
                            })}
                            ${paths.map(function(p) {
                                return html`<path d=${p.d} fill="none" stroke=${p.color} stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.9" />`;
                            })}
                            ${dots.map(function(dt) {
                                return html`<circle cx=${dt.cx} cy=${dt.cy} r="3.5" fill=${dt.color} stroke="var(--bg-card)" stroke-width="1.5" />`;
                            })}
                        </svg>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
                            ${allSeries.map(function(sr) {
                                return html`
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style=${"width: 10px; height: 3px; border-radius: 2px; background:" + sr.color + "; flex-shrink: 0;"}></span>
                                        <span class="text-xs text-white" style="font-weight: 500;">${sr.label}</span>
                                        ${sr.desc ? html`<span class="text-xs text-gray-500">${sr.desc}</span>` : null}
                                        <span class="text-xs font-semibold tabular-nums status-warning" style="margin-left: auto;">${sr.valuePct}</span>
                                    </div>
                                `;
                            })}
                        </div>
                    </div>
                </div>
            `;
        }

        // --------------------------------------------------
        // AlertDetailView — reusable full alert page layout
        // props: { header: AlertHeader props, banner: AlertBanner props,
        //          slo: AnalyticsSloBreakdown props, chart: TimeSeriesChart props,
        //          traces: AlertTraceTable props }
        // --------------------------------------------------
        function AlertDetailView(props) {
            return html`
                <div>
                    <${AlertHeader} ...${props.header || {}} />
                    <${AlertBanner} ...${props.banner || {}} />
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <${AnalyticsSloBreakdown} ...${props.slo || {}} />
                        <${TimeSeriesChart} ...${props.chart || {}} />
                    </div>
                    <${AlertTraceTable} ...${props.traces || {}} />
                </div>
            `;
        }

        function InlineCallout(props) {
            var tone = (props && props.tone) ? String(props.tone) : 'warning';
            var icon = (props && props.icon) ? String(props.icon) : '';
            var text = (props && props.text) ? String(props.text) : '';
            var cls = 'inline-callout' + (tone ? (' inline-callout--' + tone) : '');
            return html`
                <span class=${cls} title=${text}>
                    ${icon ? html`<span class="inline-callout__icon" aria-hidden="true">${icon}</span>` : null}
                    <span class="inline-callout__text">${text}</span>
                </span>
            `;
        }

        function DeploymentNotices(props) {
            var items = (props && props.items) ? props.items : [];
            if (!items || !items.length) return null;
            return html`
                <div class="notice-panel">
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        ${items.map(function(n) {
                            var tone = n.tone || 'warning';
                            var cls = 'notice-item notice-item--' + tone;
                            var nav = n.nav || '';
                            return html`
                                <a href="#" class=${cls} data-nav=${nav} title=${n.title || ''}>
                                    <span class="notice-item__left">
                                        <span class="notice-item__icon" aria-hidden="true">${n.icon || '⚠️'}</span>
                                        <span style="min-width: 0;">
                                            <div class="notice-item__title">${n.title || ''}</div>
                                            ${n.detail ? html`<div class="notice-item__detail">${n.detail}</div>` : null}
                                        </span>
                                    </span>
                                    <span class="notice-item__right">
                                        <span>${n.actionText || 'View'}</span>
                                        <span aria-hidden="true">→</span>
                                    </span>
                                </a>
                            `;
                        })}
                    </div>
                </div>
            `;
        }

        function AnalyticsSloBreakdown(props) {
            // props: { name, windowText, current, threshold, segments: [{ label, valuePct, note, tone? }], seriesPct?: number[], thresholdPct?: number, trendBars?: [0..1] }
            var segments = (props && props.segments) ? props.segments : [];
            var bars = (props && props.trendBars) ? props.trendBars : [];
            var seriesPct = (props && props.seriesPct) ? props.seriesPct : [];
            var thresholdPct = (props && typeof props.thresholdPct === 'number') ? props.thresholdPct : null;
            var current = props.current != null ? props.current : '—';
            var threshold = props.threshold != null ? props.threshold : '—';
            return html`
                <div class="card p-4">
                    <h3 class="text-xs text-gray-500 uppercase font-semibold mb-3">Analytics SLO</h3>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <div>
                            <div class="text-white font-semibold" style="font-size: 14px;">${props.name || '—'}</div>
                            <div class="text-xs text-gray-400 mt-1">${props.windowText || ''}</div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div style="padding: 10px;">
                                <div class="text-xs text-gray-500">Current</div>
                                <div class="text-lg text-white font-semibold tabular-nums" style="margin-top: 2px;">${current}</div>
                            </div>
                            <div style="padding: 10px;">
                                <div class="text-xs text-gray-500">Threshold</div>
                                <div class="text-lg text-white font-semibold tabular-nums" style="margin-top: 2px;">${threshold}</div>
                            </div>
                        </div>

                        ${segments && segments.length ? html`
                            <div>
                                <div class="text-xs text-gray-500 mb-2">Top contributors</div>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    ${segments.map(function(s){
                                        var tone = s.tone || 'warning';
                                        var badgeCls = tone === 'error' ? 'score-badge error' : (tone === 'success' ? 'score-badge success' : 'score-badge');
                                        return html`
                                            <div class="flex items-center justify-between" style="gap: 12px;">
                                                <div style="min-width: 0;">
                                                    <div class="text-sm text-white truncate">${s.label}</div>
                                                    ${s.note ? html`<div class="text-xs text-gray-400 mt-1">${s.note}</div>` : null}
                                                </div>
                                                <span class=${badgeCls} style="font-variant-numeric: tabular-nums;">${s.valuePct}</span>
                                            </div>
                                        `;
                                    })}
                                </div>
                            </div>
                        ` : null}
                    </div>
                </div>
            `;
        }

        function AlertTraceTable(props) {
            // props: { title, rows: [{ traceId, feedback, query, latency, model, tool, source, satisfaction, faithfulness, relevance, timestamp, nav }] }
            var allRows = (props && props.rows) ? props.rows : [];

            var columns = [
                {
                    key: 'feedback', label: '', width: '44px', align: 'center',
                    render: function(row) {
                        var isDown = row.feedback === 'down';
                        return html`<span class=${"trace-feedback " + (isDown ? 'thumbs-down' : 'thumbs-up')} style="width: 26px; height: 26px; font-size: 13px; margin: 0;">${isDown ? '👎' : '👍'}</span>`;
                    }
                },
                {
                    key: 'traceId', label: 'Trace ID', width: '120px',
                    render: function(row) {
                        return html`<span class="font-mono text-xs text-gray-400">${row.traceId || ''}</span>`;
                    }
                },
                {
                    key: 'query', label: 'User Query',
                    render: function(row) {
                        return html`<span class="text-sm text-white" style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;">${row.query || ''}</span>`;
                    }
                },
                {
                    key: 'analytics', label: 'Analytics Event', width: '200px',
                    render: function(row) {
                        var events = (row.analytics && row.analytics.length) ? row.analytics : [];
                        if (!events.length) return html`<span class="text-xs text-gray-500">—</span>`;
                        var colors = { 'Thumbs Down': '#F59E0B', 'Bad Chunk': '#8B5CF6' };
                        return html`
                            <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                                ${events.map(function(ev) {
                                    var c = colors[ev] || 'var(--text-muted)';
                                    return html`<span
                                        style=${"display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 999px; font-size: 10px; font-weight: 600; letter-spacing: 0.02em; cursor: pointer; border: 1px solid " + c + "33; background: " + c + "18; color: " + c + ";"}
                                        title=${ev}
                                    ><span style=${"width: 5px; height: 5px; border-radius: 50%; background:" + c + "; flex-shrink: 0;"}></span>${ev}</span>`;
                                })}
                            </div>
                        `;
                    }
                },
                {
                    key: 'latency', label: 'Latency', width: '80px', align: 'right',
                    render: function(row) {
                        var v = row.latency;
                        var cls = v > 3 ? 'status-error' : v > 2 ? 'status-warning' : 'text-gray-300';
                        return html`<span class=${"text-xs font-mono " + cls}>${v != null ? v.toFixed(1) + 's' : '—'}</span>`;
                    }
                },
                {
                    key: 'model', label: 'Model', width: '120px',
                    render: function(row) {
                        return html`<span class="text-xs font-mono text-gray-400">${row.model || '—'}</span>`;
                    }
                },
                {
                    key: 'timestamp', label: 'Time', width: '80px', align: 'right',
                    render: function(row) {
                        return html`<span class="text-xs text-gray-500">${row.timestamp || ''}</span>`;
                    }
                }
            ];

            return html`
                <div class="card overflow-hidden">
                    <${DataTable}
                        title=${props.title || 'Correlated Traces'}
                        columns=${columns}
                        rows=${allRows}
                        searchPlaceholder="Search traces by query, model, source..."
                        pageSize=${5}
                        autoPageSize=${false}
                    />
                </div>
            `;
        }

        // --------------------------------------------------
        // Inbox — reusable inbox/notification list component
        // --------------------------------------------------
        // props: {
        //   title:      string           — header label (e.g. "Alerts")
        //   items:      InboxItem[]      — list of items to display
        //   emptyIcon:  string?          — emoji/icon when list is empty
        //   emptyText:  string?          — message when list is empty
        //   filters:    string[]?        — filter labels, default ['All', 'Unread']
        // }
        // InboxItem: {
        //   id:         string           — unique id
        //   icon:       string           — emoji for the item icon
        //   tone:       string           — 'warning' | 'error' | 'success' | 'info'
        //   title:      string           — item title
        //   detail:     string           — description / body text
        //   timestamp:  string           — relative time string e.g. '12m ago'
        //   unread:     boolean          — show unread indicator
        //   tags:       Tag[]?           — optional tags to show
        //   source:     string?          — source identifier (monospace)
        //   nav:        string?          — data-nav target on click
        // }
        // Tag: { label: string, tone?: string }
        function Inbox(props) {
            var title = (props && props.title) ? props.title : 'Inbox';
            var items = (props && props.items) ? props.items : [];
            var emptyIcon = (props && props.emptyIcon) ? props.emptyIcon : '📭';
            var emptyText = (props && props.emptyText) ? props.emptyText : 'No items yet';
            var filterLabels = (props && props.filters) ? props.filters : ['All', 'Unread'];

            var _f = useState(0);
            var activeFilter = _f[0];
            var setActiveFilter = _f[1];

            var unreadCount = items.filter(function(it) { return it.unread; }).length;

            var visibleItems = items;
            if (activeFilter === 1) {
                visibleItems = items.filter(function(it) { return it.unread; });
            }

            return html`
                <div class="inbox">
                    <div class="inbox__header">
                        <span class="inbox__title">${title}</span>
                        <div class="inbox__filters">
                            ${filterLabels.map(function(label, idx) {
                                var isActive = idx === activeFilter;
                                var cls = 'inbox__filter-btn' + (isActive ? ' active' : '');
                                return html`
                                    <button class=${cls} onClick=${function() { setActiveFilter(idx); }}>
                                        ${label}
                                        ${idx === 1 && unreadCount > 0 ? html`<span class="inbox__count">${unreadCount}</span>` : null}
                                    </button>
                                `;
                            })}
                        </div>
                    </div>

                    <div class="inbox__list">
                        ${visibleItems.length === 0 ? html`
                            <div class="inbox__empty">
                                <div class="inbox__empty-icon">${emptyIcon}</div>
                                <div class="inbox__empty-text">${activeFilter === 1 ? 'No unread items' : emptyText}</div>
                            </div>
                        ` : visibleItems.map(function(item) {
                            var pri = item.priority || 4;
                            var itemCls = 'inbox__item inbox__item--p' + pri + (item.unread ? ' is-unread' : '');
                            var priLabel = pri === 1 ? 'P1' : pri === 2 ? 'P2' : pri === 3 ? 'P3' : 'P4';
                            var priColor = pri === 1 ? '#ef4444' : pri === 2 ? '#f59e0b' : pri === 3 ? 'var(--text-secondary)' : 'var(--text-muted)';
                            var priBg = pri === 1 ? 'rgba(239,68,68,0.12)' : pri === 2 ? 'rgba(245,158,11,0.12)' : pri === 3 ? 'rgba(255,255,255,0.06)' : 'rgba(255,255,255,0.04)';
                            var priBorder = pri === 1 ? 'rgba(239,68,68,0.25)' : pri === 2 ? 'rgba(245,158,11,0.25)' : pri === 3 ? 'rgba(255,255,255,0.14)' : 'rgba(255,255,255,0.08)';
                            return html`
                                <a
                                    href="#"
                                    class=${itemCls}
                                    key=${item.id}
                                    data-nav=${item.nav || ''}
                                    onClick=${function(e) {
                                        if (item.nav) {
                                            e.preventDefault();
                                            window.showView(item.nav);
                                        }
                                    }}
                                >
                                    <div class="inbox__item-body">
                                        <div class="inbox__item-row">
                                            <span style="display: flex; align-items: center; gap: 8px; min-width: 0;">
                                                ${item.unread ? html`<span style="width: 7px; height: 7px; border-radius: 50%; background: var(--text-primary); flex-shrink: 0;"></span>` : html`<span style="width: 7px; flex-shrink: 0;"></span>`}
                                                <span class="inbox__item-title">${item.title || ''}</span>
                                            </span>
                                            <span style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
                                                <span style=${'font-size: 10px; padding: 1px 6px; border-radius: 999px; font-weight: 700; background: ' + priBg + '; color: ' + priColor + '; border: 1px solid ' + priBorder + '; letter-spacing: 0.03em;'}>${priLabel}</span>
                                                <span class="inbox__item-time">${item.timestamp || ''}</span>
                                            </span>
                                        </div>
                                        ${item.detail ? html`<div class="inbox__item-detail" style="padding-left: 15px;">${item.detail}</div>` : null}
                                        ${(item.tags && item.tags.length) || item.source ? html`
                                            <div class="inbox__item-meta" style="padding-left: 15px;">
                                                ${(item.tags || []).map(function(tag) {
                                                    var tagCls = 'inbox__item-tag inbox__item-tag--' + (tag.tone || item.tone || 'info');
                                                    return html`<span class=${tagCls}>${tag.label}</span>`;
                                                })}
                                                ${item.source ? html`<span class="inbox__item-source">${item.source}</span>` : null}
                                            </div>
                                        ` : null}
                                    </div>
                                </a>
                            `;
                        })}
                    </div>
                </div>
            `;
        }

        // --------------------------------------------------
        // AlertsView — uses Inbox to display deployment alerts
        // --------------------------------------------------
        function AlertsView(props) {
            var deploymentName = (props && props.deploymentName) ? props.deploymentName : 'Deployment';
            var backNav = (props && props.backNav) ? props.backNav : 'agents';
            var alertItems = (props && props.items) ? props.items : [];

            return html`
                <div>
                    <div class="flex items-center gap-4 mb-6">
                        <div class="flex-1">
                            <h1 class="text-xl font-semibold text-white">${deploymentName} — Alerts</h1>
                            <p class="text-sm text-gray-500 mt-1">Monitoring alerts and notifications for this deployment</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="btn btn-ghost" style="font-size: 12px;">Mark all read</button>
                            <button class="btn btn-secondary" style="font-size: 12px;">Settings</button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 260px; gap: 16px; align-items: start;">
                        <${Inbox}
                            title="Alerts"
                            items=${alertItems}
                            emptyIcon="✅"
                            emptyText="No alerts — all systems nominal"
                        />

                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="card p-4">
                                <h3 class="text-xs text-gray-500 uppercase font-semibold mb-3">Summary</h3>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-500">Total alerts</span>
                                        <span class="text-white">${alertItems.length}</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-500">Unread</span>
                                        <span class="text-white">${alertItems.filter(function(i) { return i.unread; }).length}</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-500">Critical</span>
                                        <span class="status-error">${alertItems.filter(function(i) { return i.tone === 'error'; }).length}</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-500">Warnings</span>
                                        <span class="status-warning">${alertItems.filter(function(i) { return i.tone === 'warning'; }).length}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="card p-4">
                                <h3 class="text-xs text-gray-500 uppercase font-semibold mb-3">Alert Rules</h3>
                                <div style="display: flex; flex-direction: column; gap: 6px;">
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-400">Satisfaction SLO</span>
                                        <span class="status-success">● Active</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-400">Feedback SLO</span>
                                        <span class="status-success">● Active</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-400">Latency P99</span>
                                        <span class="status-success">● Active</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-400">Error Rate</span>
                                        <span class="status-success">● Active</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-400">Chunk Quality</span>
                                        <span class="text-gray-500">● Disabled</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function mountAlertsInbox() {
            if (!__hasPreact) return;

            var root = document.getElementById('deployment-alerts-root');
            if (!root) return;

            var alertItems = [
                {
                    id: 'alert-1',
                    tone: 'warning',
                    priority: 1,
                    title: 'Feedback SLO breached',
                    detail: 'Thumbs-down rate 30.4% exceeded 20% threshold (last 1h) on cs-bot-openai. Topic analysis indicates refund/returns queries are the primary contributor.',
                    timestamp: '12m ago',
                    unread: true,
                    tags: [{ label: 'SLO', tone: 'warning' }, { label: 'Analytics' }],
                    source: 'cs-bot-openai',
                    nav: 'deployment-alert-cs-openai-feedback'
                },
                {
                    id: 'alert-2',
                    tone: 'error',
                    priority: 1,
                    title: 'Satisfaction score critically low',
                    detail: 'MLflow Judge response_satisfaction dropped to 0.38 on 3 consecutive evaluations. Below critical threshold of 0.50.',
                    timestamp: '28m ago',
                    unread: true,
                    tags: [{ label: 'Critical', tone: 'error' }, { label: 'Evaluation' }],
                    source: 'pa-agent-prod',
                    nav: 'deployment-alert-cs-openai-feedback'
                },
                {
                    id: 'alert-3',
                    tone: 'warning',
                    priority: 2,
                    title: 'P99 latency exceeded threshold',
                    detail: 'P99 latency at 2,840ms exceeds the 2,000ms SLO target. Investigate LLM response times and retrieval bottlenecks.',
                    timestamp: '45m ago',
                    unread: true,
                    tags: [{ label: 'Latency', tone: 'warning' }],
                    source: 'cs-bot-openai',
                    nav: 'deployment-alert-cs-openai-feedback'
                },
                {
                    id: 'alert-4',
                    tone: 'warning',
                    priority: 2,
                    title: 'Malformed chunks detected',
                    detail: '3 malformed chunks found in product-knowledge-store affecting retrieval quality. Chunks contain NUL bytes and truncated content.',
                    timestamp: '1h ago',
                    unread: false,
                    tags: [{ label: 'Data Quality', tone: 'warning' }],
                    source: 'product-knowledge-store',
                    nav: 'chunk-lineage'
                },
                {
                    id: 'alert-5',
                    tone: 'info',
                    priority: 3,
                    title: 'Model version pinned',
                    detail: 'gpt-4-turbo pinned to v2026.02 for cs-bot-prod. Previous version v2026.01 moved to staging.',
                    timestamp: '2h ago',
                    unread: false,
                    tags: [{ label: 'Deployment' }],
                    source: 'cs-bot-prod',
                    nav: 'model-gpt-4-turbo'
                },
                {
                    id: 'alert-6',
                    tone: 'success',
                    priority: 4,
                    title: 'Error rate recovered',
                    detail: 'Error rate for cs-bot-prod returned to 0.3%, below the 1.0% threshold. Auto-resolved after 47 minutes.',
                    timestamp: '3h ago',
                    unread: false,
                    tags: [{ label: 'Resolved', tone: 'success' }],
                    source: 'cs-bot-prod'
                },
                {
                    id: 'alert-7',
                    tone: 'warning',
                    priority: 2,
                    title: 'Token cost approaching budget',
                    detail: 'cs-bot-openai hourly token cost at $22.40, approaching the $25.00 budget threshold. Consider reviewing prompt efficiency.',
                    timestamp: '4h ago',
                    unread: false,
                    tags: [{ label: 'Cost', tone: 'warning' }],
                    source: 'cs-bot-openai'
                },
                {
                    id: 'alert-8',
                    tone: 'info',
                    priority: 3,
                    title: 'Guardrail policy updated',
                    detail: 'PII detection guardrail threshold updated from 0.85 to 0.90 confidence by admin user ml-platform-team.',
                    timestamp: '6h ago',
                    unread: false,
                    tags: [{ label: 'Policy' }],
                    source: 'guardrails',
                    nav: 'guardrails'
                }
            ];

            render(html`<${AlertsView}
                deploymentName="Customer Support Bot"
                backNav="agent-detail-cs"
                items=${alertItems}
            />`, root);
        }

        function ModelBadge(props) {
            var m = (props && props.model) ? props.model : null;
            var name = m && m.name ? String(m.name) : '';
            var nav = (m && m.nav) ? m.nav : 'models';

            var provider = (name.indexOf(':') !== -1) ? name.split(':')[0].trim().toLowerCase() : '';
            var modelLabel = (name.indexOf(':') !== -1) ? name.split(':').slice(1).join(':').trim() : name;
            var domain = (provider === 'openai') ? 'openai.com'
                : (provider === 'vercel') ? 'vercel.com'
                : (provider === 'ollama') ? 'ollama.com'
                : (provider === 'vllm') ? 'vllm.ai'
                : '';
            var iconUrl = domain ? ('https://www.google.com/s2/favicons?domain=' + domain + '&sz=64') : '';

            return html`
                <a
                    href="#"
                    class="tool-badge"
                    title=${provider ? ('Provider: ' + provider) : modelLabel}
                    onClick=${function(e){ e.preventDefault(); window.showView(nav); }}
                >
                    ${iconUrl ? html`<img class="tool-badge__icon" src=${iconUrl} alt="" />` : null}
                    <span>${modelLabel}</span>
                </a>
            `;
        }

        function SvcZone(props) {
            var cls = "svc-zone" + (props.col ? " svc-zone-col" : "");
            return html`
                <div class=${cls} style=${props.style || ''}>
                    ${props.label
                        ? html`
                            <span class="svc-zone-label" style=${props.labelStyle || ''}>
                                <${PlatformBadge} name=${props.label} favicon=${props.favicon} size=${12} />
                            </span>
                        `
                        : null}
                    ${props.children}
                </div>
            `;
        }

        function SvcNode(props) {
            function svcIcon(name) {
                // Line-icon style to match the sidebar icons (stroke=currentColor).
                switch (name) {
                    case 'agent':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 2l7 4v12l-7 4-7-4V6l7-4Z"></path>
                            <path d="M12 7v10"></path>
                            <path d="M8.5 10.5h7"></path>
                        </svg>`;
                    case 'model':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 3 21 8.5 12 14 3 8.5 12 3Z"></path>
                            <path d="M21 8.5V15.5L12 21 3 15.5V8.5"></path>
                            <path d="M12 14v7"></path>
                        </svg>`;
                    case 'db':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <ellipse cx="12" cy="5" rx="7" ry="3"></ellipse>
                            <path d="M5 5v6c0 1.7 3.1 3 7 3s7-1.3 7-3V5"></path>
                            <path d="M5 11v6c0 1.7 3.1 3 7 3s7-1.3 7-3v-6"></path>
                        </svg>`;
                    case 'shield':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 2l8 4v6c0 5-3.5 9.5-8 10-4.5-.5-8-5-8-10V6l8-4Z"></path>
                        </svg>`;
                    case 'tool':
                        // Match the Tools icon used in the sidebar exactly.
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M14.7 6.3a4.5 4.5 0 0 0-6.4 6.4l-5.1 5.1a2 2 0 0 0 2.8 2.8l5.1-5.1a4.5 4.5 0 0 0 6.4-6.4l-2.2 2.2-2.8-2.8 2.2-2.2Z"></path>
                        </svg>`;
                    case 'github':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M16 18l6-6-6-6"></path>
                            <path d="M8 6l-6 6 6 6"></path>
                        </svg>`;
                    case 'slack':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M21 15a4 4 0 0 1-4 4H7l-4 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"></path>
                        </svg>`;
                    case 'notion':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <path d="M14 2v6h6"></path>
                            <path d="M8 13h8"></path>
                            <path d="M8 17h8"></path>
                            <path d="M8 9h2"></path>
                        </svg>`;
                    case 'tavily':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="11" cy="11" r="7"></circle>
                            <path d="M21 21l-4.3-4.3"></path>
                        </svg>`;
                    case 'playwright':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <rect x="3" y="4" width="18" height="12" rx="2"></rect>
                            <path d="M7 20h10"></path>
                            <path d="M12 16v4"></path>
                        </svg>`;
                    case 'vercel':
                        return html`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M12 4l8 16H4z"></path>
                        </svg>`;
                    default:
                        return null;
                }
            }

            var cls = "svc-node" + (props.className ? (" " + props.className) : "");
            var iconVNode = svcIcon(props.icon);
            return html`
                <div
                    class=${cls}
                    style=${props.style || ''}
                    data-node-id=${props.nodeId || ''}
                    data-edges=${props.edges}
                    data-nav=${props.nav}
                >
                    <span class="svc-node-icon">${iconVNode ? iconVNode : props.icon}</span>
                    <p class="svc-node-name">
                        ${props.favicon ? html`<img src=${props.favicon} alt="" style="width: 14px; height: 14px; border-radius: 3px; flex-shrink: 0; vertical-align: middle; margin-right: 4px;" />` : null}
                        <span>${props.name}</span>
                        ${props.label ? html`<span class="svc-node-pill">${props.label}</span>` : null}
                    </p>
                    ${props.meta1 ? html`<p class="svc-node-meta">${props.meta1}</p>` : null}
                    ${props.meta2 ? html`<p class=${"svc-node-meta " + (props.meta2Class || '')}>${props.meta2}</p>` : null}
                </div>
            `;
        }

        function mountSvcGraphs() {
            if (!__hasPreact) return;

            function mount(id, vnode) {
                var el = document.getElementById(id);
                if (el) render(vnode, el);
            }

            // Platform badges in deployment config cards
            mount('cs-prod-platform-badge', html`<${PlatformBadge} name="OpenShift Cluster" size=${14} />`);

            // Agent detail — Customer Support Bot
            mount('svc-graph-agent-cs', html`
                <${SvcGraph}>
                    <${SvcRow}>
                        <${SvcNode} className="node-success node-primary" nodeId="cs-agent" edges="cs-model|rgba(255,255,255,0.2); cs-guardrails|rgba(255,255,255,0.2); cs-db|rgba(16,185,129,0.35); cs-ticket|rgba(59,130,246,0.25); cs-order|rgba(59,130,246,0.25); cs-faq|rgba(59,130,246,0.25)" icon="🤖" name="Customer Support Bot" meta2="● Healthy" meta2Class="status-success" />
                    </${SvcRow}>
                    <${SvcRow} style="gap: 12px;">
                        <${SvcZone} label="OpenAI" style="border-color: rgba(16,163,127,0.3); background: rgba(16,163,127,0.03);" labelStyle="color: #10A37F; background: rgba(16,163,127,0.12);">
                            <${SvcNode} nodeId="cs-model" icon="🧠" name="gpt-4-turbo" meta1="OpenAI API · 128K ctx" />
                        </${SvcZone}>
                        <${SvcNode} nodeId="cs-guardrails" icon="🛡️" name="content-filter-v2" meta1="Guardrails API" />
                        <${SvcZone} label="Milvus" style="border-color: rgba(139,92,246,0.3); background: rgba(139,92,246,0.03);" labelStyle="color: #8B5CF6; background: rgba(139,92,246,0.12);">
                            <${SvcNode} className="node-success" nodeId="cs-db" nav="db-detail-sas" icon="▤" name="support-articles-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=milvus.io" meta1="Milvus · 3,214 chunks" meta2="● Healthy" meta2Class="status-success" />
                        </${SvcZone}>
                    </${SvcRow}>
                    <${SvcRow}>
                        <${SvcNode} nodeId="cs-ticket" edges="" icon="tool" name="ticket_create" meta1="MCP · Ticketing API" style="border-color: rgba(59,130,246,0.4);" />
                        <${SvcNode} nodeId="cs-order" edges="" icon="tool" name="order_lookup" meta1="MCP · Orders API" style="border-color: rgba(59,130,246,0.4);" />
                        <${SvcNode} nodeId="cs-faq" edges="" icon="tool" name="faq_search" meta1="MCP · RAG retrieval" style="border-color: rgba(59,130,246,0.4);" />
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // Agent detail — Product Advisor Agent
            mount('svc-graph-agent-pa', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start; gap: 16px;">
                        <${SvcZone} col=${true} label="Red Hat OpenShift AI" style="border-color: rgba(238,0,0,0.3); background: rgba(238,0,0,0.02); flex: 1;" labelStyle="color: #EE0000; background: rgba(238,0,0,0.12);">
                            <${SvcNode} className="node-warning node-primary" nodeId="pa-agent" edges="pa-model|rgba(255,255,255,0.2); pa-guardrails|rgba(255,255,255,0.2); pa-db|rgba(245,158,11,0.45); pa-search|rgba(59,130,246,0.25); pa-catalog|rgba(59,130,246,0.25)" icon="🎯" name="Product Advisor Agent" meta2="● Degraded" meta2Class="status-warning" />
                            <${SvcRow}>
                                <${SvcNode} nodeId="pa-model" icon="🧠" name="Llama 3.1 70B" meta1="vLLM Serving Runtime" />
                                <${SvcNode} className="node-warning" nodeId="pa-db" nav="db-detail-pks" icon="▤" name="product-knowledge-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=trychroma.com" meta1="ChromaDB · 8,901 chunks" meta2="⚠ 3 malformed" meta2Class="status-warning" />
                            </${SvcRow}>
                            <${SvcRow}>
                                <${SvcNode} nodeId="pa-search" icon="tool" name="product_search" meta1="MCP · Catalog API" style="border-color: rgba(59,130,246,0.4);" />
                                <${SvcNode} nodeId="pa-catalog" icon="tool" name="catalog_lookup" meta1="MCP · Inventory Svc" style="border-color: rgba(59,130,246,0.4);" />
                            </${SvcRow}>
                        </${SvcZone}>
                        <${SvcZone} col=${true} label="OpenAI (External)" style="border-color: rgba(16,163,127,0.3); background: rgba(16,163,127,0.03); min-width: 170px;" labelStyle="color: #10A37F; background: rgba(16,163,127,0.12);">
                            <${SvcNode} nodeId="pa-guardrails" icon="🛡️" name="product-safety-v1" meta1="Guardrails API" />
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // DB detail — product-knowledge-store
            mount('svc-graph-db-pks', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start;">
                        <${SvcZone} col=${true} label="Red Hat OpenShift AI" style="border-color: rgba(238,0,0,0.3); background: rgba(238,0,0,0.02); flex: 1; max-width: 700px;" labelStyle="color: #EE0000; background: rgba(238,0,0,0.12);">
                            <${SvcZone} label="Ingestion" style="border-color: rgba(107,114,128,0.25); background: rgba(107,114,128,0.02); width: 100%;" labelStyle="color: #9CA3AF; background: rgba(107,114,128,0.1);">
                                <${SvcNode} nodeId="pks-docs" edges="pks-pipeline|rgba(255,255,255,0.2)" icon="📂" name="Source Documents" meta1="47 docs · S3 bucket" />
                                <${SvcNode} nodeId="pks-pipeline" edges="pks-store|rgba(245,158,11,0.45)" icon="⚙️" name="faq-pipeline-v3" meta1="Ingestion · 2h ago" />
                            </${SvcZone}>
                            <${SvcNode} className="node-warning node-primary" nodeId="pks-store" edges="pks-pa|rgba(245,158,11,0.4); pks-kb|rgba(255,255,255,0.2); pks-ds|rgba(255,255,255,0.2)" icon="▤" name="product-knowledge-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=trychroma.com" meta1="ChromaDB · 8,901 chunks" meta2="⚠ 3 malformed" meta2Class="status-warning" />
                        </${SvcZone}>
                    </${SvcRow}>
                    <${SvcRow}>
                        <${SvcZone} label="Consumer Agents (3)" style="border-color: rgba(139,92,246,0.25); background: rgba(139,92,246,0.02); flex: 1; max-width: 700px;" labelStyle="color: #8B5CF6; background: rgba(139,92,246,0.1);">
                            <${SvcNode} className="node-warning" nodeId="pks-pa" nav="agent-detail-pa" icon="🎯" name="Product Advisor Agent" meta2="● Degraded · 8.2K req/day" meta2Class="status-warning" />
                            <${SvcNode} nodeId="pks-kb" icon="🤖" name="Knowledge Base Q&A" meta2="● Healthy · 1.4K req/day" meta2Class="status-success" />
                            <${SvcNode} nodeId="pks-ds" icon="🤖" name="Document Summarizer" meta2="● Healthy · 820 req/day" meta2Class="status-success" />
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // DB detail — support-articles-store
            mount('svc-graph-db-sas', html`
                <${SvcGraph}>
                    <${SvcRow}>
                        <${SvcZone} label="Ingestion" style="border-color: rgba(107,114,128,0.25); background: rgba(107,114,128,0.02); flex: 1; max-width: 700px;" labelStyle="color: #9CA3AF; background: rgba(107,114,128,0.1);">
                            <${SvcNode} nodeId="sas-docs" edges="sas-pipeline|rgba(255,255,255,0.2)" icon="📂" name="Source Documents" meta1="128 docs · Zendesk sync" />
                            <${SvcNode} nodeId="sas-pipeline" edges="sas-store|rgba(16,185,129,0.35)" icon="⚙️" name="support-ingest-v2" meta1="Ingestion · 6h ago" />
                        </${SvcZone}>
                    </${SvcRow}>
                    <${SvcRow}>
                        <${SvcZone} label="Milvus" style="border-color: rgba(139,92,246,0.3); background: rgba(139,92,246,0.03);" labelStyle="color: #8B5CF6; background: rgba(139,92,246,0.12);">
                            <${SvcNode} className="node-success" nodeId="sas-store" edges="sas-agent|rgba(16,185,129,0.3)" icon="▤" name="support-articles-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=milvus.io" meta1="Milvus · 3,214 chunks" meta2="● Healthy" meta2Class="status-success" />
                        </${SvcZone}>
                    </${SvcRow}>
                    <${SvcRow}>
                        <${SvcNode} className="node-success" nodeId="sas-agent" nav="agent-detail-cs" icon="🤖" name="Customer Support Bot" meta2="● Healthy" meta2Class="status-success" />
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // Deployment — pa-agent-prod
            mount('svc-graph-dep-pa-prod', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start; gap: 16px;">
                        <${SvcZone} col=${true} label="Red Hat OpenShift AI" style="border-color: rgba(238,0,0,0.3); background: rgba(238,0,0,0.02); flex: 1;" labelStyle="color: #EE0000; background: rgba(238,0,0,0.12);">
                            <${SvcNode} className="node-warning node-primary" nodeId="dep-pa-agent" nav="agent-detail-pa" edges="dep-pa-model|rgba(255,255,255,0.2); dep-pa-db|rgba(245,158,11,0.45); dep-pa-guard|rgba(255,255,255,0.2); dep-pa-tools|rgba(59,130,246,0.25)" icon="🎯" name="pa-agent-prod" meta1="Agent Endpoint" meta2="● Degraded" meta2Class="status-warning" />
                            <${SvcRow}>
                                <${SvcNode} nodeId="dep-pa-model" icon="🧠" name="Llama 3.1 70B" meta1="vLLM Serving Runtime" meta2="● Healthy" meta2Class="status-success" />
                                <${SvcNode} className="node-warning" nodeId="dep-pa-db" nav="db-detail-pks" edges="dep-pa-embed|rgba(255,255,255,0.2)" icon="▤" name="product-knowledge-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=trychroma.com" meta1="ChromaDB · 8,901 chunks" meta2="⚠ 3 malformed" meta2Class="status-warning" />
                            </${SvcRow}>
                            <${SvcRow}>
                                <${SvcNode} nodeId="dep-pa-embed" icon="🔗" name="text-embedding-3-large" meta1="Embedding Model" meta2="● Healthy" meta2Class="status-success" />
                        <${SvcNode} nodeId="dep-pa-tools" icon="tool" name="Tools" meta1="product_search, catalog_lookup" meta2="● Connected" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                            </${SvcRow}>
                        </${SvcZone}>
                        <${SvcZone} col=${true} label="OpenAI (External)" style="border-color: rgba(16,163,127,0.3); background: rgba(16,163,127,0.03); min-width: 170px;" labelStyle="color: #10A37F; background: rgba(16,163,127,0.12);">
                            <${SvcNode} nodeId="dep-pa-guard" icon="🛡️" name="product-safety-v1" meta1="Guardrails API" meta2="● Active" meta2Class="status-success" />
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // Deployment — cs-bot-prod
            mount('svc-graph-dep-cs-prod', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start; gap: 14px;">
                        <${SvcZone} col=${true} label="OpenAI" style="border-color: rgba(16,163,127,0.3); background: rgba(16,163,127,0.03); flex: 1; min-width: 260px;" labelStyle="color: #10A37F; background: rgba(16,163,127,0.12);">
                            <${SvcNode} nodeId="dep-cs-model" nav="models" icon="model" name="gpt-4-turbo v2026.01" meta1="OpenAI model" meta2="● Healthy" meta2Class="status-success" />
                            <${SvcNode} nodeId="dep-cs-guard" nav="tools" icon="shield" name="content-filter v2" label="API" meta1="Moderations (guardrails)" meta2="● Healthy" meta2Class="status-success" />
                        </${SvcZone}>
                        <${SvcZone}
                            col=${true}
                            label="OpenShift Cluster"
                            style="border-color: rgba(238,0,0,0.26); background: rgba(238,0,0,0.02); flex: 1; min-width: 320px;"
                            labelStyle="color: #EE0000; background: rgba(238,0,0,0.12);"
                        >
                            <${SvcNode}
                                className="node-success node-primary"
                                nodeId="dep-cs-agent"
                                nav="agent-detail-cs"
                                edges="dep-cs-model|rgba(255,255,255,0.2); dep-cs-guard|rgba(255,255,255,0.2); dep-cs-db|rgba(16,185,129,0.35); dep-cs-tool-ticket|rgba(59,130,246,0.25); dep-cs-tool-order|rgba(59,130,246,0.25); dep-cs-tool-faq|rgba(59,130,246,0.25)"
                                icon="agent"
                                name="cs-bot-prod"
                                meta1="Agent endpoint · v2.1"
                                meta2="● Healthy"
                                meta2Class="status-success"
                            />
                            <${SvcNode} className="node-success" nodeId="dep-cs-db" nav="db-detail-sas" icon="db" name="support-articles-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=milvus.io" meta1="Vector store · 3,214 chunks · snapshot@2026-02-06" meta2="● Healthy" meta2Class="status-success" />
                            <${SvcRow} style="gap: 12px;">
                                <${SvcNode} nodeId="dep-cs-tool-ticket" nav="tools" icon="tool" name="Slack v3" label="MCP" favicon="https://www.google.com/s2/favicons?sz=64&domain=slack.com" meta1="ticket_create" meta2="● Healthy" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                                <${SvcNode} nodeId="dep-cs-tool-order" nav="tools" icon="tool" name="GitHub v2" label="MCP" favicon="https://www.google.com/s2/favicons?sz=64&domain=github.com" meta1="order_lookup" meta2="● Healthy" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                                <${SvcNode} nodeId="dep-cs-tool-faq" nav="tools" icon="tool" name="Notion v1" label="MCP" favicon="https://www.google.com/s2/favicons?sz=64&domain=notion.so" meta1="faq_search" meta2="● Healthy" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                            </${SvcRow}>
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // Deployment — cs-bot-openai (degraded: feedback SLO breach)
            mount('svc-graph-dep-cs-openai', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start; gap: 14px;">
                        <${SvcZone} col=${true} label="OpenAI" style="border-color: rgba(16,163,127,0.3); background: rgba(16,163,127,0.03); flex: 1; min-width: 320px;" labelStyle="color: #10A37F; background: rgba(16,163,127,0.12);">
                            <${SvcNode}
                                className="node-warning node-primary"
                                nodeId="dep-cs-openai-agent"
                                nav="agent-detail-cs"
                                edges="dep-cs-openai-model|rgba(255,255,255,0.2); dep-cs-openai-db|rgba(16,185,129,0.25); dep-cs-openai-tool-ticket|rgba(59,130,246,0.25); dep-cs-openai-tool-order|rgba(59,130,246,0.25); dep-cs-openai-tool-faq|rgba(59,130,246,0.25)"
                                icon="agent"
                                name="cs-bot-openai"
                                meta1="Hosted deployment · v2.1 · feedback SLO breached"
                                meta2="● Warning"
                                meta2Class="status-warning"
                            />
                            <${SvcRow} style="gap: 12px;">
                                <${SvcNode} nodeId="dep-cs-openai-model" nav="models" icon="model" name="gpt-4o-mini" meta1="OpenAI model" meta2="● Healthy" meta2Class="status-success" />
                            </${SvcRow}>
                        </${SvcZone}>
                        <${SvcZone}
                            col=${true}
                            label="OpenShift Cluster"
                            style="border-color: rgba(238,0,0,0.26); background: rgba(238,0,0,0.02); flex: 1; min-width: 340px;"
                            labelStyle="color: #EE0000; background: rgba(238,0,0,0.12);"
                        >
                            <${SvcNode} className="node-warning" nodeId="dep-cs-openai-db" nav="db-detail-sas-stale" icon="db" name="support-articles-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=milvus.io" meta1="Milvus · snapshot@2025-12-18" meta2="● Warning" meta2Class="status-warning" />
                            <${SvcRow} style="gap: 12px;">
                                <${SvcNode} nodeId="dep-cs-openai-tool-ticket" nav="tools" icon="tool" name="Slack v3" label="MCP" favicon="https://www.google.com/s2/favicons?sz=64&domain=slack.com" meta1="ticket_create" meta2="● Healthy" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                                <${SvcNode} nodeId="dep-cs-openai-tool-order" nav="tools" icon="tool" name="GitHub v2" label="MCP" favicon="https://www.google.com/s2/favicons?sz=64&domain=github.com" meta1="order_lookup" meta2="● Healthy" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                                <${SvcNode} nodeId="dep-cs-openai-tool-faq" nav="tools" icon="tool" name="Notion v1" label="MCP" favicon="https://www.google.com/s2/favicons?sz=64&domain=notion.so" meta1="faq_search" meta2="● Healthy" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                            </${SvcRow}>
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // Deployment — cs-bot-edge
            mount('svc-graph-dep-cs-edge', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start; gap: 14px;">
                        <${SvcZone} col=${true} label="Kubernetes (Edge)" style="border-color: rgba(232,236,240,0.16); background: rgba(232,236,240,0.02); flex: 1; min-width: 340px;" labelStyle="color: rgba(232,236,240,0.92); background: rgba(232,236,240,0.08);">
                            <${SvcNode}
                                className="node-success node-primary"
                                nodeId="dep-cs-edge-agent"
                                nav="agent-detail-cs"
                                edges="dep-cs-edge-model|rgba(255,255,255,0.2); dep-cs-edge-guard|rgba(255,255,255,0.2); dep-cs-edge-db|rgba(16,185,129,0.25); dep-cs-edge-tools|rgba(59,130,246,0.25)"
                                icon="agent"
                                name="cs-bot-edge"
                                meta1="Edge runtime · v2.1"
                                meta2="● Healthy"
                                meta2Class="status-success"
                            />
                            <${SvcRow} style="gap: 12px;">
                                <${SvcNode} nodeId="dep-cs-edge-model" nav="models" icon="model" name="gpt-4-turbo" meta1="OpenAI model" meta2="● Healthy" meta2Class="status-success" />
                                <${SvcNode} nodeId="dep-cs-edge-guard" nav="tools" icon="shield" name="content-filter v2" label="API" meta1="Moderations" meta2="● Healthy" meta2Class="status-success" />
                            </${SvcRow}>
                            <${SvcNode} className="node-success" nodeId="dep-cs-edge-db" nav="db-detail-sas" icon="db" name="support-articles-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=milvus.io" meta1="Vector store · snapshot@2026-02-06" meta2="● Healthy" meta2Class="status-success" />
                            <${SvcNode} nodeId="dep-cs-edge-tools" nav="tools" icon="tool" name="Tools" meta1="Slack v3, GitHub v2, Notion v1" meta2="● Connected" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // Deployment — cs-bot-bedrock
            mount('svc-graph-dep-cs-bedrock', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start; gap: 14px;">
                        <${SvcZone} col=${true} label="AWS" style="border-color: rgba(245,158,11,0.28); background: rgba(245,158,11,0.03); flex: 1; min-width: 340px;" labelStyle="color: #F59E0B; background: rgba(245,158,11,0.12);">
                            <${SvcNode}
                                className="node-success node-primary"
                                nodeId="dep-cs-bedrock-agent"
                                nav="agent-detail-cs"
                                edges="dep-cs-bedrock-model|rgba(255,255,255,0.2); dep-cs-bedrock-db|rgba(16,185,129,0.25); dep-cs-bedrock-tools|rgba(59,130,246,0.25)"
                                icon="agent"
                                name="cs-bot-bedrock"
                                meta1="Bedrock routing · v2.1"
                                meta2="● Healthy"
                                meta2Class="status-success"
                            />
                            <${SvcRow} style="gap: 12px;">
                                <${SvcNode} nodeId="dep-cs-bedrock-model" nav="models" icon="model" name="Claude 3.5 Sonnet" meta1="Provider model" meta2="● Healthy" meta2Class="status-success" />
                                <${SvcNode} className="node-success" nodeId="dep-cs-bedrock-db" nav="db-detail-sas" icon="db" name="support-articles-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=milvus.io" meta1="Vector store · snapshot@2026-02-06" meta2="● Healthy" meta2Class="status-success" />
                            </${SvcRow}>
                            <${SvcNode} nodeId="dep-cs-bedrock-tools" nav="tools" icon="tool" name="Tools" meta1="Slack v3, GitHub v2, Notion v1" meta2="● Connected" meta2Class="status-success" style="border-color: rgba(59,130,246,0.4);" />
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);

            // Deployment — pks-prod
            mount('svc-graph-dep-pks-prod', html`
                <${SvcGraph}>
                    <${SvcRow} style="align-items: flex-start;">
                        <${SvcZone} col=${true} label="Red Hat OpenShift AI" style="border-color: rgba(238,0,0,0.3); background: rgba(238,0,0,0.02); flex: 1; max-width: 700px;" labelStyle="color: #EE0000; background: rgba(238,0,0,0.12);">
                            <${SvcNode} nodeId="dep-pks-docs" edges="dep-pks-pipeline|rgba(255,255,255,0.2)" icon="📂" name="Source Documents" meta1="47 docs · S3 bucket" meta2="● Synced" meta2Class="status-success" />
                            <${SvcNode} nodeId="dep-pks-pipeline" edges="dep-pks-embed|rgba(255,255,255,0.2); dep-pks-db|rgba(245,158,11,0.45)" icon="⚙️" name="faq-pipeline-v3" meta1="Ingestion Pipeline" meta2="Last run: 2h ago" />
                            <${SvcRow}>
                                <${SvcNode} nodeId="dep-pks-embed" icon="🔗" name="text-embedding-3-large" meta1="Embedding Model" meta2="● Healthy" meta2Class="status-success" />
                                <${SvcNode} className="node-warning" nodeId="dep-pks-db" nav="db-detail-pks" icon="▤" name="product-knowledge-store" favicon="https://www.google.com/s2/favicons?sz=64&domain=trychroma.com" meta1="ChromaDB · 8,901 chunks" meta2="⚠ 3 malformed" meta2Class="status-warning" />
                            </${SvcRow}>
                        </${SvcZone}>
                    </${SvcRow}>
                </${SvcGraph}>
            `);
        }
        
        window.showView = showView;
        function showView(viewId) {
            // Hide all views
            var views = document.querySelectorAll('.view');
            for (var i = 0; i < views.length; i++) {
                views[i].classList.remove('active');
            }
            
            // Show selected view
            var view = document.getElementById('view-' + viewId);
            if (view) {
                view.classList.add('active');
            }

            // Update breadcrumb
            updateBreadcrumb(viewId);
            
            // Update sidebar active state
            updateSidebar(viewId);
        }

        function updateBreadcrumb(viewId) {
            var breadcrumb = document.getElementById('breadcrumb');
            var html = '';
            
            switch(viewId) {
                case 'pipelines':
                    html = '<span class="breadcrumb-link" data-nav="pipelines">Pipelines</span><span class="separator">›</span><span class="current">Overview</span>';
                    break;
                case 'evaluations':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="current">Evaluation Runs</span>';
                    break;
                case 'eval-detail':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-pa">Product Advisor Agent</span><span class="separator">›</span><span class="current">Alert Detail</span>';
                    break;
                case 'trace-detail':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-pa">Product Advisor Agent</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="eval-detail">Alert</span><span class="separator">›</span><span class="current">Trace #a3f2b1</span>';
                    break;
                case 'chunk-lineage':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-pa">Product Advisor Agent</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="eval-detail">Alert</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="trace-detail">Trace #a3f2b1</span><span class="separator">›</span><span class="current">chunk_8a2d</span>';
                    break;
                case 'chunks':
                    html = '<span class="breadcrumb-link" data-nav="pipelines">Pipelines</span><span class="separator">›</span><span class="current">Chunk Explorer</span>';
                    break;
                case 'datasets':
                    html = '<span class="breadcrumb-link" data-nav="datasets">Data Sets</span><span class="separator">›</span><span class="current">Overview</span>';
                    break;
                case 'agents':
                    html = '<span class="current">Agents</span>';
                    break;
                case 'agent-detail-cs':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="current">Customer Support Bot</span>';
                    break;
                case 'agent-deployments':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">Deployments</span>';
                    break;
                case 'agent-evaluations':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">Evaluations</span>';
                    break;
                case 'agent-analytics':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">Jobs</span>';
                    break;
                case 'agent-detail-pa':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="current">Product Advisor Agent</span>';
                    break;
                case 'deployment-cs-prod':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">cs-bot-prod</span>';
                    break;
                case 'deployment-cs-prod-usage':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="deployment-cs-prod">cs-bot-prod</span><span class="separator">›</span><span class="current">Usage</span>';
                    break;
                case 'deployment-cs-openai':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">cs-bot-openai</span>';
                    break;
                case 'deployment-alert-cs-openai-feedback':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="deployment-cs-openai">cs-bot-openai</span><span class="separator">›</span><span class="current">Analytics Alert</span>';
                    break;
                case 'deployment-alerts':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">Alerts</span>';
                    break;
                case 'deployment-cs-edge':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">cs-bot-edge</span>';
                    break;
                case 'deployment-cs-bedrock':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="current">cs-bot-bedrock</span>';
                    break;
                case 'deployment-pa-prod':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-pa">Product Advisor Agent</span><span class="separator">›</span><span class="current">pa-agent-prod</span>';
                    break;
                case 'tools':
                    html = '<span class="breadcrumb-link" data-nav="tools">Tools</span><span class="separator">›</span><span class="current">Registry</span>';
                    break;
                case 'guardrails':
                    html = '<span class="breadcrumb-link" data-nav="guardrails">Guardrails</span><span class="separator">›</span><span class="current">Policies</span>';
                    break;
                case 'databases':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="tools">Tools</span><span class="separator">›</span><span class="current">Vector Stores &amp; Databases</span>';
                    break;
                case 'db-detail-pks':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="tools">Tools</span><span class="separator">›</span><span class="current">product-knowledge-store</span>';
                    break;
                case 'db-detail-sas':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="tools">Tools</span><span class="separator">›</span><span class="current">support-articles-store</span>';
                    break;
                case 'db-detail-sas-stale':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="agent-detail-cs">Customer Support Bot</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="deployment-cs-openai">cs-bot-openai</span><span class="separator">›</span><span class="current">support-articles-store (stale)</span>';
                    break;
                case 'deployment-pks-prod':
                    html = '<span class="breadcrumb-link" data-nav="agents">Agents</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="tools">Tools</span><span class="separator">›</span><span class="breadcrumb-link" data-nav="db-detail-pks">product-knowledge-store</span><span class="separator">›</span><span class="current">pks-prod</span>';
                    break;
                case 'models':
                    html = '<span class="breadcrumb-link" data-nav="models">Models</span><span class="separator">›</span><span class="current">Registry</span>';
                    break;
                case 'model-gpt-4-turbo':
                    html = '<span class="breadcrumb-link" data-nav="models">Models</span><span class="separator">›</span><span class="current">gpt-4-turbo</span>';
                    break;
                default:
                    html = '<span class="breadcrumb-link" data-nav="pipelines">Pipelines</span><span class="separator">›</span><span class="current">Overview</span>';
            }
            
            breadcrumb.innerHTML = html;
        }

        function updateSidebar(viewId) {
            // View → parent-group mappings
            var agentViews = ['agents', 'agent-detail-cs', 'agent-detail-pa', 'agent-deployments', 'agent-analytics', 'agent-evaluations', 'deployment-cs-prod', 'deployment-cs-prod-usage', 'deployment-cs-openai', 'deployment-alert-cs-openai-feedback', 'deployment-cs-edge', 'deployment-cs-bedrock', 'deployment-pa-prod', 'eval-detail', 'trace-detail', 'chunk-lineage'];
            var pipelineViews = ['pipelines', 'evaluations', 'chunks'];
            var dbViews = ['databases', 'db-detail-pks', 'db-detail-sas', 'deployment-pks-prod'];
            var modelViews = ['models', 'model-gpt-4-turbo'];
            var toolsViews = ['tools', 'databases', 'db-detail-pks', 'db-detail-sas', 'deployment-pks-prod'];
            var guardrailViews = ['guardrails'];
            // Alerts views removed from sidebar for now (confusing in prototype)
            var alertsViews = ['deployment-alert-cs-openai-feedback'];
            var deploymentsTopViews = ['deployment-cs-prod', 'deployment-cs-prod-usage', 'deployment-cs-openai', 'deployment-alert-cs-openai-feedback', 'deployment-cs-edge', 'deployment-cs-bedrock', 'deployment-pa-prod', 'deployment-alerts', 'deployment-pks-prod'];

            // All views that highlight the Agents primary sidebar item
            var agentGroupViews = agentViews.concat(dbViews);

            // --- Primary sidebar items ---
            var items = document.querySelectorAll('.sidebar .sidebar-item');
            for (var i = 0; i < items.length; i++) {
                items[i].classList.remove('active');
                var nav = items[i].getAttribute('data-nav');
                if (nav === viewId || 
                    (nav === 'agents' && agentGroupViews.indexOf(viewId) !== -1) ||
                    // deployments removed from sidebar
                    (nav === 'deployments' && false) ||
                    (nav === 'tools' && toolsViews.indexOf(viewId) !== -1) ||
                    (nav === 'guardrails' && guardrailViews.indexOf(viewId) !== -1) ||
                    // agent-alerts removed from sidebar
                    (nav === 'agent-alerts' && false) ||
                    (nav === 'pipelines' && pipelineViews.indexOf(viewId) !== -1) ||
                    (nav === 'models' && modelViews.indexOf(viewId) !== -1)) {
                    items[i].classList.add('active');
                }
            }

            // --- Sub-panels: Agents vs Deployment ---
            var agentsPanel = document.getElementById('agents-subpanel');
            var depPanel = document.getElementById('deployment-subpanel');
            var deploymentViews = ['deployment-cs-prod', 'deployment-cs-prod-usage', 'deployment-cs-openai', 'deployment-alert-cs-openai-feedback', 'deployment-cs-edge', 'deployment-cs-bedrock', 'deployment-pa-prod', 'deployment-alerts'];
            var isDeployment = deploymentViews.indexOf(viewId) !== -1;

            // Subpanel items: Overview highlights for agent detail, Deployments for deployment views, Analytics, Evaluations
            var subOverviewViews = ['agent-detail-cs', 'agent-detail-pa'];
            var subDeploymentsViews = ['agent-deployments', 'deployment-cs-prod', 'deployment-cs-prod-usage', 'deployment-cs-openai', 'deployment-alert-cs-openai-feedback', 'deployment-cs-edge', 'deployment-cs-bedrock', 'deployment-pa-prod'];
            var subAnalyticsViews = ['agent-analytics'];
            var subAlertsViews = [];
            var subEvalsViews = ['agent-evaluations', 'eval-detail', 'trace-detail', 'chunk-lineage'];

            // Views that show the agents subpanel (agent detail drilldowns only, NOT the agents table)
            var agentDetailDrillViews = ['agent-detail-cs', 'agent-detail-pa', 'agent-deployments', 'agent-analytics', 'agent-evaluations', 'eval-detail', 'trace-detail', 'chunk-lineage'];
            var showAgentsSubpanel = agentDetailDrillViews.indexOf(viewId) !== -1;

            if (agentsPanel && depPanel) {
                if (isDeployment) {
                    // Show Deployment subpanel, hide Agents subpanel
                    agentsPanel.classList.remove('visible');
                    depPanel.classList.add('visible');

                    // Highlight the correct Deployment tab
                    var depItems = depPanel.querySelectorAll('.sidebar-subpanel-item');
                    for (var d = 0; d < depItems.length; d++) {
                        depItems[d].classList.remove('active');
                        var tab = depItems[d].getAttribute('data-dep-tab');
                        var desired = (viewId === 'deployment-alerts' || viewId.indexOf('deployment-alert-') === 0) ? 'alerts' : viewId.indexOf('-usage') !== -1 ? 'usage' : 'overview';
                        if (tab === desired) {
                            depItems[d].classList.add('active');
                        }
                    }
                } else if (showAgentsSubpanel) {
                    agentsPanel.classList.add('visible');
                    depPanel.classList.remove('visible');

                    // Highlight the correct Agents sub-panel item
                    var subItems = agentsPanel.querySelectorAll('.sidebar-subpanel-item');
                    for (var j = 0; j < subItems.length; j++) {
                        subItems[j].classList.remove('active');
                        var sNav = subItems[j].getAttribute('data-nav');
                        if ((sNav === 'agent-detail-cs' && subOverviewViews.indexOf(viewId) !== -1) ||
                            (sNav === 'agent-deployments' && subDeploymentsViews.indexOf(viewId) !== -1) ||
                            (sNav === 'agent-analytics' && subAnalyticsViews.indexOf(viewId) !== -1) ||
                            // agent-alerts removed from sidebar
                            (sNav === 'agent-alerts' && false) ||
                            (sNav === 'agent-evaluations' && subEvalsViews.indexOf(viewId) !== -1)) {
                            subItems[j].classList.add('active');
                        }
                    }
                } else {
                    agentsPanel.classList.remove('visible');
                    depPanel.classList.remove('visible');
                }
            }
        }

        function openSidePanel() {
            document.getElementById('sidePanel').classList.add('open');
            document.getElementById('sidePanelOverlay').classList.add('open');
        }

        function closeSidePanel() {
            document.getElementById('sidePanel').classList.remove('open');
            document.getElementById('sidePanelOverlay').classList.remove('open');
        }

        function toggleSidebar() {
            var sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('collapsed');
            // Also hide/show the sub-panel when sidebar collapses
            var subpanel = document.getElementById('agents-subpanel');
            if (subpanel) {
                if (sidebar.classList.contains('collapsed')) {
                    subpanel.classList.add('hidden-by-sidebar');
                } else {
                    subpanel.classList.remove('hidden-by-sidebar');
                }
            }
        }

        function toggleRetrieverDocs() {
            var docs = document.getElementById('retriever-docs');
            var chevron = document.getElementById('retriever-chevron');
            if (docs.style.display === 'none') {
                docs.style.display = 'flex';
                chevron.style.transform = 'rotate(90deg)';
            } else {
                docs.style.display = 'none';
                chevron.style.transform = 'rotate(0deg)';
            }
        }

        // ==========================================
        // Event Delegation - Single click handler
        // ==========================================
        
        document.addEventListener('click', function(e) {
            var target = e.target;
            
            // Walk up the DOM to find clickable elements
            while (target && target !== document) {
                // Check for navigation
                var navTarget = target.getAttribute('data-nav');
                if (navTarget) {
                    e.preventDefault();
                    showView(navTarget);
                    
                    // Check for close-panel action
                    var action = target.getAttribute('data-action');
                    if (action === 'close-panel') {
                        closeSidePanel();
                    }
                    return;
                }
                
                // Check for actions
                var action = target.getAttribute('data-action');
                if (action === 'open-panel') {
                    e.preventDefault();
                    openSidePanel();
                    return;
                }
                if (action === 'close-panel') {
                    e.preventDefault();
                    closeSidePanel();
                    return;
                }
                if (action === 'toggle-sidebar') {
                    e.preventDefault();
                    toggleSidebar();
                    return;
                }
                if (action === 'toggle-retriever') {
                    e.preventDefault();
                    toggleRetrieverDocs();
                    return;
                }
                if (action === 'noop') {
                    // Used to prevent card-level navigation for buttons
                    e.preventDefault();
                    return;
                }
                
                // Check for overlay click
                if (target.id === 'sidePanelOverlay') {
                    closeSidePanel();
                    return;
                }
                
                target = target.parentNode;
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSidePanel();
            }
        });

        // ==========================================
        // Service Map — auto-draw edges between nodes
        // ==========================================
        function drawEdges(graph) {
            var svg = graph.querySelector('svg.svc-edges');
            if (!svg) return;
            // Use scrollWidth/scrollHeight so the edge canvas covers wrapped/scrollable content.
            var w = graph.scrollWidth || graph.clientWidth || 0;
            var h = graph.scrollHeight || graph.clientHeight || 0;
            if (w === 0 || h === 0) return;
            svg.setAttribute('width', w);
            svg.setAttribute('height', h);
            svg.setAttribute('viewBox', '0 0 ' + w + ' ' + h);
            svg.setAttribute('preserveAspectRatio', 'none');
            svg.innerHTML = '';
            var viewport = graph.closest('.svc-graph-scroll');
            var vRect = viewport ? viewport.getBoundingClientRect() : graph.getBoundingClientRect();
            var panX = parseFloat(graph.dataset.panX || '0') || 0;
            var panY = parseFloat(graph.dataset.panY || '0') || 0;
            var panScale = parseFloat(graph.dataset.panScale || '1') || 1;
            var edges = graph.querySelectorAll('[data-edges]');
            for (var i = 0; i < edges.length; i++) {
                var el = edges[i];
                var defs = el.getAttribute('data-edges').split(';');
                for (var j = 0; j < defs.length; j++) {
                    var parts = defs[j].trim().split('|');
                    if (parts.length < 2) continue;
                    var targetId = parts[0].trim();
                    var color = parts[1] ? parts[1].trim() : 'rgba(255,255,255,0.2)';
                    var target = graph.querySelector('[data-node-id="' + targetId + '"]');
                    if (!target) continue;

                    var fromR = el.getBoundingClientRect();
                    var toR = target.getBoundingClientRect();

                    // Centers in local graph coordinates (invert pan/zoom transform)
                    var fcx = (fromR.left + fromR.width / 2 - vRect.left - panX) / panScale;
                    var fcy = (fromR.top + fromR.height / 2 - vRect.top - panY) / panScale;
                    var tcx = (toR.left + toR.width / 2 - vRect.left - panX) / panScale;
                    var tcy = (toR.top + toR.height / 2 - vRect.top - panY) / panScale;

                    // Direction vector
                    var dx = tcx - fcx;
                    var dy = tcy - fcy;
                    var len = Math.sqrt(dx * dx + dy * dy);
                    if (len === 0) continue;
                    var nx = dx / len;
                    var ny = dy / len;

                    // Clip to bounding box edges
                    function clipEdge(cx, cy, hw, hh, dirX, dirY) {
                        var sx = dirX !== 0 ? Math.abs(hw / dirX) : 1e9;
                        var sy = dirY !== 0 ? Math.abs(hh / dirY) : 1e9;
                        var s = Math.min(sx, sy);
                        return { x: cx + dirX * s, y: cy + dirY * s };
                    }

                    var fromPt = clipEdge(fcx, fcy, (fromR.width / 2) / panScale, (fromR.height / 2) / panScale, nx, ny);
                    var toPt = clipEdge(tcx, tcy, (toR.width / 2) / panScale, (toR.height / 2) / panScale, -nx, -ny);

                    var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', fromPt.x);
                    line.setAttribute('y1', fromPt.y);
                    line.setAttribute('x2', toPt.x);
                    line.setAttribute('y2', toPt.y);
                    line.setAttribute('stroke', color);
                    line.setAttribute('stroke-width', '1.5');
                    line.setAttribute('stroke-dasharray', '5 3');
                    svg.appendChild(line);
                }
            }
        }

        function drawAllEdges() {
            var graphs = document.querySelectorAll('.svc-graph');
            for (var i = 0; i < graphs.length; i++) {
                // Skip hidden graphs (inactive views)
                if (graphs[i].offsetWidth === 0 || graphs[i].offsetHeight === 0) continue;
                drawEdges(graphs[i]);
            }
        }

        // Mount Preact card components once (self-contained prototype)
        initCostBadges();
        mountDeploymentViews();
        mountAlertViews();
        mountAlertsInbox();
        mountCards();
        mountSvcGraphs();

        // Redraw service-graph edges after layout/view changes.
        // (Per-graph listeners are registered by the SvcGraph component.)
        var _origShowView = showView;
        showView = function(viewId) {
            _origShowView(viewId);
            // Persist current view in URL hash for reload support
            if (window.location.hash !== '#' + viewId) {
                window.location.hash = viewId;
            }
            setTimeout(function() {
                window.dispatchEvent(new Event('svc-graph-redraw'));
            }, 50);
        };
        window.showView = showView;

        // Hash-based routing: restore view on load & back/forward
        function routeFromHash() {
            var hash = window.location.hash.replace('#', '');
            if (hash && document.getElementById('view-' + hash)) {
                showView(hash);
            }
        }
        window.addEventListener('hashchange', routeFromHash);
        // On initial load, navigate to hash if present
        routeFromHash();

        window.addEventListener('resize', function() {
            setTimeout(function() {
                window.dispatchEvent(new Event('svc-graph-redraw'));
            }, 100);
        });
        setTimeout(function() {
            window.dispatchEvent(new Event('svc-graph-redraw'));
        }, 100);
    </script>
</body>
</html>
